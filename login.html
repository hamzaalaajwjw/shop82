<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ | a3len</title>
    <style>
        /* (Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø­Ø§Ù„ÙŠØ© ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ) */
        
        /* Ø¥Ø¶Ø§ÙØ© Ø£Ù†Ù…Ø§Ø· Ø¬Ø¯ÙŠØ¯Ø© */
        .remember-forgot {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 15px 0;
            font-size: 14px;
        }
        
        .remember-me {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .remember-me input {
            width: auto;
            margin: 0;
        }
        
        .forgot-password {
            color: #38bdf8;
            cursor: pointer;
            text-decoration: none;
        }
        
        .forgot-password:hover {
            text-decoration: underline;
        }
        
        .login-options {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: rgba(56, 189, 248, 0.1);
            border-radius: 6px;
            border: 1px solid rgba(56, 189, 248, 0.2);
        }
        
        .login-options p {
            margin: 10px 0;
            color: #9ca3af;
        }
        
        .login-with-email {
            color: #38bdf8;
            cursor: pointer;
            font-weight: bold;
        }
        
        /* Forgot Password Modal */
        .forgot-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .forgot-content {
            background: #1c1f27;
            padding: 30px;
            border-radius: 10px;
            max-width: 400px;
            width: 90%;
            text-align: center;
        }
        
        .forgot-content h3 {
            color: #38bdf8;
            margin-bottom: 20px;
        }
        
        .forgot-content input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border-radius: 6px;
            border: 1px solid #374151;
            background: #111318;
            color: #e5e7eb;
        }
        
        .forgot-content button {
            margin: 10px 5px;
        }
        
        .security-warning {
            font-size: 12px;
            color: #f59e0b;
            margin-top: 10px;
            text-align: center;
        }
        
        .attempts-warning {
            color: #ef4444;
            font-size: 12px;
            margin: 10px 0;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="login-container">
        <div class="logo">
            <h1>a3len</h1>
            <p>Ø³ÙˆÙ‚ Ø¨ÙŠØ¹ ÙˆØ´Ø±Ø§Ø¡ Ù‚Ø·Ø¹ Ø§Ù„Ø¨ÙŠØ³ÙŠ</p>
        </div>
        
        <div id="errorMessage" class="error-message"></div>
        <div id="successMessage" class="success-message"></div>
        
        <div id="attemptsWarning" class="attempts-warning" style="display: none;"></div>
        
        <form id="loginForm">
            <div class="form-group">
                <label for="loginInput">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                <input type="text" id="loginInput" required autocomplete="username">
            </div>
            
            <div class="form-group">
                <label for="password">ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±</label>
                <input type="password" id="password" required autocomplete="current-password">
                <div class="security-warning">
                    ğŸ”’ ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ùƒ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø±Ø³Ù…ÙŠ a3len
                </div>
            </div>
            
            <div class="remember-forgot">
                <div class="remember-me">
                    <input type="checkbox" id="rememberMe">
                    <label for="rememberMe">ØªØ°ÙƒØ±Ù†ÙŠ</label>
                </div>
                <a class="forgot-password" onclick="showForgotPassword()">Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±ØŸ</a>
            </div>
            
            <button type="submit" class="login-btn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
        </form>
        
        <div class="login-options">
            <p>Ø·ÙØ±Ù‚ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø£Ø®Ø±Ù‰</p>
            <a class="login-with-email" onclick="switchToEmailLogin()">Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙÙ‚Ø·</a>
        </div>
        
        <div class="links">
            <a href="register.html">Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</a>
            <a href="index.html">â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
        </div>
    </div>
    
    <!-- Forgot Password Modal -->
    <div class="forgot-modal" id="forgotModal">
        <div class="forgot-content">
            <h3>Ø§Ø³ØªØ¹Ø§Ø¯Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±</h3>
            <p>Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆØ³Ù†Ø±Ø³Ù„ Ù„Ùƒ Ø±Ø§Ø¨Ø· Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†</p>
            <input type="email" id="resetEmail" placeholder="Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
            <button class="login-btn" onclick="resetPassword()">Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©</button>
            <button class="btn btn-secondary" onclick="hideForgotPassword()">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    </div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    
    <script>
        // Ø¥Ø¹Ø¯Ø§Ø¯ Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAl3XunFOwHpGw-4_VYyETMtoLgk4mnRpQ",
            authDomain: "a3len-3ad54.firebaseapp.com",
            databaseURL: "https://a3len-3ad54-default-rtdb.firebaseio.com",
            projectId: "a3len-3ad54",
            storageBucket: "a3len-3ad54.firebasestorage.app",
            messagingSenderId: "767338034080",
            appId: "1:767338034080:web:801d77fb74c0aa56e92ac5"
        };
        firebase.initializeApp(firebaseConfig);
        
        const auth = firebase.auth();
        const db = firebase.database();
        
        // ØªØ­Ù‚Ù‚ Ù…Ù† Ø¬Ù„Ø³Ø© Ø³Ø§Ø¨Ù‚Ø©
        checkExistingSession();
        
        // Ø¹Ø¯Ø¯ Ù…Ø­Ø§ÙˆÙ„Ø§Øª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        let loginAttempts = localStorage.getItem('a3len_login_attempts') || 0;
        let lockUntil = localStorage.getItem('a3len_lock_until') || 0;
        
        function checkExistingSession() {
            const rememberMe = localStorage.getItem('a3len_remember_me');
            const deviceId = localStorage.getItem('a3len_device_id');
            
            if (rememberMe && deviceId) {
                // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© ÙØ­Øµ Ù„Ù„Ø¬Ù‡Ø§Ø² Ù‡Ù†Ø§
                document.getElementById('rememberMe').checked = true;
            }
        }
        
        function showForgotPassword() {
            document.getElementById('forgotModal').style.display = 'flex';
        }
        
        function hideForgotPassword() {
            document.getElementById('forgotModal').style.display = 'none';
            document.getElementById('resetEmail').value = '';
        }
        
        function switchToEmailLogin() {
            document.getElementById('loginInput').placeholder = 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙÙ‚Ø·';
            document.getElementById('loginInput').value = '';
            document.getElementById('loginInput').focus();
        }
        
        // ÙØ­Øµ Ø§Ù„Ù‚ÙÙ„ Ø¨Ø³Ø¨Ø¨ Ù…Ø­Ø§ÙˆÙ„Ø§Øª ÙƒØ«ÙŠØ±Ø©
        function checkLoginLock() {
            const now = Date.now();
            if (lockUntil && now < lockUntil) {
                const minutes = Math.ceil((lockUntil - now) / 60000);
                document.getElementById('attemptsWarning').textContent = 
                    `âš ï¸ ØªÙ… ØªØ¹Ù„ÙŠÙ‚ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù…Ø¯Ø© ${minutes} Ø¯Ù‚ÙŠÙ‚Ø© Ø¨Ø³Ø¨Ø¨ Ù…Ø­Ø§ÙˆÙ„Ø§Øª ÙƒØ«ÙŠØ±Ø©`;
                document.getElementById('attemptsWarning').style.display = 'block';
                return true;
            }
            return false;
        }
        
        // Ø²ÙŠØ§Ø¯Ø© Ù…Ø­Ø§ÙˆÙ„Ø§Øª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        function incrementLoginAttempts() {
            loginAttempts++;
            localStorage.setItem('a3len_login_attempts', loginAttempts);
            
            if (loginAttempts >= 5) {
                // Ù‚ÙÙ„ Ù„Ù…Ø¯Ø© 15 Ø¯Ù‚ÙŠÙ‚Ø©
                lockUntil = Date.now() + 15 * 60 * 1000;
                localStorage.setItem('a3len_lock_until', lockUntil);
                
                document.getElementById('attemptsWarning').textContent = 
                    'âš ï¸ ØªÙ… ØªØ¹Ù„ÙŠÙ‚ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù…Ø¯Ø© 15 Ø¯Ù‚ÙŠÙ‚Ø© Ø¨Ø³Ø¨Ø¨ Ù…Ø­Ø§ÙˆÙ„Ø§Øª ÙƒØ«ÙŠØ±Ø©';
                document.getElementById('attemptsWarning').style.display = 'block';
            } else if (loginAttempts >= 3) {
                document.getElementById('attemptsWarning').textContent = 
                    `âš ï¸ ØªØ­Ø°ÙŠØ±: Ù„Ø¯ÙŠÙƒ ${loginAttempts} Ù…Ø­Ø§ÙˆÙ„Ø§Øª ÙØ§Ø´Ù„Ø©`;
                document.getElementById('attemptsWarning').style.display = 'block';
            }
        }
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø¹Ù†Ø¯ Ù†Ø¬Ø§Ø­ Ø§Ù„Ø¯Ø®ÙˆÙ„
        function resetLoginAttempts() {
            loginAttempts = 0;
            lockUntil = 0;
            localStorage.removeItem('a3len_login_attempts');
            localStorage.removeItem('a3len_lock_until');
            document.getElementById('attemptsWarning').style.display = 'none';
        }
        
        // Ù…Ù†Ø¹ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            loginUser();
        });
        
        async function loginUser() {
            const loginInput = document.getElementById('loginInput').value.trim();
            const password = document.getElementById('password').value;
            const rememberMe = document.getElementById('rememberMe').checked;
            const errorDiv = document.getElementById('errorMessage');
            const successDiv = document.getElementById('successMessage');
            
            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
            errorDiv.style.display = 'none';
            successDiv.style.display = 'none';
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‚ÙÙ„
            if (checkLoginLock()) {
                return;
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            if (!loginInput || !password) {
                errorDiv.textContent = 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ù…Ø·Ù„ÙˆØ¨Ø©';
                errorDiv.style.display = 'block';
                return;
            }
            
            // ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ø¯Ø®ÙˆÙ„ (Ø¨Ø±ÙŠØ¯ Ø£Ùˆ Ø§Ø³Ù… Ù…Ø³ØªØ®Ø¯Ù…)
            let userEmail = loginInput;
            let usingUsername = false;
            
            // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø¨Ø±ÙŠØ¯Ø§Ù‹ (Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ @) ÙÙ‡Ùˆ Ø§Ø³Ù… Ù…Ø³ØªØ®Ø¯Ù…
            if (!loginInput.includes('@')) {
                usingUsername = true;
                // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ù…Ø±ØªØ¨Ø· Ø¨Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                try {
                    const snapshot = await db.ref("users")
                        .orderByChild("username")
                        .equalTo(loginInput)
                        .once("value");
                    
                    if (!snapshot.exists()) {
                        incrementLoginAttempts();
                        errorDiv.textContent = 'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙŠØ± ØµØ­ÙŠØ­Ø©';
                        errorDiv.style.display = 'block';
                        return;
                    }
                    
                    const users = snapshot.val();
                    for (const uid in users) {
                        if (users[uid].username === loginInput) {
                            userEmail = users[uid].email;
                            break;
                        }
                    }
                    
                    if (!userEmail) {
                        incrementLoginAttempts();
                        errorDiv.textContent = 'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙŠØ± ØµØ­ÙŠØ­Ø©';
                        errorDiv.style.display = 'block';
                        return;
                    }
                } catch (error) {
                    console.error('Error finding user:', error);
                    errorDiv.textContent = 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª';
                    errorDiv.style.display = 'block';
                    return;
                }
            }
            
            // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø«Ø¨Ø§Øª Ø§Ù„Ø¬Ù„Ø³Ø©
            const persistence = rememberMe ? 
                firebase.auth.Auth.Persistence.LOCAL : 
                firebase.auth.Auth.Persistence.SESSION;
            
            try {
                await auth.setPersistence(persistence);
                
                // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                const userCredential = await auth.signInWithEmailAndPassword(userEmail, password);
                const user = userCredential.user;
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¨Ø±ÙŠØ¯
                if (!user.emailVerified) {
                    errorDiv.innerHTML = `
                        âš ï¸ Ù„Ù… ÙŠØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ<br>
                        <small>ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¨Ø±ÙŠØ¯Ùƒ. <a href="javascript:void(0)" onclick="resendVerification()">Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ£ÙƒÙŠØ¯</a></small>
                    `;
                    errorDiv.style.display = 'block';
                    await auth.signOut();
                    return;
                }
                
                // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù†Ø§Ø¬Ø­
                const deviceId = generateDeviceId();
                await db.ref("users/" + user.uid).update({
                    lastActive: firebase.database.ServerValue.TIMESTAMP,
                    'security/lastLogin': firebase.database.ServerValue.TIMESTAMP,
                    'security/loginAttempts': 0
                });
                
                // Ø­ÙØ¸ Ø¬Ù‡Ø§Ø² Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                await db.ref("users/" + user.uid + "/security/devices/" + deviceId).set({
                    userAgent: navigator.userAgent,
                    lastLogin: firebase.database.ServerValue.TIMESTAMP,
                    ip: 'unknown',
                    location: 'unknown'
                });
                
                // Ø­ÙØ¸ Ø§Ù„Ø¬Ù‡Ø§Ø² Ù…Ø­Ù„ÙŠØ§Ù‹ Ø¥Ø°Ø§ Ø§Ø®ØªØ§Ø± "ØªØ°ÙƒØ±Ù†ÙŠ"
                if (rememberMe) {
                    localStorage.setItem('a3len_device_id', deviceId);
                    localStorage.setItem('a3len_remember_me', 'true');
                }
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„ÙØ§Ø´Ù„Ø©
                resetLoginAttempts();
                
                // Ø¥Ù†Ø´Ø§Ø¡ CSRF Token
                const csrfToken = generateCSRFToken();
                localStorage.setItem('a3len_csrf_token', csrfToken);
                
                successDiv.textContent = 'âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!';
                successDiv.style.display = 'block';
                
                // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØ©
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 1000);
                
            } catch (error) {
                console.error('Login error:', error);
                incrementLoginAttempts();
                
                if (error.code === 'auth/user-not-found') {
                    errorDiv.textContent = 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± Ù…Ø³Ø¬Ù„';
                } else if (error.code === 'auth/wrong-password') {
                    errorDiv.textContent = 'ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙŠØ± ØµØ­ÙŠØ­Ø©';
                } else if (error.code === 'auth/too-many-requests') {
                    errorDiv.textContent = 'ØªÙ… ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ø¤Ù‚ØªØ§Ù‹ Ø¨Ø³Ø¨Ø¨ Ù…Ø­Ø§ÙˆÙ„Ø§Øª ÙƒØ«ÙŠØ±Ø©';
                } else if (error.code === 'auth/user-disabled') {
                    errorDiv.textContent = 'ØªÙ… ØªØ¹Ø·ÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨';
                } else {
                    errorDiv.textContent = 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
                }
                errorDiv.style.display = 'block';
            }
        }
        
        function generateDeviceId() {
            return 'device_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }
        
        function generateCSRFToken() {
            return 'csrf_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }
        
        async function resendVerification() {
            const user = auth.currentUser;
            if (user) {
                try {
                    await user.sendEmailVerification();
                    alert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø¥Ù„Ù‰ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ');
                } catch (error) {
                    alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ£ÙƒÙŠØ¯');
                }
            }
        }
        
        async function resetPassword() {
            const email = document.getElementById('resetEmail').value.trim();
            const errorDiv = document.getElementById('errorMessage');
            
            if (!email) {
                alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ');
                return;
            }
            
            try {
                await auth.sendPasswordResetEmail(email, {
                    url: window.location.origin + '/login.html',
                    handleCodeInApp: true
                });
                
                alert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ø³ØªØ¹Ø§Ø¯Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø¥Ù„Ù‰ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ');
                hideForgotPassword();
                
            } catch (error) {
                console.error('Reset password error:', error);
                if (error.code === 'auth/user-not-found') {
                    alert('Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± Ù…Ø³Ø¬Ù„');
                } else {
                    alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©');
                }
            }
        }
        
        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø¨Ø§Ù„Ø¶ØºØ· Ø®Ø§Ø±Ø¬Ù‡Ø§
        document.getElementById('forgotModal').addEventListener('click', function(e) {
            if (e.target === this) {
                hideForgotPassword();
            }
        });
    </script>
</body>
</html>
