
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A3len | تسجيل الدخول</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');
body { margin:0; font-family:'Roboto', sans-serif; background: linear-gradient(120deg,#2980b9,#6dd5fa); display:flex; justify-content:center; align-items:center; height:100vh;}
.container { background:#fff; border-radius:15px; padding:40px; width:350px; box-shadow:0 15px 25px rgba(0,0,0,0.2);}
h2 { text-align:center; margin-bottom:30px; color:#34495e;}
input { width:100%; padding:12px; margin:10px 0; border:1px solid #ccc; border-radius:8px; outline:none;}
input:focus { border-color:#3498db; }
button { width:100%; padding:12px; border:none; border-radius:8px; background:#3498db; color:#fff; font-size:16px; cursor:pointer; transition:0.3s;}
button:hover { background:#2980b9;}
.toggle { text-align:center; margin-top:15px; font-size:14px; color:#7f8c8d; cursor:pointer; }
</style>
</head>
<body>
<div class="container">
<h2 id="formTitle">تسجيل الدخول</h2>

<form id="loginForm">
<input type="email" id="loginEmail" placeholder="البريد الإلكتروني" required>
<input type="password" id="loginPassword" placeholder="كلمة المرور" required>
<button type="submit">تسجيل الدخول</button>
<div class="toggle" onclick="switchForm()">ليس لديك حساب؟ إنشاء حساب</div>
</form>

<form id="signupForm" style="display:none;">
<input type="text" id="username" placeholder="اسم المستخدم" required>
<input type="email" id="email" placeholder="البريد الإلكتروني" required>
<input type="password" id="password" placeholder="كلمة المرور" required>
<button type="submit">إنشاء حساب</button>
<div class="toggle" onclick="switchForm()">لديك حساب؟ تسجيل الدخول</div>
</form>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyAl3XunFOwHpGw-4_VYyETMtoLgk4mnRpQ",
  authDomain: "a3len-3ad54.firebaseapp.com",
  databaseURL: "https://a3len-3ad54-default-rtdb.firebaseio.com",
  projectId: "a3len-3ad54",
  storageBucket: "a3len-3ad54.firebasestorage.app",
  messagingSenderId: "767338034080",
  appId: "1:767338034080:web:801d77fb74c0aa56e92ac5"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth();

function switchForm(){
  document.getElementById("loginForm").style.display = document.getElementById("loginForm").style.display === 'none' ? 'block' : 'none';
  document.getElementById("signupForm").style.display = document.getElementById("signupForm").style.display === 'none' ? 'block' : 'none';
  document.getElementById("formTitle").textContent = document.getElementById("loginForm").style.display === 'block' ? 'تسجيل الدخول' : 'إنشاء حساب';
}

document.getElementById("signupForm").addEventListener('submit', e => {
  e.preventDefault();
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  const username = document.getElementById("username").value.trim();

  if(username === '') return alert("اختر اسم مستخدم");

  get(child(ref(db), 'usernames/' + username)).then(snapshot => {
    if(snapshot.exists()){
      alert("اسم المستخدم محجوز");
    } else {
      createUserWithEmailAndPassword(auth, email, password)
      .then(userCredential => {
        const uid = userCredential.user.uid;
        set(ref(db, 'users/' + uid), { email, username });
        set(ref(db, 'usernames/' + username), uid);
        window.location.href = "index.html";
      })
      .catch(err => alert(err.message));
    }
  });
});

document.getElementById("loginForm").addEventListener('submit', e => {
  e.preventDefault();
  const email = document.getElementById("loginEmail").value;
  const password = document.getElementById("loginPassword").value;

  signInWithEmailAndPassword(auth, email, password)
    .then(() => window.location.href = "index.html")
    .catch(err => alert(err.message));
});
</script>
</body>
</html>
