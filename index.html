<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>بيع وشراء قطع البيسي</title>
<style>
body {font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin:0; padding:0; background:#e5e5e5;}
header {background:#0d6efd; color:#fff; padding:15px 20px; display:flex; justify-content:space-between; align-items:center; box-shadow:0 3px 6px rgba(0,0,0,0.1);}
header h1 {margin:0; font-size:24px;}
.container {display:flex; min-height:calc(100vh - 60px);}
nav {width:220px; background:#212529; color:#fff; min-height:100vh; padding-top:20px; box-shadow:2px 0 5px rgba(0,0,0,0.1);}
nav a {display:block; color:#fff; padding:12px 20px; text-decoration:none; font-weight:bold;}
nav a:hover {background:#343a40; transition:0.3s;}
main {flex:1; padding:25px;}
.filter {margin-bottom:20px; display:flex; gap:10px; flex-wrap:wrap;}
input, select, button, textarea {padding:10px; border-radius:5px; border:1px solid #ccc; font-size:16px;}
button {background:#0d6efd; color:#fff; border:none; cursor:pointer; transition:0.3s;}
button:hover {background:#0b5ed7;}
.products-grid {display:grid; grid-template-columns: repeat(auto-fill,minmax(280px,1fr)); gap:15px;}
.product-card {background:#fff; padding:15px 20px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.15); position:relative;}
.product-card h3 {margin:0 0 10px 0; color:#0d6efd;}
.product-card p {margin:5px 0; font-size:14px;}
.product-card button {position:absolute; top:10px; right:10px; padding:5px 10px; font-size:12px; margin-left:5px; border:none; border-radius:4px; cursor:pointer;}
.edit-btn {background:#ffc107; color:#fff;}
.delete-btn {background:#dc3545; color:#fff;}
.form-container {background:#fff; padding:25px; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.15); max-width:600px; margin:auto;}
.form-container h2 {margin-top:0; color:#0d6efd;}
label {font-weight:bold; margin-top:10px; display:block;}
</style>
</head>
<body>

<header>
  <h1>بيع وشراء قطع البيسي</h1>
</header>

<div class="container">
  <nav>
    <a href="#" onclick="showHome()">الصفحة الرئيسية</a>
    <a href="#" onclick="showPublish()">نشر منتج</a>
  </nav>
  
  <main id="content"></main>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAl3XunFOwHpGw-4_VYyETMtoLgk4mnRpQ",
  authDomain: "a3len-3ad54.firebaseapp.com",
  databaseURL: "https://a3len-3ad54-default-rtdb.firebaseio.com",
  projectId: "a3len-3ad54",
  storageBucket: "a3len-3ad54.firebasestorage.app",
  messagingSenderId: "767338034080",
  appId: "1:767338034080:web:801d77fb74c0aa56e92ac5"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
firebase.auth().signInAnonymously().catch(console.error);

const categories = ["CPU","GPU","RAM","Motherboard","Storage","Power Supply","Case","Cooler","Accessories"];

// --- الصفحة الرئيسية ---
function showHome() {
  document.getElementById('content').innerHTML = `
    <div class="filter">
      <input type="text" id="search" placeholder="ابحث عن اسم القطعة" onkeyup="loadProducts()">
      <select id="categoryFilter" onchange="loadProducts()">
        <option value="">كل الأقسام</option>
        ${categories.map(c=>`<option value="${c}">${c}</option>`).join('')}
      </select>
    </div>
    <div class="products-grid" id="products"></div>
  `;
  loadProducts();
}

function loadProducts() {
  const search = document.getElementById('search')?.value.toLowerCase() || '';
  const category = document.getElementById('categoryFilter')?.value || '';
  db.ref('products').once('value', snapshot=>{
    const data = snapshot.val() || {};
    let html = '';
    Object.keys(data).forEach(key=>{
      const p = data[key];
      if((category==='' || p.category===category) && p.name.toLowerCase().includes(search)){
        html += `<div class="product-card" id="${key}">
                  <h3>${p.name}</h3>
                  <p><b>البائع:</b> ${p.seller}</p>
                  <p><b>رقم الهاتف:</b> ${p.phone}</p>
                  <p><b>المحافظة:</b> ${p.province}</p>
                  <p><b>نوع القطعة:</b> ${p.category}</p>
                  <p><b>السعر:</b> ${p.price} د.ع</p>
                  <p><b>توصيل متوفر:</b> ${p.delivery}</p>
                  <button class="edit-btn" onclick="editProduct('${key}')">تعديل</button>
                  <button class="delete-btn" onclick="deleteProduct('${key}')">حذف</button>
                 </div>`;
      }
    });
    document.getElementById('products').innerHTML = html || '<p>لا توجد منتجات</p>';
  });
}

function deleteProduct(key){ if(confirm("هل تريد حذف هذا المنتج؟")) db.ref('products/'+key).remove().then(loadProducts); }

function editProduct(key){
  db.ref('products/'+key).once('value', snap=>{ showPublish(snap.val(), key); });
}

// --- صفحة نشر المنتج ---
function showPublish(product=null,key=null){
  document.getElementById('content').innerHTML = `
    <div class="form-container">
      <h2>${product?'تعديل المنتج':'نشر منتج جديد'}</h2>
      <label>اسم القطعة</label><input type="text" id="prodName" value="${product?product.name:''}">
      <label>السعر (د.ع)</label><input type="number" id="prodPrice" value="${product?product.price:''}">
      <label>القسم</label>
      <select id="prodCategory">${categories.map(c=>`<option value="${c}" ${product&&product.category===c?'selected':''}>${c}</option>`).join('')}</select>
      <label>اسم البائع</label><input type="text" id="prodSeller" value="${product?product.seller:''}">
      <label>رقم الهاتف</label><input type="text" id="prodPhone" value="${product?product.phone:''}">
      <label>المحافظة</label><input type="text" id="prodProvince" value="${product?product.province:''}">
      <label>توصيل متوفر</label>
      <select id="prodDelivery">
        <option value="نعم" ${product&&product.delivery==='نعم'?'selected':''}>نعم</option>
        <option value="لا" ${product&&product.delivery==='لا'?'selected':''}>لا</option>
      </select>
      <button onclick="publishProduct('${key?key:''}')">${product?'تحديث المنتج':'نشر المنتج'}</button>
    </div>
  `;
}

function publishProduct(key=''){
  const name=document.getElementById('prodName').value.trim();
  const price=document.getElementById('prodPrice').value.trim();
  const category=document.getElementById('prodCategory').value;
  const seller=document.getElementById('prodSeller').value.trim();
  const phone=document.getElementById('prodPhone').value.trim();
  const province=document.getElementById('prodProvince').value.trim();
  const delivery=document.getElementById('prodDelivery').value;
  if(!name||!price||!seller||!phone||!province){ alert('اكمل جميع الحقول'); return; }
  const prodRef = key?db.ref('products/'+key):db.ref('products').push();
  prodRef.set({name,price,category,seller,phone,province,delivery}).then(()=>{ alert('تم حفظ المنتج بنجاح'); showHome(); }).catch(err=>{ console.error(err); alert('حدث خطأ'); });
}

showHome();
</script>

</body>
</html>
