<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>a3len | Ø¨ÙŠØ¹ ÙˆØ´Ø±Ø§Ø¡ Ù‚Ø·Ø¹ Ø§Ù„Ø¨ÙŠØ³ÙŠ</title>
<link rel="stylesheet" href="style.css">

<style>
@font-face{
  font-family:'CustomFont';
  src:url('font.ttf') format('truetype');
}
body,input,select,button,textarea{
  font-family:'CustomFont',sans-serif;
}

/* Budget */
.budget-btn{
  background:#1f2937;color:#e5e7eb;border:none;
  padding:6px 12px;border-radius:6px;cursor:pointer
}
.budget-dialog{
  position:fixed;top:50%;left:50%;
  transform:translate(-50%,-50%);
  background:#0f1115;color:#e5e7eb;
  padding:20px;border-radius:12px;
  display:none;z-index:999
}
.budget-dialog input{
  width:100%;padding:8px;margin:10px 0;
  background:#1f2937;color:#fff;border:1px solid #333
}
.budget-dialog button{
  padding:6px 14px;border:none;border-radius:6px;cursor:pointer
}
.close-btn{background:#ef4444;color:#fff}
</style>
</head>

<body>

<header class="topbar">
  <div class="menu-toggle" onclick="toggleSidebar()">â˜°</div>
  <div class="logo">a3len</div>
  <div class="tagline">Ø³ÙˆÙ‚ Ø¨ÙŠØ¹ ÙˆØ´Ø±Ø§Ø¡ Ù‚Ø·Ø¹ Ø§Ù„Ø¨ÙŠØ³ÙŠ</div>
</header>

<div class="overlay" onclick="closeSidebar()"></div>

<div class="layout">
  <aside class="sidebar">
    <button onclick="showHome()">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    <button onclick="showPublish()">â• Ù†Ø´Ø± Ø¥Ø¹Ù„Ø§Ù†</button>
  </aside>
  <main id="content"></main>
</div>

<!-- Budget -->
<div class="budget-dialog" id="budgetDialog">
  <h3>Ø§ÙƒØªØ¨ Ø£Ø¹Ù„Ù‰ Ø³Ø¹Ø± Ø¨Ù…ÙŠØ²Ø§Ù†ÙŠØªÙƒ</h3>
  <input type="number" id="maxBudget" placeholder="Ù…Ø«Ø§Ù„: 100000">
  <button onclick="applyBudget()">Ù…ØªØ§Ø¨Ø¹Ø©</button>
  <button class="close-btn" onclick="closeBudget()">Ø¥Ù„ØºØ§Ø¡</button>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<script>
const firebaseConfig={
  apiKey:"AIzaSyAl3XunFOwHpGw-4_VYyETMtoLgk4mnRpQ",
  authDomain:"a3len-3ad54.firebaseapp.com",
  databaseURL:"https://a3len-3ad54-default-rtdb.firebaseio.com",
  projectId:"a3len-3ad54",
  storageBucket:"a3len-3ad54.firebasestorage.app",
  messagingSenderId:"767338034080",
  appId:"1:767338034080:web:801d77fb74c0aa56e92ac5"
};
firebase.initializeApp(firebaseConfig);
firebase.auth().signInAnonymously();

const db=firebase.database();
let userUID=null;
firebase.auth().onAuthStateChanged(u=>{if(u)userUID=u.uid});

const categories=["CPU","GPU","RAM","Motherboard","Storage","Power Supply","Case","Cooler","Accessories"];
const iraqProvinces=[
 "Ø¨ØºØ¯Ø§Ø¯","Ø§Ù„Ø¨ØµØ±Ø©","Ù†ÙŠÙ†ÙˆÙ‰","Ø§Ù„Ø£Ù†Ø¨Ø§Ø±","ÙƒØ±Ø¨Ù„Ø§Ø¡","Ø§Ù„Ù†Ø¬Ù",
 "Ø°ÙŠ Ù‚Ø§Ø±","Ø¯ÙŠØ§Ù„Ù‰","ØµÙ„Ø§Ø­ Ø§Ù„Ø¯ÙŠÙ†","Ø¨Ø§Ø¨Ù„","ÙƒØ±ÙƒÙˆÙƒ","ÙˆØ§Ø³Ø·",
 "Ù…ÙŠØ³Ø§Ù†","Ø§Ù„Ù…Ø«Ù†Ù‰","Ø§Ù„Ù‚Ø§Ø¯Ø³ÙŠØ©","Ø£Ø±Ø¨ÙŠÙ„","Ø§Ù„Ø³Ù„ÙŠÙ…Ø§Ù†ÙŠØ©",
 "Ø¯Ù‡ÙˆÙƒ","Ø­Ù„Ø¨Ø¬Ø©"
];
let budget=null;

/* Sidebar */
function toggleSidebar(){
 document.querySelector(".sidebar").classList.toggle("active");
 document.querySelector(".overlay").classList.toggle("active");
}
function closeSidebar(){
 document.querySelector(".sidebar").classList.remove("active");
 document.querySelector(".overlay").classList.remove("active");
}

/* Home */
function showHome(){
 closeSidebar();
 document.getElementById("content").innerHTML=`
  <div class="search-bar">
    <input id="search" placeholder="ğŸ” Ø¨Ø­Ø«..." onkeyup="loadProducts()">
    <select id="cat" onchange="loadProducts()">
      <option value="">ÙƒÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</option>
      ${categories.map(c=>`<option>${c}</option>`).join("")}
    </select>
    <button class="budget-btn" onclick="showBudgetDialog()">Ù…ÙŠØ²Ø§Ù†ÙŠØªÙƒ ğŸ’°</button>
  </div>
  <div class="cards" id="products"></div>
 `;
 loadProducts();
}

/* Budget */
function showBudgetDialog(){budgetDialog.style.display="block"}
function closeBudget(){budgetDialog.style.display="none"}
function applyBudget(){
 const v=parseFloat(maxBudget.value);
 budget=!isNaN(v)?v:null;
 closeBudget();loadProducts();
}

/* Products */
function loadProducts(){
 const s=search.value.toLowerCase();
 const c=cat.value;
 db.ref("products").once("value",snap=>{
  const d=snap.val()||{};
  let arr=[];
  Object.keys(d).forEach(k=>{
   const p=d[k],price=parseFloat(p.price)||0;
   if((!c||p.category===c)&&p.name.toLowerCase().includes(s)){
    if(budget&&price>budget)return;
    arr.push({uid:p.uid,html:`
     <div class="card">
      <h3>${p.name}</h3>
      <span>${p.price} Ø¯.Ø¹</span>
      <div>${p.category} | ${p.province}</div>
      <div>ğŸ“ ${p.phone}</div>
      ${p.uid===userUID?`
      <button onclick="editProduct('${k}')">ØªØ¹Ø¯ÙŠÙ„</button>
      <button onclick="deleteProduct('${k}')">Ø­Ø°Ù</button>`:""}
     </div>`});
   }
  });
  if(userUID){
   arr=arr.sort(a=>a.uid===userUID?-1:1);
  }
  products.innerHTML=arr.map(x=>x.html).join("")||"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª";
 });
}

/* Publish */
function showPublish(p=null,k=null){
 closeSidebar();
 content.innerHTML=`
 <div class="form-box">
  <h2>${p?"ØªØ¹Ø¯ÙŠÙ„":"Ù†Ø´Ø± Ø¥Ø¹Ù„Ø§Ù†"}</h2>
  <input id="name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©" value="${p?p.name:""}">
  <input id="price" type="number" placeholder="Ø§Ù„Ø³Ø¹Ø±" value="${p?p.price:""}">
  <select id="category">${categories.map(c=>`<option ${p&&p.category===c?"selected":""}>${c}</option>`).join("")}</select>
  <input id="seller" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¨Ø§Ø¦Ø¹" value="${p?p.seller:""}">
  <input id="phone" type="tel" maxlength="11"
   placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (11 Ø±Ù‚Ù…)"
   value="${p?p.phone:""}"
   oninput="this.value=this.value.replace(/[^0-9]/g,'').slice(0,11)">
  <select id="province">
   <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</option>
   ${iraqProvinces.map(pr=>`<option ${p&&p.province===pr?"selected":""}>${pr}</option>`).join("")}
  </select>
  <select id="delivery">
   <option ${p&&p.delivery==="Ù†Ø¹Ù…"?"selected":""}>Ù†Ø¹Ù…</option>
   <option ${p&&p.delivery==="Ù„Ø§"?"selected":""}>Ù„Ø§</option>
  </select>
  <button onclick="save('${k||""}')">ğŸ’¾ Ø­ÙØ¸</button>
 </div>`;
}

/* Save with phone validation */
function save(k){
 const phone=document.getElementById("phone").value.trim();
 if(!/^\d{11}$/.test(phone)){
  alert("Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 11 Ø±Ù‚Ù… Ø¨Ø§Ù„Ø¶Ø¨Ø·");
  return;
 }
 const data={
  name:name.value,price:price.value,
  category:category.value,seller:seller.value,
  phone:phone,province:province.value,
  delivery:delivery.value,uid:userUID
 };
 const ref=k?db.ref("products/"+k):db.ref("products").push();
 ref.set(data).then(showHome);
}

function deleteProduct(k){
 if(confirm("Ø­Ø°Ù Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ØŸ"))
  db.ref("products/"+k).remove().then(loadProducts);
}
function editProduct(k){
 db.ref("products/"+k).once("value",s=>showPublish(s.val(),k));
}

showHome();
</script>
</body>
</html>
