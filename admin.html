<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø§Ù„Ù…Ø§Ù„Ùƒ | a3len</title>
    <style>
        @font-face {
            font-family: 'CustomFont';
            src: url('font.ttf') format('truetype');
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'CustomFont', sans-serif;
            background: #0f1115;
            color: #e5e7eb;
            min-height: 100vh;
            padding: 0;
            font-size: 14px;
        }
        
        /* Header */
        .admin-header {
            background: #0b0d12;
            padding: 12px 0;
            border-bottom: 1px solid #1f2937;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }
        
        .back-btn {
            color: #38bdf8;
            text-decoration: none;
            font-size: 14px;
            padding: 6px 12px;
            border-radius: 6px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
            background: rgba(56, 189, 248, 0.1);
            white-space: nowrap;
        }
        
        .back-btn:hover {
            background: rgba(56, 189, 248, 0.2);
        }
        
        .admin-logo {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .logo-icon {
            font-size: 24px;
            color: #8b5cf6;
        }
        
        .logo-text {
            color: #38bdf8;
            font-size: 18px;
            font-weight: bold;
        }
        
        .owner-badge {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
            padding: 3px 8px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: bold;
            margin-right: 5px;
        }
        
        /* Ø´Ø§Ø±Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚ */
        .verified-badge {
            display: inline-flex;
            align-items: center;
            background: #10b981;
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-right: 5px;
            vertical-align: middle;
        }
        
        .user-name-wrapper {
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        
        /* Search Bar */
        .admin-search {
            flex: 2;
            min-width: 200px;
            position: relative;
        }
        
        .search-input {
            width: 100%;
            padding: 10px 40px 10px 15px;
            background: #1f2937;
            border: 1px solid #374151;
            border-radius: 8px;
            color: #e5e7eb;
            font-family: inherit;
            font-size: 13px;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #38bdf8;
            box-shadow: 0 0 0 2px rgba(56, 189, 248, 0.1);
        }
        
        .search-btn {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #9ca3af;
            cursor: pointer;
            font-size: 14px;
        }
        
        /* Quick Actions */
        .quick-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        /* Main Container */
        .admin-container {
            max-width: 1400px;
            margin: 15px auto;
            padding: 0 15px;
        }
        
        /* Tabs Navigation */
        .admin-tabs {
            display: flex;
            background: #1c1f27;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #374151;
            overflow-x: auto;
            padding: 3px;
            -webkit-overflow-scrolling: touch;
        }
        
        .tab {
            padding: 12px 15px;
            background: none;
            border: none;
            color: #9ca3af;
            font-family: inherit;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 8px;
            border-radius: 6px;
            transition: all 0.2s;
            flex-shrink: 0;
        }
        
        .tab:hover {
            background: rgba(56, 189, 248, 0.1);
            color: #e5e7eb;
        }
        
        .tab.active {
            background: #38bdf8;
            color: #000;
            font-weight: bold;
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: #1c1f27;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #374151;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
            border-color: #38bdf8;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #38bdf8, #0ea5e9);
        }
        
        .stat-icon {
            font-size: 28px;
            margin-bottom: 12px;
        }
        
        .stat-number {
            color: #38bdf8;
            font-size: 30px;
            font-weight: bold;
            display: block;
            line-height: 1;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #9ca3af;
            font-size: 13px;
            display: block;
        }
        
        .stat-trend {
            font-size: 11px;
            margin-top: 8px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .trend-up {
            color: #10b981;
        }
        
        .trend-down {
            color: #ef4444;
        }
        
        /* Main Content */
        .admin-content {
            background: #1c1f27;
            border-radius: 10px;
            padding: 0;
            border: 1px solid #374151;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .content-header {
            padding: 20px;
            border-bottom: 1px solid #374151;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            justify-content: space-between;
        }
        
        .content-title {
            color: #38bdf8;
            font-size: 18px;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .content-controls {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .filter-select {
            background: #1f2937;
            border: 1px solid #374151;
            border-radius: 6px;
            padding: 8px 12px;
            color: #e5e7eb;
            font-family: inherit;
            font-size: 13px;
            min-width: 120px;
        }
        
        /* Tables */
        .table-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }
        
        .data-table th {
            background: #1f2937;
            padding: 15px;
            text-align: right;
            color: #38bdf8;
            font-weight: 600;
            font-size: 13px;
            border-bottom: 2px solid #374151;
            position: sticky;
            top: 0;
        }
        
        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #374151;
            font-size: 13px;
        }
        
        .data-table tr:hover {
            background: rgba(56, 189, 248, 0.05);
        }
        
        /* User Status Badges */
        .status-badge {
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: 500;
            display: inline-block;
        }
        
        .status-active {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }
        
        .status-suspended {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }
        
        .status-pending {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
        }
        
        .status-verified {
            background: rgba(139, 92, 246, 0.2);
            color: #8b5cf6;
        }
        
        /* Action Buttons */
        .action-btns {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 6px 12px;
            border-radius: 6px;
            font-family: inherit;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            white-space: nowrap;
        }
        
        .btn-sm {
            padding: 5px 10px;
            font-size: 11px;
        }
        
        .btn-xs {
            padding: 3px 6px;
            font-size: 10px;
        }
        
        .btn-primary {
            background: #38bdf8;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0ea5e9;
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        
        .btn-danger:hover {
            background: #dc2626;
        }
        
        .btn-success {
            background: #10b981;
            color: white;
        }
        
        .btn-success:hover {
            background: #059669;
        }
        
        .btn-warning {
            background: #f59e0b;
            color: white;
        }
        
        .btn-warning:hover {
            background: #d97706;
        }
        
        .btn-violet {
            background: #8b5cf6;
            color: white;
        }
        
        .btn-violet:hover {
            background: #7c3aed;
        }
        
        .btn-outline {
            background: transparent;
            border: 1px solid #374151;
            color: #9ca3af;
        }
        
        .btn-outline:hover {
            background: #1f2937;
            color: #e5e7eb;
        }
        
        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 15px;
        }
        
        .modal-content {
            background: #1c1f27;
            border-radius: 10px;
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid #374151;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.5);
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #374151;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            color: #38bdf8;
            font-size: 18px;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: #9ca3af;
            font-size: 22px;
            cursor: pointer;
            padding: 4px;
            line-height: 1;
        }
        
        .modal-close:hover {
            color: #ef4444;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid #374151;
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        /* Forms */
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-label {
            display: block;
            color: #9ca3af;
            font-size: 13px;
            margin-bottom: 6px;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 10px 12px;
            background: #1f2937;
            border: 1px solid #374151;
            border-radius: 6px;
            color: #e5e7eb;
            font-family: inherit;
            font-size: 13px;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #38bdf8;
            box-shadow: 0 0 0 2px rgba(56, 189, 248, 0.1);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }
        
        /* Activity Log */
        .activity-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .activity-item {
            padding: 12px;
            border-bottom: 1px solid #374151;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .activity-item:last-child {
            border-bottom: none;
        }
        
        .activity-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: #1f2937;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
        }
        
        .activity-content {
            flex: 1;
        }
        
        .activity-text {
            color: #e5e7eb;
            margin-bottom: 3px;
            font-size: 13px;
        }
        
        .activity-time {
            color: #9ca3af;
            font-size: 11px;
        }
        
        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 6px;
            padding: 15px;
            border-top: 1px solid #374151;
            flex-wrap: wrap;
        }
        
        .page-btn {
            padding: 6px 12px;
            background: #1f2937;
            border: 1px solid #374151;
            color: #e5e7eb;
            border-radius: 6px;
            cursor: pointer;
            font-family: inherit;
            font-size: 13px;
            min-width: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .page-btn:hover {
            background: #374151;
        }
        
        .page-btn.active {
            background: #38bdf8;
            color: #000;
            border-color: #38bdf8;
        }
        
        .page-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Loading */
        .loading {
            text-align: center;
            padding: 30px;
            color: #9ca3af;
        }
        
        .loading-spinner {
            width: 36px;
            height: 36px;
            border: 3px solid rgba(56, 189, 248, 0.2);
            border-top-color: #38bdf8;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Notifications */
        .notification {
            position: fixed;
            top: 15px;
            right: 15px;
            padding: 12px 16px;
            border-radius: 6px;
            color: white;
            font-weight: 500;
            z-index: 3000;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s ease;
            max-width: 350px;
            font-size: 13px;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .notification.success {
            background: #10b981;
            border-left: 3px solid #059669;
        }
        
        .notification.error {
            background: #ef4444;
            border-left: 3px solid #dc2626;
        }
        
        .notification.warning {
            background: #f59e0b;
            border-left: 3px solid #d97706;
        }
        
        .notification.info {
            background: #38bdf8;
            border-left: 3px solid #0ea5e9;
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ù‡Ø§ØªÙ */
        @media (min-width: 768px) {
            .form-row {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        @media (max-width: 480px) {
            .header-content {
                flex-direction: column;
                align-items: stretch;
            }
            
            .admin-search {
                width: 100%;
            }
            
            .admin-tabs {
                flex-direction: column;
            }
            
            .tab {
                width: 100%;
                justify-content: center;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .content-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .content-controls {
                width: 100%;
            }
            
            .filter-select {
                width: 100%;
            }
            
            .modal-content {
                margin: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Notifications -->
    <div id="notificationContainer"></div>
    
    <!-- Header -->
    <div class="admin-header">
        <div class="header-content">
            <div class="header-left">
                <a href="index.html" class="back-btn">
                    â† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                </a>
                <div class="admin-logo">
                    <div class="logo-icon">ğŸ‘‘</div>
                    <div class="logo-text">a3len</div>
                    <div class="owner-badge">Ø§Ù„Ù…Ø§Ù„Ùƒ</div>
                </div>
            </div>
            
            <div class="admin-search">
                <input type="text" class="search-input" id="globalSearch" 
                       placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†ØŒ Ø¥Ø¹Ù„Ø§Ù†Ø§ØªØŒ Ø£Ùˆ Ø£ÙŠ Ø´ÙŠØ¡..." 
                       onkeyup="handleGlobalSearch(event)">
                <button class="search-btn" onclick="performSearch()">ğŸ”</button>
            </div>
            
            <div class="quick-actions">
                <button class="btn btn-violet" onclick="refreshAllData()">
                    âŸ³ ØªØ­Ø¯ÙŠØ«
                </button>
                <button class="btn btn-success" onclick="exportData()">
                    ğŸ“¥ ØªØµØ¯ÙŠØ±
                </button>
                <button class="btn btn-danger" onclick="showSystemLogs()">
                    ğŸ“‹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª
                </button>
            </div>
        </div>
    </div>
    
    <!-- Main Container -->
    <div class="admin-container">
        <!-- Tabs -->
        <div class="admin-tabs">
            <button class="tab active" onclick="showTab('dashboard')">
                ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
            </button>
            <button class="tab" onclick="showTab('users')">
                ğŸ‘¥ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
            </button>
            <button class="tab" onclick="showTab('products')">
                ğŸ›’ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª
            </button>
            <button class="tab" onclick="showTab('reports')">
                âš ï¸ Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª
            </button>
            <button class="tab" onclick="showTab('settings')">
                âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            </button>
        </div>
        
        <!-- Stats Grid -->
        <div class="stats-grid" id="statsGrid">
            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
        </div>
        
        <!-- Main Content -->
        <div class="admin-content" id="adminContent">
            <!-- Ù…Ø­ØªÙˆÙ‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
            <div class="loading" id="loadingContent">
                <div class="loading-spinner"></div>
                <div>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…...</div>
            </div>
        </div>
    </div>
    
    <!-- Modals -->
    <div class="modal-overlay" id="userModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ğŸ‘¤ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h3>
                <button class="modal-close" onclick="closeUserModal()">Ã—</button>
            </div>
            <div class="modal-body" id="userModalBody">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeUserModal()">Ø¥ØºÙ„Ø§Ù‚</button>
                <button class="btn btn-danger" id="deleteUserBtn">Ø­Ø°Ù</button>
                <button class="btn btn-primary" id="saveUserBtn">Ø­ÙØ¸</button>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="productModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ğŸ›’ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</h3>
                <button class="modal-close" onclick="closeProductModal()">Ã—</button>
            </div>
            <div class="modal-body" id="productModalBody">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeProductModal()">Ø¥ØºÙ„Ø§Ù‚</button>
                <button class="btn btn-danger" id="deleteProductBtn">Ø­Ø°Ù</button>
                <button class="btn btn-primary" id="saveProductBtn">Ø­ÙØ¸</button>
            </div>
        </div>
    </div>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    
    <script>
        // ØªÙƒÙˆÙŠÙ† Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAl3XunFOwHpGw-4_VYyETMtoLgk4mnRpQ",
            authDomain: "a3len-3ad54.firebasestorage.app",
            databaseURL: "https://a3len-3ad54-default-rtdb.firebaseio.com",
            projectId: "a3len-3ad54",
            storageBucket: "a3len-3ad54.firebasestorage.app",
            messagingSenderId: "767338034080",
            appId: "1:767338034080:web:801d77fb74c0aa56e92ac5"
        };
        
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        
        const db = firebase.database();
        const auth = firebase.auth();
        
        // Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø©
        let currentUser = null;
        let isSuperAdmin = false;
        let allUsers = {};
        let allProducts = {};
        let currentTab = 'dashboard';
        
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', function() {
            checkAdminPermissions();
            setupEventListeners();
        });
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù…Ø¯ÙŠØ±
        function checkAdminPermissions() {
            auth.onAuthStateChanged((user) => {
                if (user) {
                    currentUser = user;
                    
                    db.ref('users/' + user.uid).once('value', (snapshot) => {
                        const userData = snapshot.val();
                        
                        if (userData && userData.isAdmin) {
                            isSuperAdmin = true;
                            loadDashboard();
                        } else {
                            showNotification('Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©', 'error');
                            setTimeout(() => {
                                window.location.href = 'index.html';
                            }, 2000);
                        }
                    });
                } else {
                    showNotification('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'error');
                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 1500);
                }
            });
        }
        
        // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        function setupEventListeners() {
            document.getElementById('globalSearch').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    performSearch();
                }
            });
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
        function loadDashboard() {
            showLoading();
            
            Promise.all([
                db.ref('users').once('value'),
                db.ref('products').once('value'),
                db.ref('reports').once('value'),
                db.ref('systemLogs').limitToLast(20).once('value')
            ]).then(([usersSnap, productsSnap, reportsSnap, logsSnap]) => {
                allUsers = usersSnap.val() || {};
                allProducts = productsSnap.val() || {};
                
                const stats = calculateStatistics(usersSnap, productsSnap, reportsSnap);
                displayStats(stats);
                displayDashboardContent(usersSnap, productsSnap, logsSnap);
            }).catch(error => {
                console.error('Error loading dashboard:', error);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
            });
        }
        
        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        function calculateStatistics(usersSnap, productsSnap, reportsSnap) {
            const users = usersSnap.val() || {};
            const products = productsSnap.val() || {};
            const reports = reportsSnap.val() || {};
            
            const totalUsers = Object.keys(users).length;
            const totalProducts = Object.keys(products).length;
            const totalReports = Object.keys(reports).length;
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø¹Ø© ÙˆØ§Ù„Ù…Ø­Ø¬ÙˆØ²Ø©
            let soldProducts = 0;
            let reservedProducts = 0;
            let activeProducts = 0;
            
            Object.values(products).forEach(product => {
                if (product.status === 'sold') soldProducts++;
                else if (product.status === 'reserved') reservedProducts++;
                else if (product.status === 'available') activeProducts++;
            });
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ† Ø§Ù„ÙŠÙˆÙ…
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            let activeToday = 0;
            
            Object.values(users).forEach(user => {
                if (user.lastActive && new Date(user.lastActive) >= today) {
                    activeToday++;
                }
            });
            
            return {
                totalUsers,
                totalProducts,
                totalReports,
                soldProducts,
                reservedProducts,
                activeProducts,
                activeToday
            };
        }
        
        // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        function displayStats(stats) {
            const statsGrid = document.getElementById('statsGrid');
            
            statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-icon">ğŸ‘¥</div>
                    <span class="stat-number">${stats.totalUsers}</span>
                    <span class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</span>
                    <div class="stat-trend trend-up">
                        <span>${stats.activeToday} Ù†Ø´Ø·ÙŠÙ† Ø§Ù„ÙŠÙˆÙ…</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">ğŸ›’</div>
                    <span class="stat-number">${stats.totalProducts}</span>
                    <span class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</span>
                    <div class="stat-trend">
                        <span>${stats.activeProducts} Ù…ØªØ§Ø­</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">ğŸ’°</div>
                    <span class="stat-number">${stats.soldProducts}</span>
                    <span class="stat-label">Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù…Ø¨Ø§Ø¹Ø©</span>
                    <div class="stat-trend trend-up">
                        <span>${stats.reservedProducts} Ù…Ø­Ø¬ÙˆØ²</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">âš ï¸</div>
                    <span class="stat-number">${stats.totalReports}</span>
                    <span class="stat-label">Ø¨Ù„Ø§ØºØ§Øª Ù…Ø¹Ù„Ù‚Ø©</span>
                    <div class="stat-trend">
                        <span>Ø¨Ø­Ø§Ø¬Ø© Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</span>
                    </div>
                </div>
            `;
        }
        
        // Ø¹Ø±Ø¶ Ù…Ø­ØªÙˆÙ‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
        function displayDashboardContent(usersSnap, productsSnap, logsSnap) {
            const users = usersSnap.val() || {};
            const products = productsSnap.val() || {};
            const logs = logsSnap.val() || {};
            
            const recentUsers = Object.entries(users)
                .sort(([,a], [,b]) => (b.createdAt || 0) - (a.createdAt || 0))
                .slice(0, 5);
            
            const recentProducts = Object.entries(products)
                .sort(([,a], [,b]) => (b.timestamp || 0) - (a.timestamp || 0))
                .slice(0, 5);
            
            const content = document.getElementById('adminContent');
            
            content.innerHTML = `
                <div class="content-header">
                    <h3 class="content-title">ğŸ“Š Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
                </div>
                
                <div class="content-body" style="padding: 20px;">
                    <div style="display: grid; grid-template-columns: 1fr; gap: 20px; margin-bottom: 20px;">
                        <div>
                            <h4 style="color: #38bdf8; margin-bottom: 12px;">ğŸ‘¤ Ø¢Ø®Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†</h4>
                            <div class="table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Ø§Ù„Ø§Ø³Ù…</th>
                                            <th>Ø§Ù„Ø¨Ø±ÙŠØ¯</th>
                                            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${recentUsers.map(([userId, user]) => `
                                            <tr>
                                                <td>
                                                    <span class="user-name-wrapper">
                                                        ${user.isVerified ? '<span class="verified-badge">âœ“</span>' : ''}
                                                        ${user.fullName || user.username || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…'}
                                                    </span>
                                                </td>
                                                <td>${user.email || 'Ø¨Ø¯ÙˆÙ† Ø¨Ø±ÙŠØ¯'}</td>
                                                <td>${user.createdAt ? formatDate(user.createdAt) : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</td>
                                                <td>
                                                    <button class="btn btn-xs btn-primary" onclick="viewUserDetails('${userId}')">
                                                        Ø¹Ø±Ø¶
                                                    </button>
                                                </td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div>
                            <h4 style="color: #38bdf8; margin-bottom: 12px;">ğŸ›’ Ø¢Ø®Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø¶Ø§ÙØ©</h4>
                            <div class="table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Ø§Ù„Ø§Ø³Ù…</th>
                                            <th>Ø§Ù„Ø³Ø¹Ø±</th>
                                            <th>Ø§Ù„Ø¨Ø§Ø¦Ø¹</th>
                                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${recentProducts.map(([productId, product]) => {
                                            const seller = allUsers[product.uid] || {};
                                            return `
                                                <tr>
                                                    <td>${product.name || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…'}</td>
                                                    <td>${product.price ? parseInt(product.price).toLocaleString('ar-SA') + ' Ø¯.Ø¹' : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                                                    <td>
                                                        <span class="user-name-wrapper">
                                                            ${seller.isVerified ? '<span class="verified-badge">âœ“</span>' : ''}
                                                            ${seller.fullName || seller.username || product.seller || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}
                                                        </span>
                                                    </td>
                                                    <td>
                                                        <button class="btn btn-xs btn-primary" onclick="viewProductDetails('${productId}')">
                                                            Ø¹Ø±Ø¶
                                                        </button>
                                                    </td>
                                                </tr>
                                            `;
                                        }).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            hideLoading();
        }
        
        // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
        function showTab(tabName) {
            currentTab = tabName;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`.tab[onclick*="${tabName}"]`).classList.add('active');
            
            // ØªØ­Ù…ÙŠÙ„ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¨ÙˆÙŠØ¨
            switch(tabName) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'users':
                    loadUsersManagement();
                    break;
                case 'products':
                    loadProductsManagement();
                    break;
                case 'reports':
                    loadReports();
                    break;
                case 'settings':
                    loadSettings();
                    break;
            }
        }
        
        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        function loadUsersManagement() {
            showLoading();
            
            db.ref('users').once('value').then(snapshot => {
                const users = snapshot.val() || {};
                allUsers = users;
                
                const content = document.getElementById('adminContent');
                
                content.innerHTML = `
                    <div class="content-header">
                        <h3 class="content-title">ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† (${Object.keys(users).length} Ù…Ø³ØªØ®Ø¯Ù…)</h3>
                        <div class="content-controls">
                            <select class="filter-select" id="userFilter" onchange="filterUsers()">
                                <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</option>
                                <option value="verified">Ø§Ù„Ù…ÙˆØ«Ù‘Ù‚ÙŠÙ† ÙÙ‚Ø·</option>
                                <option value="admin">Ø§Ù„Ù…Ø¯ÙŠØ±ÙŠÙ† ÙÙ‚Ø·</option>
                            </select>
                            <input type="text" class="form-control" id="userSearch" 
                                   placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯..." 
                                   style="width: 200px;" onkeyup="searchUsers()">
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                                    <th>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„</th>
                                    <th>Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</th>
                                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody">
                                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
                            </tbody>
                        </table>
                    </div>
                `;
                
                displayUsersTable(users);
                hideLoading();
            });
        }
        
        // Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        function displayUsersTable(users, filteredUsers = null) {
            const tbody = document.getElementById('usersTableBody');
            const usersToDisplay = filteredUsers || Object.entries(users);
            
            tbody.innerHTML = usersToDisplay.map(([userId, user]) => {
                const username = user.username || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…';
                const fullName = user.fullName || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                const email = user.email || 'Ø¨Ø¯ÙˆÙ† Ø¨Ø±ÙŠØ¯';
                const phone = user.phone || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                const productCount = user.totalProducts || 0;
                const isAdmin = user.isAdmin || false;
                const isVerified = user.isVerified || false;
                const lastActive = user.lastActive ? formatDateTime(user.lastActive) : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                const createdAt = user.createdAt ? formatDate(user.createdAt) : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                
                return `
                    <tr data-user-id="${userId}">
                        <td>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <div style="width: 36px; height: 36px; background: #38bdf8; border-radius: 50%; 
                                            display: flex; align-items: center; justify-content: center; 
                                            color: white; font-weight: bold; font-size: 14px;">
                                    ${(fullName || username).charAt(0).toUpperCase()}
                                </div>
                                <div>
                                    <div style="font-weight: 500; font-size: 13px;">
                                        <span class="user-name-wrapper">
                                            ${isVerified ? '<span class="verified-badge">âœ“</span>' : ''}
                                            ${fullName}
                                            ${isAdmin ? '<span style="color:#8b5cf6; font-size:11px;">ğŸ‘‘</span>' : ''}
                                        </span>
                                    </div>
                                    <div style="color: #9ca3af; font-size: 11px;">@${username}</div>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div style="font-size: 12px;">
                                <div>${email}</div>
                                <div style="color: #9ca3af; margin-top: 2px;">${phone}</div>
                                <div style="color: #9ca3af; font-size: 11px; margin-top: 2px;">${createdAt}</div>
                            </div>
                        </td>
                        <td>
                            <div style="display: flex; gap: 12px;">
                                <div style="text-align: center;">
                                    <div style="color: #38bdf8; font-weight: bold; font-size: 16px;">${productCount}</div>
                                    <div style="font-size: 10px; color: #9ca3af;">Ø¥Ø¹Ù„Ø§Ù†</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="color: #10b981; font-weight: bold; font-size: 16px;">${user.followersCount || 0}</div>
                                    <div style="font-size: 10px; color: #9ca3af;">Ù…ØªØ§Ø¨Ø¹</div>
                                </div>
                            </div>
                        </td>
                        <td>
                            ${isVerified ? 
                                '<span class="status-badge status-verified">Ù…ÙˆØ«Ù‘Ù‚</span>' : 
                                '<span class="status-badge status-pending">ØºÙŠØ± Ù…ÙˆØ«Ù‘Ù‚</span>'
                            }
                            <div style="margin-top: 3px; font-size: 10px; color: #9ca3af;">
                                ${lastActive}
                            </div>
                        </td>
                        <td>
                            <div class="action-btns">
                                <button class="btn btn-xs btn-primary" onclick="viewUserDetails('${userId}')">
                                    Ø¹Ø±Ø¶
                                </button>
                                ${isVerified ?
                                    '<button class="btn btn-xs btn-danger" onclick="toggleVerification(\'' + userId + '\', false)">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªÙˆØ«ÙŠÙ‚</button>' :
                                    '<button class="btn btn-xs btn-success" onclick="toggleVerification(\'' + userId + '\', true)">ØªÙˆØ«ÙŠÙ‚</button>'
                                }
                                ${isAdmin ? 
                                    '<button class="btn btn-xs btn-danger" onclick="toggleAdminStatus(\'' + userId + '\', false)">Ø³Ø­Ø¨ Ø§Ù„Ù…Ø¯ÙŠØ±</button>' :
                                    '<button class="btn btn-xs btn-success" onclick="toggleAdminStatus(\'' + userId + '\', true)">Ù…Ù†Ø­ Ø§Ù„Ù…Ø¯ÙŠØ±</button>'
                                }
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        // Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ù…ÙˆØ¯Ø§Ù„
        function viewUserDetails(userId) {
            db.ref('users/' + userId).once('value').then(snapshot => {
                const user = snapshot.val();
                if (!user) {
                    showNotification('Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
                    return;
                }
                
                const modalBody = document.getElementById('userModalBody');
                const fullName = user.fullName || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                const username = user.username || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…';
                const email = user.email || 'Ø¨Ø¯ÙˆÙ† Ø¨Ø±ÙŠØ¯';
                const phone = user.phone || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                const bio = user.bio || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ Ø´Ø®ØµÙŠ';
                const createdAt = user.createdAt ? formatDateTime(user.createdAt) : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                const lastActive = user.lastActive ? formatDateTime(user.lastActive) : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                const isAdmin = user.isAdmin || false;
                const isVerified = user.isVerified || false;
                
                // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                db.ref('products').orderByChild('uid').equalTo(userId).once('value').then(productsSnap => {
                    const userProducts = productsSnap.val() || {};
                    const productCount = Object.keys(userProducts).length;
                    
                    modalBody.innerHTML = `
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <div style="text-align: center;">
                                    <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #38bdf8, #0ea5e9); 
                                                border-radius: 50%; margin: 0 auto 10px; display: flex; align-items: center; 
                                                justify-content: center; color: white; font-size: 32px; font-weight: bold;">
                                        ${fullName.charAt(0).toUpperCase()}
                                    </div>
                                </div>
                            </div>
                            <div>
                                <label class="form-label">Ø§Ù„Ø­Ø§Ù„Ø©</label>
                                <div style="display: flex; gap: 8px; margin-top: 5px;">
                                    ${isVerified ? 
                                        '<span class="verified-badge" style="font-size:11px;">âœ“ Ù…ÙˆØ«Ù‘Ù‚</span>' : 
                                        '<button class="btn btn-xs btn-success" onclick="toggleVerification(\'' + userId + '\', true)">ØªÙˆØ«ÙŠÙ‚</button>'
                                    }
                                    ${isAdmin ? 
                                        '<span style="background: rgba(139, 92, 246, 0.2); color: #8b5cf6; padding: 3px 8px; border-radius: 10px; font-size: 11px;">Ù…Ø¯ÙŠØ±</span>' : 
                                        '<button class="btn btn-xs btn-success" onclick="toggleAdminStatus(\'' + userId + '\', true)">Ù…Ù†Ø­ Ø§Ù„Ù…Ø¯ÙŠØ±</button>'
                                    }
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                                <input type="text" class="form-control" id="editFullName" value="${fullName}">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                                <input type="text" class="form-control" id="editUsername" value="${username}">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                                <input type="email" class="form-control" id="editEmail" value="${email}">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                                <input type="tel" class="form-control" id="editPhone" value="${phone}">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„ÙˆØµÙ Ø§Ù„Ø´Ø®ØµÙŠ</label>
                            <textarea class="form-control" id="editBio" rows="2">${bio}</textarea>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„</label>
                                <input type="text" class="form-control" value="${createdAt}" readonly>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø¢Ø®Ø± Ù†Ø´Ø§Ø·</label>
                                <input type="text" class="form-control" value="${lastActive}" readonly>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</label>
                                <input type="text" class="form-control" value="${productCount} Ø¥Ø¹Ù„Ø§Ù†" readonly>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                                <input type="text" class="form-control" value="${userId}" readonly>
                            </div>
                        </div>
                    `;
                    
                    // Ø¥Ø¹Ø¯Ø§Ø¯ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
                    document.getElementById('deleteUserBtn').onclick = () => deleteUser(userId);
                    document.getElementById('saveUserBtn').onclick = () => saveUserChanges(userId);
                    
                    // ÙØªØ­ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
                    document.getElementById('userModal').style.display = 'flex';
                });
            });
        }
        
        // Ø­ÙØ¸ ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        function saveUserChanges(userId) {
            const updates = {
                fullName: document.getElementById('editFullName').value.trim(),
                username: document.getElementById('editUsername').value.trim(),
                email: document.getElementById('editEmail').value.trim(),
                phone: document.getElementById('editPhone').value.trim(),
                bio: document.getElementById('editBio').value.trim(),
                lastUpdated: Date.now()
            };
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
            if (!updates.username || !updates.email) {
                showNotification('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø·Ù„ÙˆØ¨Ø§Ù†', 'error');
                return;
            }
            
            db.ref('users/' + userId).update(updates).then(() => {
                showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­', 'success');
                closeUserModal();
                loadUsersManagement();
            }).catch(error => {
                console.error('Error updating user:', error);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
            });
        }
        
        // Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        function deleteUser(userId) {
            if (confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø¥Ø¹Ù„Ø§Ù†Ø§ØªÙ‡ ÙˆØªÙ‚ÙŠÙŠÙ…Ø§ØªÙ‡ ÙˆÙ…ØªØ§Ø¨Ø¹Ø§ØªÙ‡. Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡!')) {
                showLoading();
                
                // Ø­Ø°Ù Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£ÙˆÙ„Ø§Ù‹
                db.ref('products').orderByChild('uid').equalTo(userId).once('value', (snapshot) => {
                    const products = snapshot.val();
                    const deletePromises = [];
                    
                    if (products) {
                        Object.keys(products).forEach(productId => {
                            deletePromises.push(db.ref('products/' + productId).remove());
                        });
                    }
                    
                    // Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                    deletePromises.push(db.ref('users/' + userId).remove());
                    
                    Promise.all(deletePromises).then(() => {
                        showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ¨ÙŠØ§Ù†Ø§ØªÙ‡ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                        closeUserModal();
                        loadUsersManagement();
                        hideLoading();
                    }).catch(error => {
                        console.error('Error deleting user:', error);
                        showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', 'error');
                        hideLoading();
                    });
                });
            }
        }
        
        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª
        function loadProductsManagement() {
            showLoading();
            
            db.ref('products').once('value').then(snapshot => {
                allProducts = snapshot.val() || {};
                
                const content = document.getElementById('adminContent');
                
                content.innerHTML = `
                    <div class="content-header">
                        <h3 class="content-title">ğŸ›’ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª (${Object.keys(allProducts).length} Ø¥Ø¹Ù„Ø§Ù†)</h3>
                        <div class="content-controls">
                            <select class="filter-select" id="productFilter" onchange="filterProducts()">
                                <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</option>
                                <option value="available">Ø§Ù„Ù…ØªØ§Ø­Ø© ÙÙ‚Ø·</option>
                                <option value="sold">Ø§Ù„Ù…Ø¨Ø§Ø¹Ø©</option>
                                <option value="reserved">Ø§Ù„Ù…Ø­Ø¬ÙˆØ²Ø©</option>
                            </select>
                            <input type="text" class="form-control" id="productSearch" 
                                   placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©..." 
                                   style="width: 200px;" onkeyup="searchProducts()">
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</th>
                                    <th>Ø§Ù„Ø³Ø¹Ø±</th>
                                    <th>Ø§Ù„Ø¨Ø§Ø¦Ø¹</th>
                                    <th>Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</th>
                                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody id="productsTableBody">
                                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
                            </tbody>
                        </table>
                    </div>
                `;
                
                displayProductsTable(allProducts);
                hideLoading();
            });
        }
        
        // Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª
        function displayProductsTable(products, filteredProducts = null) {
            const tbody = document.getElementById('productsTableBody');
            const productsToDisplay = filteredProducts || Object.entries(products);
            
            tbody.innerHTML = productsToDisplay.map(([productId, product]) => {
                const price = product.price ? parseInt(product.price).toLocaleString('ar-SA') + ' Ø¯.Ø¹' : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                const seller = allUsers[product.uid] || {};
                const sellerName = seller.fullName || seller.username || product.seller || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                const isVerified = seller.isVerified || false;
                const date = product.timestamp ? formatDate(product.timestamp) : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                
                return `
                    <tr data-product-id="${productId}">
                        <td>
                            <div style="font-weight: 500; font-size: 13px;">${product.name || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…'}</div>
                            <div style="color: #9ca3af; font-size: 11px;">${product.category || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                        </td>
                        <td style="font-weight: bold; color: #38bdf8; font-size: 14px;">
                            ${price}
                        </td>
                        <td>
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <div style="width: 28px; height: 28px; background: #10b981; border-radius: 50%; 
                                            display: flex; align-items: center; justify-content: center; 
                                            color: white; font-size: 11px; font-weight: bold;">
                                    ${sellerName.charAt(0).toUpperCase()}
                                </div>
                                <div>
                                    <div style="font-size: 12px;">
                                        <span class="user-name-wrapper">
                                            ${isVerified ? '<span class="verified-badge" style="font-size:9px;">âœ“</span>' : ''}
                                            ${sellerName}
                                        </span>
                                    </div>
                                    <div style="font-size: 10px; color: #9ca3af;">${product.phone || 'Ø¨Ø¯ÙˆÙ† Ø±Ù‚Ù…'}</div>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div style="font-size: 11px;">
                                <div><strong>Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©:</strong> ${product.province || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                                <div><strong>Ø§Ù„ØªÙˆØµÙŠÙ„:</strong> ${product.delivery || 'Ù„Ø§'}</div>
                                <div style="color: #9ca3af; font-size: 10px;">${date}</div>
                            </div>
                        </td>
                        <td>
                            <span class="status-badge status-${product.status || 'available'}">
                                ${getStatusText(product.status || 'available')}
                            </span>
                            <div style="margin-top: 3px;">
                                <select class="form-control" style="padding: 2px 6px; font-size: 11px; width: 80px;" 
                                        onchange="updateProductStatus('${productId}', this.value)">
                                    <option value="available" ${product.status === 'available' ? 'selected' : ''}>Ù…ØªØ§Ø­</option>
                                    <option value="sold" ${product.status === 'sold' ? 'selected' : ''}>Ù…Ø¨Ø§Ø¹</option>
                                    <option value="reserved" ${product.status === 'reserved' ? 'selected' : ''}>Ù…Ø­Ø¬ÙˆØ²</option>
                                </select>
                            </div>
                        </td>
                        <td>
                            <div class="action-btns">
                                <button class="btn btn-xs btn-primary" onclick="viewProductDetails('${productId}')">
                                    Ø¹Ø±Ø¶
                                </button>
                                <button class="btn btn-xs btn-danger" onclick="deleteSingleProduct('${productId}')">
                                    Ø­Ø°Ù
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        // Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† ÙÙŠ Ù…ÙˆØ¯Ø§Ù„
        function viewProductDetails(productId) {
            db.ref('products/' + productId).once('value').then(snapshot => {
                const product = snapshot.val();
                if (!product) {
                    showNotification('Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
                    return;
                }
                
                const seller = allUsers[product.uid] || {};
                const modalBody = document.getElementById('productModalBody');
                
                modalBody.innerHTML = `
                    <div class="form-group">
                        <label class="form-label">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</label>
                        <input type="text" class="form-control" id="editProductName" value="${product.name || ''}">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ø³Ø¹Ø± (Ø¯ÙŠÙ†Ø§Ø± Ø¹Ø±Ø§Ù‚ÙŠ)</label>
                            <input type="number" class="form-control" id="editProductPrice" value="${product.price || ''}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ù‚Ø³Ù…</label>
                            <select class="form-control" id="editProductCategory">
                                <option ${product.category === 'CPU' ? 'selected' : ''}>CPU</option>
                                <option ${product.category === 'GPU' ? 'selected' : ''}>GPU</option>
                                <option ${product.category === 'RAM' ? 'selected' : ''}>RAM</option>
                                <option ${product.category === 'Motherboard' ? 'selected' : ''}>Motherboard</option>
                                <option ${product.category === 'Storage' ? 'selected' : ''}>Storage</option>
                                <option ${product.category === 'Power Supply' ? 'selected' : ''}>Power Supply</option>
                                <option ${product.category === 'Case' ? 'selected' : ''}>Case</option>
                                <option ${product.category === 'Cooler' ? 'selected' : ''}>Cooler</option>
                                <option ${product.category === 'Accessories' ? 'selected' : ''}>Accessories</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ø¨Ø§Ø¦Ø¹</label>
                            <div class="form-control" style="background:#374151; color:#9ca3af;">
                                <span class="user-name-wrapper">
                                    ${seller.isVerified ? '<span class="verified-badge" style="font-size:9px;">âœ“</span>' : ''}
                                    ${seller.fullName || seller.username || product.seller || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}
                                </span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø§Ù„Ø¨Ø§Ø¦Ø¹</label>
                            <input type="tel" class="form-control" id="editProductPhone" value="${product.phone || ''}">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</label>
                            <input type="text" class="form-control" id="editProductProvince" value="${product.province || ''}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„ØªÙˆØµÙŠÙ„</label>
                            <select class="form-control" id="editProductDelivery">
                                <option value="Ù†Ø¹Ù…" ${product.delivery === 'Ù†Ø¹Ù…' ? 'selected' : ''}>Ù†Ø¹Ù…</option>
                                <option value="Ù„Ø§" ${product.delivery === 'Ù„Ø§' ? 'selected' : ''}>Ù„Ø§</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</label>
                            <select class="form-control" id="editProductStatus">
                                <option value="available" ${product.status === 'available' ? 'selected' : ''}>Ù…ØªØ§Ø­</option>
                                <option value="sold" ${product.status === 'sold' ? 'selected' : ''}>Ù…Ø¨Ø§Ø¹</option>
                                <option value="reserved" ${product.status === 'reserved' ? 'selected' : ''}>Ù…Ø­Ø¬ÙˆØ²</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ø´Ø±</label>
                            <input type="text" class="form-control" value="${product.timestamp ? formatDateTime(product.timestamp) : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}" readonly>
                        </div>
                    </div>
                `;
                
                document.getElementById('deleteProductBtn').onclick = () => deleteSingleProduct(productId);
                document.getElementById('saveProductBtn').onclick = () => saveProductChanges(productId);
                
                document.getElementById('productModal').style.display = 'flex';
            });
        }
        
        // Ø­ÙØ¸ ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†
        function saveProductChanges(productId) {
            const updates = {
                name: document.getElementById('editProductName').value.trim(),
                price: parseInt(document.getElementById('editProductPrice').value) || 0,
                category: document.getElementById('editProductCategory').value,
                phone: document.getElementById('editProductPhone').value.trim(),
                province: document.getElementById('editProductProvince').value.trim(),
                delivery: document.getElementById('editProductDelivery').value,
                status: document.getElementById('editProductStatus').value,
                lastUpdated: Date.now()
            };
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            if (!updates.name || updates.price <= 0) {
                showNotification('Ø§Ø³Ù… Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† ÙˆØ§Ù„Ø³Ø¹Ø± Ù…Ø·Ù„ÙˆØ¨Ø§Ù†', 'error');
                return;
            }
            
            db.ref('products/' + productId).update(updates).then(() => {
                showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø¨Ù†Ø¬Ø§Ø­', 'success');
                closeProductModal();
                loadProductsManagement();
            }).catch(error => {
                console.error('Error updating product:', error);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†', 'error');
            });
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª
        function loadReports() {
            showLoading();
            
            const content = document.getElementById('adminContent');
            
            content.innerHTML = `
                <div class="content-header">
                    <h3 class="content-title">âš ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª</h3>
                    <div class="content-controls">
                        <select class="filter-select" id="reportFilter">
                            <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª</option>
                            <option value="pending">Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©</option>
                            <option value="resolved">Ø§Ù„Ù…Ø­Ù„ÙˆÙ„Ø©</option>
                        </select>
                    </div>
                </div>
                
                <div style="padding: 20px; text-align: center; color: #9ca3af;">
                    <div style="font-size: 48px; margin-bottom: 10px;">ğŸ“‹</div>
                    <div>Ø®Ø§ØµÙŠØ© Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±</div>
                    <div style="font-size: 12px; margin-top: 10px;">Ø³ØªØªÙˆÙØ± ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</div>
                </div>
            `;
            
            hideLoading();
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
        function loadSettings() {
            const content = document.getElementById('adminContent');
            
            content.innerHTML = `
                <div class="content-header">
                    <h3 class="content-title">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
                </div>
                
                <div class="content-body" style="padding: 20px;">
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #38bdf8; margin-bottom: 15px;">ğŸ”’ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†</h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr; gap: 15px;">
                            <button class="btn btn-success" onclick="toggleFeature('twoFactor', true)">
                                ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ø®Ø·ÙˆØªÙŠÙ†
                            </button>
                            <button class="btn btn-danger" onclick="toggleFeature('twoFactor', false)">
                                ØªØ¹Ø·ÙŠÙ„ Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ø®Ø·ÙˆØªÙŠÙ†
                            </button>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #38bdf8; margin-bottom: 15px;">ğŸ—‘ï¸ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr; gap: 10px;">
                            <button class="btn btn-danger" onclick="clearCache()">
                                ğŸ§¹ Ù…Ø³Ø­ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø¤Ù‚ØªØ©
                            </button>
                            <button class="btn btn-primary" onclick="exportData()">
                                ğŸ’¾ Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
                            </button>
                        </div>
                    </div>
                    
                    <div>
                        <h4 style="color: #38bdf8; margin-bottom: 15px;">ğŸ“Š Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h4>
                        <div style="background: #1f2937; padding: 15px; border-radius: 8px; font-size: 13px;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <div>
                                    <div style="color: #9ca3af;">Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù…</div>
                                    <div style="color: #38bdf8; font-weight: bold;">a3len v2.0</div>
                                </div>
                                <div>
                                    <div style="color: #9ca3af">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«</div>
                                    <div style="color: #38bdf8; font-weight: bold;">${formatDate(Date.now())}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            hideLoading();
        }
        
        // ========================================
        // Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø©
        // ========================================
        
        function showNotification(message, type = 'info') {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <span>${type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : type === 'warning' ? 'âš ï¸' : 'â„¹ï¸'}</span>
                <span>${message}</span>
            `;
            
            container.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 4000);
        }
        
        function showLoading() {
            document.getElementById('loadingContent').style.display = 'block';
        }
        
        function hideLoading() {
            document.getElementById('loadingContent').style.display = 'none';
        }
        
        function closeUserModal() {
            document.getElementById('userModal').style.display = 'none';
        }
        
        function closeProductModal() {
            document.getElementById('productModal').style.display = 'none';
        }
        
        function getStatusText(status) {
            const statuses = {
                'available': 'Ù…ØªØ§Ø­',
                'sold': 'Ù…Ø¨Ø§Ø¹',
                'reserved': 'Ù…Ø­Ø¬ÙˆØ²'
            };
            return statuses[status] || status;
        }
        
        function formatDate(timestamp) {
            if (!timestamp) return 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
            const date = new Date(timestamp);
            return date.toLocaleDateString('ar-SA');
        }
        
        function formatDateTime(timestamp) {
            if (!timestamp) return 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
            const date = new Date(timestamp);
            return date.toLocaleString('ar-SA', {
                year: 'numeric',
                month: 'numeric',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        // ========================================
        // Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­ÙƒÙ…
        // ========================================
        
        function toggleAdminStatus(userId, makeAdmin) {
            const action = makeAdmin ? 'Ù…Ù†Ø­ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù…Ø¯ÙŠØ±' : 'Ø³Ø­Ø¨ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù…Ø¯ÙŠØ±';
            if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ${action}ØŸ`)) {
                db.ref('users/' + userId).update({
                    isAdmin: makeAdmin,
                    lastUpdated: Date.now()
                }).then(() => {
                    const message = makeAdmin ? 'ØªÙ… Ù…Ù†Ø­ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù…Ø¯ÙŠØ±' : 'ØªÙ… Ø³Ø­Ø¨ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù…Ø¯ÙŠØ±';
                    showNotification(message, 'success');
                    loadUsersManagement();
                });
            }
        }
        
        function toggleVerification(userId, verify) {
            const action = verify ? 'ØªÙˆØ«ÙŠÙ‚' : 'Ø¥Ù„ØºØ§Ø¡ ØªÙˆØ«ÙŠÙ‚';
            if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ${action} Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ`)) {
                db.ref('users/' + userId).update({
                    isVerified: verify,
                    lastUpdated: Date.now()
                }).then(() => {
                    const message = verify ? 'ØªÙ… ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…' : 'ØªÙ… Ø¥Ù„ØºØ§Ø¡ ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…';
                    showNotification(message, 'success');
                    loadUsersManagement();
                });
            }
        }
        
        function updateProductStatus(productId, newStatus) {
            db.ref('products/' + productId).update({
                status: newStatus,
                lastUpdated: Date.now()
            }).then(() => {
                showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†', 'success');
            });
        }
        
        function deleteSingleProduct(productId) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ØŸ')) {
                db.ref('products/' + productId).remove().then(() => {
                    showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†', 'success');
                    loadProductsManagement();
                });
            }
        }
        
        function refreshAllData() {
            showNotification('Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...', 'info');
            loadDashboard();
        }
        
        function performSearch() {
            const query = document.getElementById('globalSearch').value.trim().toLowerCase();
            if (!query) return;
            
            const userResults = Object.entries(allUsers).filter(([, user]) => 
                (user.fullName && user.fullName.toLowerCase().includes(query)) ||
                (user.username && user.username.toLowerCase().includes(query)) ||
                (user.email && user.email.toLowerCase().includes(query))
            );
            
            const productResults = Object.entries(allProducts).filter(([, product]) => 
                (product.name && product.name.toLowerCase().includes(query)) ||
                (product.seller && product.seller.toLowerCase().includes(query))
            );
            
            const content = document.getElementById('adminContent');
            content.innerHTML = `
                <div class="content-header">
                    <h3 class="content-title">ğŸ” Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù†: "${query}"</h3>
                    <button class="btn btn-outline" onclick="showTab('${currentTab}')">
                        Ø±Ø¬ÙˆØ¹
                    </button>
                </div>
                
                <div class="content-body" style="padding: 20px;">
                    <h4 style="color: #38bdf8; margin-bottom: 12px;">ğŸ‘¥ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† (${userResults.length})</h4>
                    <div class="table-container" style="margin-bottom: 20px;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                                    <th>Ø§Ù„Ø¨Ø±ÙŠØ¯</th>
                                    <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</th>
                                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${userResults.slice(0, 5).map(([userId, user]) => `
                                    <tr>
                                        <td>
                                            <span class="user-name-wrapper">
                                                ${user.isVerified ? '<span class="verified-badge">âœ“</span>' : ''}
                                                ${user.fullName || user.username || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}
                                            </span>
                                        </td>
                                        <td>${user.email || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</td>
                                        <td>${user.totalProducts || 0}</td>
                                        <td>
                                            <button class="btn btn-xs btn-primary" onclick="viewUserDetails('${userId}')">
                                                Ø¹Ø±Ø¶
                                            </button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                    
                    <h4 style="color: #38bdf8; margin-bottom: 12px;">ğŸ›’ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª (${productResults.length})</h4>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</th>
                                    <th>Ø§Ù„Ø³Ø¹Ø±</th>
                                    <th>Ø§Ù„Ø¨Ø§Ø¦Ø¹</th>
                                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${productResults.slice(0, 5).map(([productId, product]) => {
                                    const seller = allUsers[product.uid] || {};
                                    return `
                                        <tr>
                                            <td>${product.name || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…'}</td>
                                            <td>${product.price ? parseInt(product.price).toLocaleString('ar-SA') + ' Ø¯.Ø¹' : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                                            <td>
                                                <span class="user-name-wrapper">
                                                    ${seller.isVerified ? '<span class="verified-badge">âœ“</span>' : ''}
                                                    ${seller.fullName || seller.username || product.seller || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}
                                                </span>
                                            </td>
                                            <td><span class="status-badge status-${product.status || 'available'}">
                                                ${getStatusText(product.status || 'available')}
                                            </span></td>
                                            <td>
                                                <button class="btn btn-xs btn-primary" onclick="viewProductDetails('${productId}')">
                                                    Ø¹Ø±Ø¶
                                                </button>
                                            </td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }
        
        function handleGlobalSearch(event) {
            if (event.key === 'Enter') {
                performSearch();
            }
        }
        
        function exportData() {
            const data = {
                users: allUsers,
                products: allProducts,
                exportedAt: new Date().toISOString(),
                exportedBy: currentUser?.uid
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `a3len-backup-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showNotification('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }
        
        // ========================================
        // Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
        // ========================================
        
        function toggleFeature(feature, enable) {
            showNotification(`ØªÙ… ${enable ? 'ØªÙØ¹ÙŠÙ„' : 'ØªØ¹Ø·ÙŠÙ„'} ${feature === 'twoFactor' ? 'Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ø®Ø·ÙˆØªÙŠÙ†' : 'Ø§Ù„Ù…ÙŠØ²Ø©'}`, 'info');
        }
        
        function clearCache() {
            showNotification('ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø¤Ù‚ØªØ©', 'success');
        }
        
        // ========================================
        // ØªØµÙÙŠØ© ÙˆØ¨Ø­Ø«
        // ========================================
        
        function filterUsers() {
            const filter = document.getElementById('userFilter').value;
            const searchTerm = document.getElementById('userSearch')?.value.toLowerCase() || '';
            
            let filteredUsers = Object.entries(allUsers);
            
            if (filter === 'verified') {
                filteredUsers = filteredUsers.filter(([, user]) => user.isVerified);
            } else if (filter === 'admin') {
                filteredUsers = filteredUsers.filter(([, user]) => user.isAdmin);
            }
            
            if (searchTerm) {
                filteredUsers = filteredUsers.filter(([, user]) =>
                    (user.fullName && user.fullName.toLowerCase().includes(searchTerm)) ||
                    (user.username && user.username.toLowerCase().includes(searchTerm)) ||
                    (user.email && user.email.toLowerCase().includes(searchTerm))
                );
            }
            
            displayUsersTable(allUsers, filteredUsers);
        }
        
        function searchUsers() {
            filterUsers();
        }
        
        function filterProducts() {
            const filter = document.getElementById('productFilter').value;
            const searchTerm = document.getElementById('productSearch')?.value.toLowerCase() || '';
            
            let filteredProducts = Object.entries(allProducts);
            
            if (filter === 'available') {
                filteredProducts = filteredProducts.filter(([, product]) => product.status === 'available');
            } else if (filter === 'sold') {
                filteredProducts = filteredProducts.filter(([, product]) => product.status === 'sold');
            } else if (filter === 'reserved') {
                filteredProducts = filteredProducts.filter(([, product]) => product.status === 'reserved');
            }
            
            if (searchTerm) {
                filteredProducts = filteredProducts.filter(([, product]) =>
                    (product.name && product.name.toLowerCase().includes(searchTerm))
                );
            }
            
            displayProductsTable(allProducts, filteredProducts);
        }
        
        function searchProducts() {
            filterProducts();
        }
        
        // Ø¯ÙˆØ§Ù„ Ø§Ù„Ù†Ø¸Ø§Ù…
        function showSystemLogs() {
            showNotification('Ø®Ø§ØµÙŠØ© Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±', 'info');
        }
    </script>
</body>
</html>
