<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø§Ù„Ù…Ø§Ù„Ùƒ | a3len</title>
    <style>
        @font-face {
            font-family: 'CustomFont';
            src: url('font.ttf') format('truetype');
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'CustomFont', sans-serif;
            background: #0f1115;
            color: #e5e7eb;
            min-height: 100vh;
            padding: 0;
            font-size: 14px;
        }
        
        /* Header */
        .admin-header {
            background: #0b0d12;
            padding: 12px 0;
            border-bottom: 1px solid #1f2937;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }
        
        .back-btn {
            color: #38bdf8;
            text-decoration: none;
            font-size: 14px;
            padding: 6px 12px;
            border-radius: 6px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
            background: rgba(56, 189, 248, 0.1);
            white-space: nowrap;
        }
        
        .back-btn:hover {
            background: rgba(56, 189, 248, 0.2);
        }
        
        .admin-logo {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .logo-icon {
            font-size: 24px;
            color: #8b5cf6;
        }
        
        .logo-text {
            color: #38bdf8;
            font-size: 18px;
            font-weight: bold;
        }
        
        .owner-badge {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
            padding: 3px 8px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: bold;
            margin-right: 5px;
        }
        
        /* Ø´Ø§Ø±Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚ */
        .verified-badge {
            display: inline-flex;
            align-items: center;
            background: #10b981;
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-right: 5px;
            vertical-align: middle;
        }
        
        .user-name-wrapper {
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        
        /* Search Bar */
        .admin-search {
            flex: 2;
            min-width: 200px;
            position: relative;
        }
        
        .search-input {
            width: 100%;
            padding: 10px 40px 10px 15px;
            background: #1f2937;
            border: 1px solid #374151;
            border-radius: 8px;
            color: #e5e7eb;
            font-family: inherit;
            font-size: 13px;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #38bdf8;
            box-shadow: 0 0 0 2px rgba(56, 189, 248, 0.1);
        }
        
        .search-btn {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #9ca3af;
            cursor: pointer;
            font-size: 14px;
        }
        
        /* Quick Actions */
        .quick-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        /* Main Container */
        .admin-container {
            max-width: 1400px;
            margin: 15px auto;
            padding: 0 15px;
        }
        
        /* Tabs Navigation */
        .admin-tabs {
            display: flex;
            background: #1c1f27;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #374151;
            overflow-x: auto;
            padding: 3px;
            -webkit-overflow-scrolling: touch;
        }
        
        .tab {
            padding: 12px 15px;
            background: none;
            border: none;
            color: #9ca3af;
            font-family: inherit;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 8px;
            border-radius: 6px;
            transition: all 0.2s;
            flex-shrink: 0;
        }
        
        .tab:hover {
            background: rgba(56, 189, 248, 0.1);
            color: #e5e7eb;
        }
        
        .tab.active {
            background: #38bdf8;
            color: #000;
            font-weight: bold;
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: #1c1f27;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #374151;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
            border-color: #38bdf8;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #38bdf8, #0ea5e9);
        }
        
        .stat-icon {
            font-size: 28px;
            margin-bottom: 12px;
        }
        
        .stat-number {
            color: #38bdf8;
            font-size: 30px;
            font-weight: bold;
            display: block;
            line-height: 1;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #9ca3af;
            font-size: 13px;
            display: block;
        }
        
        .stat-trend {
            font-size: 11px;
            margin-top: 8px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .trend-up {
            color: #10b981;
        }
        
        .trend-down {
            color: #ef4444;
        }
        
        /* Main Content */
        .admin-content {
            background: #1c1f27;
            border-radius: 10px;
            padding: 0;
            border: 1px solid #374151;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .content-header {
            padding: 20px;
            border-bottom: 1px solid #374151;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            justify-content: space-between;
        }
        
        .content-title {
            color: #38bdf8;
            font-size: 18px;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .content-controls {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .filter-select {
            background: #1f2937;
            border: 1px solid #374151;
            border-radius: 6px;
            padding: 8px 12px;
            color: #e5e7eb;
            font-family: inherit;
            font-size: 13px;
            min-width: 120px;
        }
        
        /* Tables */
        .table-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }
        
        .data-table th {
            background: #1f2937;
            padding: 15px;
            text-align: right;
            color: #38bdf8;
            font-weight: 600;
            font-size: 13px;
            border-bottom: 2px solid #374151;
            position: sticky;
            top: 0;
        }
        
        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #374151;
            font-size: 13px;
        }
        
        .data-table tr:hover {
            background: rgba(56, 189, 248, 0.05);
        }
        
        /* User Status Badges */
        .status-badge {
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: 500;
            display: inline-block;
        }
        
        .status-pending {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
            animation: pulse 1.5s infinite;
        }
        
        .status-approved {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }
        
        .status-rejected {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }
        
        .status-edited-pending {
            background: rgba(147, 51, 234, 0.2);
            color: #9333ea;
            animation: pulse 1.5s infinite;
        }
        
        .status-active {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }
        
        .status-suspended {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }
        
        .status-verified {
            background: rgba(139, 92, 246, 0.2);
            color: #8b5cf6;
        }
        
        /* Action Buttons */
        .action-btns {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 6px 12px;
            border-radius: 6px;
            font-family: inherit;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            white-space: nowrap;
        }
        
        .btn-sm {
            padding: 5px 10px;
            font-size: 11px;
        }
        
        .btn-xs {
            padding: 3px 6px;
            font-size: 10px;
        }
        
        .btn-primary {
            background: #38bdf8;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0ea5e9;
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        
        .btn-danger:hover {
            background: #dc2626;
        }
        
        .btn-success {
            background: #10b981;
            color: white;
        }
        
        .btn-success:hover {
            background: #059669;
        }
        
        .btn-warning {
            background: #f59e0b;
            color: white;
        }
        
        .btn-warning:hover {
            background: #d97706;
        }
        
        .btn-violet {
            background: #8b5cf6;
            color: white;
        }
        
        .btn-violet:hover {
            background: #7c3aed;
        }
        
        .btn-outline {
            background: transparent;
            border: 1px solid #374151;
            color: #9ca3af;
        }
        
        .btn-outline:hover {
            background: #1f2937;
            color: #e5e7eb;
        }
        
        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 15px;
        }
        
        .modal-content {
            background: #1c1f27;
            border-radius: 10px;
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid #374151;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.5);
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #374151;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            color: #38bdf8;
            font-size: 18px;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: #9ca3af;
            font-size: 22px;
            cursor: pointer;
            padding: 4px;
            line-height: 1;
        }
        
        .modal-close:hover {
            color: #ef4444;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid #374151;
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        /* Forms */
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-label {
            display: block;
            color: #9ca3af;
            font-size: 13px;
            margin-bottom: 6px;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 10px 12px;
            background: #1f2937;
            border: 1px solid #374151;
            border-radius: 6px;
            color: #e5e7eb;
            font-family: inherit;
            font-size: 13px;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #38bdf8;
            box-shadow: 0 0 0 2px rgba(56, 189, 248, 0.1);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }
        
        /* Activity Log */
        .activity-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .activity-item {
            padding: 12px;
            border-bottom: 1px solid #374151;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .activity-item:last-child {
            border-bottom: none;
        }
        
        .activity-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: #1f2937;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
        }
        
        .activity-content {
            flex: 1;
        }
        
        .activity-text {
            color: #e5e7eb;
            margin-bottom: 3px;
            font-size: 13px;
        }
        
        .activity-time {
            color: #9ca3af;
            font-size: 11px;
        }
        
        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 6px;
            padding: 15px;
            border-top: 1px solid #374151;
            flex-wrap: wrap;
        }
        
        .page-btn {
            padding: 6px 12px;
            background: #1f2937;
            border: 1px solid #374151;
            color: #e5e7eb;
            border-radius: 6px;
            cursor: pointer;
            font-family: inherit;
            font-size: 13px;
            min-width: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .page-btn:hover {
            background: #374151;
        }
        
        .page-btn.active {
            background: #38bdf8;
            color: #000;
            border-color: #38bdf8;
        }
        
        .page-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Loading */
        .loading {
            text-align: center;
            padding: 30px;
            color: #9ca3af;
        }
        
        .loading-spinner {
            width: 36px;
            height: 36px;
            border: 3px solid rgba(56, 189, 248, 0.2);
            border-top-color: #38bdf8;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Notifications */
        .notification {
            position: fixed;
            top: 15px;
            right: 15px;
            padding: 12px 16px;
            border-radius: 6px;
            color: white;
            font-weight: 500;
            z-index: 3000;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s ease;
            max-width: 350px;
            font-size: 13px;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .notification.success {
            background: #10b981;
            border-left: 3px solid #059669;
        }
        
        .notification.error {
            background: #ef4444;
            border-left: 3px solid #dc2626;
        }
        
        .notification.warning {
            background: #f59e0b;
            border-left: 3px solid #d97706;
        }
        
        .notification.info {
            background: #38bdf8;
            border-left: 3px solid #0ea5e9;
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ù‡Ø§ØªÙ */
        @media (min-width: 768px) {
            .form-row {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        @media (max-width: 480px) {
            .header-content {
                flex-direction: column;
                align-items: stretch;
            }
            
            .admin-search {
                width: 100%;
            }
            
            .admin-tabs {
                flex-direction: column;
            }
            
            .tab {
                width: 100%;
                justify-content: center;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .content-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .content-controls {
                width: 100%;
            }
            
            .filter-select {
                width: 100%;
            }
            
            .modal-content {
                margin: 10px;
            }
        }
        
        /* Ø£Ù†Ù…Ø§Ø· Ø®Ø§ØµØ© Ø¨Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© */
        .approval-card {
            background: #1c1f27;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #374151;
            transition: all 0.3s ease;
        }
        
        .approval-card:hover {
            border-color: #38bdf8;
            box-shadow: 0 4px 12px rgba(56, 189, 248, 0.2);
        }
        
        .approval-card.pending {
            border-left: 4px solid #f59e0b;
        }
        
        .approval-card.edited {
            border-left: 4px solid #9333ea;
        }
        
        .approval-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .approval-title {
            font-weight: bold;
            color: #38bdf8;
            font-size: 16px;
        }
        
        .approval-meta {
            display: flex;
            gap: 10px;
            font-size: 12px;
            color: #9ca3af;
            margin-bottom: 10px;
        }
        
        .approval-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .comparison-container {
            background: #1f2937;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .comparison-row {
            display: flex;
            gap: 15px;
            margin-bottom: 10px;
        }
        
        .comparison-item {
            flex: 1;
            padding: 10px;
            border-radius: 6px;
            background: #374151;
        }
        
        .comparison-label {
            font-size: 11px;
            color: #9ca3af;
            margin-bottom: 5px;
        }
        
        .comparison-value {
            font-weight: bold;
            color: #e5e7eb;
        }
        
        .comparison-value.changed {
            color: #38bdf8;
            background: rgba(56, 189, 248, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
        }
        
        .image-comparison {
            display: flex;
            gap: 15px;
            margin: 15px 0;
        }
        
        .image-comparison img {
            width: 150px;
            height: 100px;
            object-fit: cover;
            border-radius: 6px;
            border: 2px solid #374151;
        }
        
        .image-comparison img.new {
            border-color: #38bdf8;
        }
        
        .image-label {
            text-align: center;
            font-size: 11px;
            color: #9ca3af;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <!-- Notifications -->
    <div id="notificationContainer"></div>
    
    <!-- Header -->
    <div class="admin-header">
        <div class="header-content">
            <div class="header-left">
                <a href="index.html" class="back-btn">
                    â† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                </a>
                <div class="admin-logo">
                    <div class="logo-icon">ğŸ‘‘</div>
                    <div class="logo-text">a3len</div>
                    <div class="owner-badge">Ø§Ù„Ù…Ø§Ù„Ùƒ</div>
                </div>
            </div>
            
            <div class="admin-search">
                <input type="text" class="search-input" id="globalSearch" 
                       placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†ØŒ Ø¥Ø¹Ù„Ø§Ù†Ø§ØªØŒ Ø£Ùˆ Ø£ÙŠ Ø´ÙŠØ¡..." 
                       onkeyup="handleGlobalSearch(event)">
                <button class="search-btn" onclick="performSearch()">ğŸ”</button>
            </div>
            
            <div class="quick-actions">
                <button class="btn btn-violet" onclick="refreshAllData()">
                    âŸ³ ØªØ­Ø¯ÙŠØ«
                </button>
                <button class="btn btn-success" onclick="exportData()">
                    ğŸ“¥ ØªØµØ¯ÙŠØ±
                </button>
            </div>
        </div>
    </div>
    
    <!-- Main Container -->
    <div class="admin-container">
        <!-- Tabs -->
        <div class="admin-tabs">
            <button class="tab active" onclick="showTab('dashboard')">
                ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
            </button>
            <button class="tab" onclick="showTab('pending')">
                â³ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© <span id="pendingCount" class="pending-badge" style="background:#f59e0b; color:white; padding:2px 6px; border-radius:10px; font-size:10px;">0</span>
            </button>
            <button class="tab" onclick="showTab('edited')">
                âœï¸ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª Ø§Ù„Ù…Ø¹Ø¯Ù„Ø© <span id="editedCount" class="pending-badge" style="background:#9333ea; color:white; padding:2px 6px; border-radius:10px; font-size:10px;">0</span>
            </button>
            <button class="tab" onclick="showTab('users')">
                ğŸ‘¥ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
            </button>
            <button class="tab" onclick="showTab('products')">
                ğŸ›’ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©
            </button>
            <button class="tab" onclick="showTab('settings')">
                âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            </button>
        </div>
        
        <!-- Stats Grid -->
        <div class="stats-grid" id="statsGrid">
            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
        </div>
        
        <!-- Main Content -->
        <div class="admin-content" id="adminContent">
            <!-- Ù…Ø­ØªÙˆÙ‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
            <div class="loading" id="loadingContent">
                <div class="loading-spinner"></div>
                <div>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…...</div>
            </div>
        </div>
    </div>
    
    <!-- Modals -->
    <div class="modal-overlay" id="userModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ğŸ‘¤ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h3>
                <button class="modal-close" onclick="closeUserModal()">Ã—</button>
            </div>
            <div class="modal-body" id="userModalBody">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeUserModal()">Ø¥ØºÙ„Ø§Ù‚</button>
                <button class="btn btn-danger" id="deleteUserBtn">Ø­Ø°Ù</button>
                <button class="btn btn-primary" id="saveUserBtn">Ø­ÙØ¸</button>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="productModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ğŸ›’ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</h3>
                <button class="modal-close" onclick="closeProductModal()">Ã—</button>
            </div>
            <div class="modal-body" id="productModalBody">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeProductModal()">Ø¥ØºÙ„Ø§Ù‚</button>
                <button class="btn btn-danger" id="deleteProductBtn">Ø­Ø°Ù</button>
                <button class="btn btn-primary" id="saveProductBtn">Ø­ÙØ¸</button>
            </div>
        </div>
    </div>
    
    <!-- Modal Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª -->
    <div class="modal-overlay" id="approvalModal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h3 class="modal-title" id="approvalModalTitle">â³ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</h3>
                <button class="modal-close" onclick="closeApprovalModal()">Ã—</button>
            </div>
            <div class="modal-body" id="approvalModalBody">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeApprovalModal()">Ø¥ØºÙ„Ø§Ù‚</button>
                <button class="btn btn-danger" onclick="rejectProduct()">Ø±ÙØ¶</button>
                <button class="btn btn-success" onclick="approveProduct()">Ù…ÙˆØ§ÙÙ‚Ø©</button>
            </div>
        </div>
    </div>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script>
        // ===== ØªÙ‡ÙŠØ¦Ø© Supabase =====
        const supabaseUrl = 'https://dnclbdvdzvtdjpgxwnrl.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRuY2xiZHZkenZ0ZGpwZ3h3bnJsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcyMjY5OTcsImV4cCI6MjA4MjgwMjk5N30.alGg61mAPLLqLM2LlQRq2K2o_eOOnJwNuaIJiAXB7Wg';
        
        const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);
        
        // ØªÙƒÙˆÙŠÙ† Firebase - ØªØ£ÙƒØ¯ Ù…Ù† ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø¹ index.html
        const firebaseConfig = {
            apiKey: "AIzaSyAl3XunFOwHpGw-4_VYyETMtoLgk4mnRpQ",
            authDomain: "a3len-3ad54.firebasestorage.app",
            databaseURL: "https://a3len-3ad54-default-rtdb.firebaseio.com",
            projectId: "a3len-3ad54",
            storageBucket: "a3len-3ad54.firebasestorage.app",
            messagingSenderId: "767338034080",
            appId: "1:767338034080:web:801d77fb74c0aa56e92ac5"
        };
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ ÙˆØ¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© Firebase
        try {
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
                console.log("âœ… Firebase initialized successfully");
            } else {
                firebase.app(); // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ù‹Ø§ Ø¨Ø§Ù„ÙØ¹Ù„
                console.log("âœ… Firebase already initialized");
            }
        } catch (error) {
            console.error("âŒ Firebase initialization error:", error);
        }
        
        const db = firebase.database();
        const auth = firebase.auth();
        
        // Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø©
        let currentUser = null;
        let isSuperAdmin = false;
        let allUsers = {};
        let allProducts = {};
        let pendingProducts = [];
        let editedProducts = [];
        let currentTab = 'dashboard';
        let currentApprovalProduct = null;
        
        // Ø«ÙˆØ§Ø¨Øª Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù†ØªØ¬
        const PRODUCT_STATUS = {
            PENDING: 'pending',
            APPROVED: 'approved',
            REJECTED: 'rejected',
            EDITED_PENDING: 'edited_pending'
        };
        
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', function() {
            console.log("ğŸ“± Admin page loaded, checking permissions...");
            checkAdminPermissions();
            setupEventListeners();
        });
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù…Ø¯ÙŠØ± - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù…Ø­Ø³Ù‘Ù†
        function checkAdminPermissions() {
            console.log("ğŸ” Checking admin permissions...");
            
            auth.onAuthStateChanged((user) => {
                if (user) {
                    console.log("ğŸ‘¤ User authenticated:", user.uid);
                    currentUser = user;
                    
                    // Ø¥Ø¶Ø§ÙØ© ÙˆÙ‚Øª Ø§Ù†ØªØ¸Ø§Ø± Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„ Firebase
                    setTimeout(() => {
                        db.ref('users/' + user.uid).once('value', (snapshot) => {
                            const userData = snapshot.val();
                            console.log("ğŸ“Š User data fetched:", userData);
                            
                            if (userData && userData.isAdmin) {
                                console.log("âœ… User is admin, loading dashboard...");
                                isSuperAdmin = true;
                                loadDashboard();
                                updatePendingCounts();
                            } else {
                                console.log("âŒ User is not admin");
                                showNotification('Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©', 'error');
                                setTimeout(() => {
                                    window.location.href = 'index.html';
                                }, 2000);
                            }
                        }).catch((error) => {
                            console.error("âŒ Error fetching user data:", error);
                            showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', 'error');
                            setTimeout(() => {
                                window.location.href = 'index.html';
                            }, 2000);
                        });
                    }, 1000);
                } else {
                    console.log("âŒ No user authenticated");
                    showNotification('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'error');
                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 1500);
                }
            }, (error) => {
                console.error("âŒ Auth state change error:", error);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©', 'error');
            });
        }
        
        // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        function setupEventListeners() {
            document.getElementById('globalSearch').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    performSearch();
                }
            });
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©
        async function updatePendingCounts() {
            try {
                const snapshot = await db.ref('products').once('value');
                const products = snapshot.val() || {};
                
                let pendingCount = 0;
                let editedCount = 0;
                
                Object.values(products).forEach(product => {
                    if (!product) return;
                    
                    if (product.status === PRODUCT_STATUS.PENDING) {
                        pendingCount++;
                    } else if (product.status === PRODUCT_STATUS.EDITED_PENDING) {
                        editedCount++;
                    }
                });
                
                document.getElementById('pendingCount').textContent = pendingCount;
                document.getElementById('editedCount').textContent = editedCount;
                
            } catch (error) {
                console.error("âŒ Error updating pending counts:", error);
            }
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ù…Ø¹ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ø®Ø·Ø§Ø¡ Ù…Ø­Ø³Ù†Ø©
        function loadDashboard() {
            console.log("ğŸ“Š Loading dashboard data...");
            showLoading();
            
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Promise.all Ù…Ø¹ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ø®Ø·Ø§Ø¡ Ù…Ù†ÙØµÙ„Ø© Ù„ÙƒÙ„ Ø§Ø³ØªØ¹Ù„Ø§Ù…
            const usersPromise = db.ref('users').once('value').catch(error => {
                console.error("âŒ Error loading users:", error);
                return { val: () => ({}) };
            });
            
            const productsPromise = db.ref('products').once('value').catch(error => {
                console.error("âŒ Error loading products:", error);
                return { val: () => ({}) };
            });
            
            const reportsPromise = db.ref('reports').once('value').catch(error => {
                console.error("âŒ Error loading reports:", error);
                return { val: () => ({}) };
            });
            
            Promise.all([usersPromise, productsPromise, reportsPromise])
                .then(([usersSnap, productsSnap, reportsSnap]) => {
                    console.log("âœ… All data loaded successfully");
                    
                    allUsers = usersSnap.val() || {};
                    allProducts = productsSnap.val() || {};
                    
                    console.log(`ğŸ“ˆ Users: ${Object.keys(allUsers).length}, Products: ${Object.keys(allProducts).length}`);
                    
                    const stats = calculateStatistics(usersSnap, productsSnap, reportsSnap);
                    displayStats(stats);
                    displayDashboardContent(usersSnap, productsSnap);
                    hideLoading();
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª
                    updatePendingCounts();
                })
                .catch(error => {
                    console.error('âŒ Error loading dashboard:', error);
                    showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
                    hideLoading();
                    
                    // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø¨Ø¯ÙŠÙ„Ø© Ø¥Ø°Ø§ ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„
                    const content = document.getElementById('adminContent');
                    content.innerHTML = `
                        <div class="content-header">
                            <h3 class="content-title">ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h3>
                        </div>
                        <div style="padding: 40px; text-align: center; color: #9ca3af;">
                            <div style="font-size: 48px; margin-bottom: 20px;">âš ï¸</div>
                            <h3 style="color: #ef4444; margin-bottom: 10px;">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
                            <p style="margin-bottom: 20px;">ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>
                            <button class="btn btn-primary" onclick="loadDashboard()">
                                âŸ³ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
                            </button>
                        </div>
                    `;
                });
        }
        
        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª - Ù…Ø¹ ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ§Ø±ØºØ©
        function calculateStatistics(usersSnap, productsSnap, reportsSnap) {
            const users = usersSnap.val() || {};
            const products = productsSnap.val() || {};
            const reports = reportsSnap.val() || {};
            
            const totalUsers = Object.keys(users).length;
            const totalProducts = Object.keys(products).length;
            const totalReports = Object.keys(reports).length;
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©
            let pendingProducts = 0;
            let editedPendingProducts = 0;
            let approvedProducts = 0;
            let rejectedProducts = 0;
            let soldProducts = 0;
            let reservedProducts = 0;
            let activeProducts = 0;
            
            Object.values(products).forEach(product => {
                if (!product) return;
                
                const status = product.status || PRODUCT_STATUS.PENDING;
                
                switch(status) {
                    case PRODUCT_STATUS.PENDING:
                        pendingProducts++;
                        break;
                    case PRODUCT_STATUS.EDITED_PENDING:
                        editedPendingProducts++;
                        break;
                    case PRODUCT_STATUS.APPROVED:
                        approvedProducts++;
                        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø¹Ø© ÙˆØ§Ù„Ù…Ø­Ø¬ÙˆØ²Ø©
                        if (product.status2 === 'sold') soldProducts++;
                        else if (product.status2 === 'reserved') reservedProducts++;
                        else if (product.status2 === 'available') activeProducts++;
                        break;
                    case PRODUCT_STATUS.REJECTED:
                        rejectedProducts++;
                        break;
                }
            });
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ† Ø§Ù„ÙŠÙˆÙ…
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            let activeToday = 0;
            
            Object.values(users).forEach(user => {
                if (!user) return;
                
                if (user.lastActive && new Date(user.lastActive) >= today) {
                    activeToday++;
                }
            });
            
            return {
                totalUsers,
                totalProducts,
                totalReports,
                pendingProducts,
                editedPendingProducts,
                approvedProducts,
                rejectedProducts,
                soldProducts,
                reservedProducts,
                activeProducts,
                activeToday
            };
        }
        
        // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        function displayStats(stats) {
            const statsGrid = document.getElementById('statsGrid');
            
            statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-icon">ğŸ‘¥</div>
                    <span class="stat-number">${stats.totalUsers}</span>
                    <span class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</span>
                    <div class="stat-trend trend-up">
                        <span>${stats.activeToday} Ù†Ø´Ø·ÙŠÙ† Ø§Ù„ÙŠÙˆÙ…</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">ğŸ›’</div>
                    <span class="stat-number">${stats.totalProducts}</span>
                    <span class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</span>
                    <div class="stat-trend">
                        <span>${stats.approvedProducts} Ù…Ø¹ØªÙ…Ø¯</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">â³</div>
                    <span class="stat-number">${stats.pendingProducts + stats.editedPendingProducts}</span>
                    <span class="stat-label">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©</span>
                    <div class="stat-trend trend-up">
                        <span>${stats.pendingProducts} Ø¬Ø¯ÙŠØ¯</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">âš ï¸</div>
                    <span class="stat-number">${stats.totalReports}</span>
                    <span class="stat-label">Ø¨Ù„Ø§ØºØ§Øª Ù…Ø¹Ù„Ù‚Ø©</span>
                    <div class="stat-trend">
                        <span>Ø¨Ø­Ø§Ø¬Ø© Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</span>
                    </div>
                </div>
            `;
        }
        
        // Ø¹Ø±Ø¶ Ù…Ø­ØªÙˆÙ‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
        function displayDashboardContent(usersSnap, productsSnap) {
            const users = usersSnap.val() || {};
            const products = productsSnap.val() || {};
            
            // ÙÙ„ØªØ±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„ØµØ§Ù„Ø­Ø© ÙÙ‚Ø·
            const validUsers = Object.entries(users).filter(([_, user]) => user && (user.username || user.email));
            const validProducts = Object.entries(products).filter(([_, product]) => product && product.name);
            
            // Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© Ø­Ø¯ÙŠØ«Ø§Ù‹
            const pendingProducts = validProducts
                .filter(([_, product]) => product.status === PRODUCT_STATUS.PENDING)
                .sort(([,a], [,b]) => (b.timestamp || 0) - (a.timestamp || 0))
                .slice(0, 5);
            
            // Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ø¯Ù„Ø© Ø­Ø¯ÙŠØ«Ø§Ù‹
            const editedProducts = validProducts
                .filter(([_, product]) => product.status === PRODUCT_STATUS.EDITED_PENDING)
                .sort(([,a], [,b]) => (b.lastUpdated || 0) - (a.lastUpdated || 0))
                .slice(0, 5);
            
            const recentUsers = validUsers
                .sort(([,a], [,b]) => (b.createdAt || 0) - (a.createdAt || 0))
                .slice(0, 5);
            
            const recentApprovedProducts = validProducts
                .filter(([_, product]) => product.status === PRODUCT_STATUS.APPROVED)
                .sort(([,a], [,b]) => (b.timestamp || 0) - (a.timestamp || 0))
                .slice(0, 5);
            
            const content = document.getElementById('adminContent');
            
            content.innerHTML = `
                <div class="content-header">
                    <h3 class="content-title">ğŸ“Š Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
                    <div class="content-controls">
                        <button class="btn btn-primary" onclick="refreshAllData()">
                            âŸ³ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                        </button>
                    </div>
                </div>
                
                <div class="content-body" style="padding: 20px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div>
                            <h4 style="color: #38bdf8; margin-bottom: 12px;">â³ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© Ø­Ø¯ÙŠØ«Ø§Ù‹</h4>
                            <div style="max-height: 300px; overflow-y: auto;">
                                ${pendingProducts.length > 0 ? pendingProducts.map(([productId, product]) => `
                                    <div class="approval-card pending">
                                        <div class="approval-header">
                                            <div class="approval-title">${product.name || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…'}</div>
                                            <span class="status-badge status-pending">Ø¬Ø¯ÙŠØ¯</span>
                                        </div>
                                        <div class="approval-meta">
                                            <span>ğŸ’° ${product.price ? parseInt(product.price).toLocaleString('ar-SA') + ' Ø¯.Ø¹' : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                                            <span>ğŸ“‚ ${product.category || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                                            <span>ğŸ‘¤ ${product.seller || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</span>
                                        </div>
                                        <div class="approval-actions">
                                            <button class="btn btn-xs btn-primary" onclick="reviewProduct('${productId}')">
                                                ğŸ‘ï¸ Ù…Ø¹Ø§ÙŠÙ†Ø©
                                            </button>
                                            <button class="btn btn-xs btn-success" onclick="approveProductDirect('${productId}')">
                                                âœ“ Ù…ÙˆØ§ÙÙ‚Ø©
                                            </button>
                                            <button class="btn btn-xs btn-danger" onclick="rejectProductDirect('${productId}')">
                                                âœ— Ø±ÙØ¶
                                            </button>
                                        </div>
                                    </div>
                                `).join('') : `
                                    <div style="text-align: center; padding: 20px; color: #9ca3af; background: #1f2937; border-radius: 8px;">
                                        <div style="font-size: 32px; margin-bottom: 10px;">âœ…</div>
                                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù…Ø¹Ù„Ù‚Ø©</p>
                                    </div>
                                `}
                            </div>
                        </div>
                        
                        <div>
                            <h4 style="color: #38bdf8; margin-bottom: 12px;">âœï¸ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ø¯Ù„Ø© Ø­Ø¯ÙŠØ«Ø§Ù‹</h4>
                            <div style="max-height: 300px; overflow-y: auto;">
                                ${editedProducts.length > 0 ? editedProducts.map(([productId, product]) => `
                                    <div class="approval-card edited">
                                        <div class="approval-header">
                                            <div class="approval-title">${product.name || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…'}</div>
                                            <span class="status-badge status-edited-pending">ØªØ¹Ø¯ÙŠÙ„</span>
                                        </div>
                                        <div class="approval-meta">
                                            <span>ğŸ’° ${product.price ? parseInt(product.price).toLocaleString('ar-SA') + ' Ø¯.Ø¹' : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                                            <span>ğŸ“‚ ${product.category || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                                            <span>ğŸ‘¤ ${product.seller || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</span>
                                        </div>
                                        <div class="approval-actions">
                                            <button class="btn btn-xs btn-primary" onclick="reviewEditedProduct('${productId}')">
                                                ğŸ‘ï¸ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
                                            </button>
                                            <button class="btn btn-xs btn-success" onclick="approveEditDirect('${productId}')">
                                                âœ“ Ù‚Ø¨ÙˆÙ„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
                                            </button>
                                            <button class="btn btn-xs btn-danger" onclick="rejectEditDirect('${productId}')">
                                                âœ— Ø±ÙØ¶ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
                                            </button>
                                        </div>
                                    </div>
                                `).join('') : `
                                    <div style="text-align: center; padding: 20px; color: #9ca3af; background: #1f2937; border-radius: 8px;">
                                        <div style="font-size: 32px; margin-bottom: 10px;">âœ…</div>
                                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ù…Ø¹Ù„Ù‚Ø©</p>
                                    </div>
                                `}
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr; gap: 20px; margin-bottom: 20px;">
                        <div>
                            <h4 style="color: #38bdf8; margin-bottom: 12px;">ğŸ‘¤ Ø¢Ø®Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†</h4>
                            <div class="table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Ø§Ù„Ø§Ø³Ù…</th>
                                            <th>Ø§Ù„Ø¨Ø±ÙŠØ¯</th>
                                            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${recentUsers.length > 0 ? recentUsers.map(([userId, user]) => `
                                            <tr>
                                                <td>
                                                    <span class="user-name-wrapper">
                                                        ${user.isVerified ? '<span class="verified-badge">âœ“</span>' : ''}
                                                        ${user.fullName || user.username || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…'}
                                                    </span>
                                                </td>
                                                <td>${user.email || 'Ø¨Ø¯ÙˆÙ† Ø¨Ø±ÙŠØ¯'}</td>
                                                <td>${user.createdAt ? formatDate(user.createdAt) : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</td>
                                                <td>
                                                    <button class="btn btn-xs btn-primary" onclick="viewUserDetails('${userId}')">
                                                        Ø¹Ø±Ø¶
                                                    </button>
                                                </td>
                                            </tr>
                                        `).join('') : `
                                            <tr>
                                                <td colspan="4" style="text-align: center; padding: 20px; color: #9ca3af;">
                                                    Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
                                                </td>
                                            </tr>
                                        `}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div>
                            <h4 style="color: #38bdf8; margin-bottom: 12px;">âœ… Ø¢Ø®Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©</h4>
                            <div class="table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</th>
                                            <th>Ø§Ù„Ø³Ø¹Ø±</th>
                                            <th>Ø§Ù„Ø¨Ø§Ø¦Ø¹</th>
                                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${recentApprovedProducts.length > 0 ? recentApprovedProducts.map(([productId, product]) => {
                                            const seller = allUsers[product.uid] || {};
                                            return `
                                                <tr>
                                                    <td>${product.name || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…'}</td>
                                                    <td>${product.price ? parseInt(product.price).toLocaleString('ar-SA') + ' Ø¯.Ø¹' : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                                                    <td>
                                                        <span class="user-name-wrapper">
                                                            ${seller.isVerified ? '<span class="verified-badge">âœ“</span>' : ''}
                                                            ${seller.fullName || seller.username || product.seller || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}
                                                        </span>
                                                    </td>
                                                    <td>
                                                        <button class="btn btn-xs btn-primary" onclick="viewProductDetails('${productId}')">
                                                            Ø¹Ø±Ø¶
                                                        </button>
                                                    </td>
                                                </tr>
                                            `;
                                        }).join('') : `
                                            <tr>
                                                <td colspan="4" style="text-align: center; padding: 20px; color: #9ca3af;">
                                                    Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù…Ø¹ØªÙ…Ø¯Ø©
                                                </td>
                                            </tr>
                                        `}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: #1f2937; padding: 15px; border-radius: 8px; margin-top: 20px;">
                        <h4 style="color: #38bdf8; margin-bottom: 10px;">ğŸ’¡ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; font-size: 13px;">
                            <div>
                                <span style="color: #9ca3af;">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«:</span>
                                <span style="color: #38bdf8; font-weight: bold;"> ${formatDateTime(Date.now())}</span>
                            </div>
                            <div>
                                <span style="color: #9ca3af">Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„:</span>
                                <span style="color: #10b981; font-weight: bold;"> ğŸŸ¢ Ù…ØªØµÙ„</span>
                            </div>
                            <div>
                                <span style="color: #9ca3af;">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„:</span>
                                <span style="color: #8b5cf6; font-weight: bold;"> ${currentUser?.email || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
        function showTab(tabName) {
            currentTab = tabName;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            const activeTab = document.querySelector(`.tab[onclick*="${tabName}"]`);
            if (activeTab) {
                activeTab.classList.add('active');
            }
            
            // ØªØ­Ù…ÙŠÙ„ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¨ÙˆÙŠØ¨
            switch(tabName) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'pending':
                    loadPendingProducts();
                    break;
                case 'edited':
                    loadEditedProducts();
                    break;
                case 'users':
                    loadUsersManagement();
                    break;
                case 'products':
                    loadProductsManagement();
                    break;
                case 'settings':
                    loadSettings();
                    break;
                default:
                    loadDashboard();
            }
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©
        async function loadPendingProducts() {
            showLoading();
            
            try {
                const snapshot = await db.ref('products').once('value');
                const products = snapshot.val() || {};
                allProducts = products;
                
                // ØªØµÙÙŠØ© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©
                pendingProducts = Object.entries(products)
                    .filter(([_, product]) => product && product.status === PRODUCT_STATUS.PENDING)
                    .sort(([,a], [,b]) => (b.timestamp || 0) - (a.timestamp || 0));
                
                const content = document.getElementById('adminContent');
                
                content.innerHTML = `
                    <div class="content-header">
                        <h3 class="content-title">â³ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© (${pendingProducts.length} Ø¥Ø¹Ù„Ø§Ù†)</h3>
                        <div class="content-controls">
                            <button class="btn btn-success" onclick="approveAllPending()">
                                âœ“ Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ„
                            </button>
                        </div>
                    </div>
                    
                    <div style="padding: 20px;">
                        ${pendingProducts.length > 0 ? pendingProducts.map(([productId, product]) => {
                            const seller = allUsers[product.uid] || {};
                            return `
                                <div class="approval-card pending">
                                    <div class="approval-header">
                                        <div class="approval-title">${product.name || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…'}</div>
                                        <div style="display: flex; gap: 8px;">
                                            <span class="status-badge status-pending">Ø¬Ø¯ÙŠØ¯</span>
                                            <span style="font-size: 11px; color: #9ca3af;">
                                                ${formatDateTime(product.timestamp || product.createdAt)}
                                            </span>
                                        </div>
                                    </div>
                                    <div class="approval-meta">
                                        <span>ğŸ’° <strong>${product.price ? parseInt(product.price).toLocaleString('ar-SA') + ' Ø¯.Ø¹' : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</strong></span>
                                        <span>ğŸ“‚ ${product.category || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                                        <span>ğŸ“ ${product.province || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                                        <span>ğŸšš ${product.delivery || 'Ù„Ø§'}</span>
                                    </div>
                                    <div style="margin: 10px 0;">
                                        <div style="color: #9ca3af; font-size: 12px;">Ø§Ù„Ø¨Ø§Ø¦Ø¹:</div>
                                        <div style="display: flex; align-items: center; gap: 8px; margin-top: 5px;">
                                            <div style="width: 32px; height: 32px; background: #38bdf8; border-radius: 50%; 
                                                        display: flex; align-items: center; justify-content: center; 
                                                        color: white; font-weight: bold; font-size: 14px;">
                                                ${(seller.fullName || seller.username || product.seller || '?').charAt(0).toUpperCase()}
                                            </div>
                                            <div>
                                                <div style="font-weight: 500;">
                                                    <span class="user-name-wrapper">
                                                        ${seller.isVerified ? '<span class="verified-badge">âœ“</span>' : ''}
                                                        ${seller.fullName || seller.username || product.seller || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}
                                                    </span>
                                                </div>
                                                <div style="font-size: 11px; color: #9ca3af;">${product.phone || 'Ø¨Ø¯ÙˆÙ† Ø±Ù‚Ù…'}</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    ${product.images && product.images.length > 0 ? `
                                        <div style="margin: 10px 0;">
                                            <div style="color: #9ca3af; font-size: 12px; margin-bottom: 5px;">Ø§Ù„ØµÙˆØ±Ø©:</div>
                                            <img src="${product.images[0]}" 
                                                 style="width: 100%; max-width: 300px; height: 180px; object-fit: cover; border-radius: 6px; border: 1px solid #374151;"
                                                 onerror="this.src='https://via.placeholder.com/300x180/1f2937/9ca3af?text=Ù„Ø§+ØªÙˆØ¬Ø¯+ØµÙˆØ±Ø©'">
                                        </div>
                                    ` : ''}
                                    
                                    <div class="approval-actions">
                                        <button class="btn btn-primary" onclick="reviewProduct('${productId}')">
                                            ğŸ‘ï¸ Ù…Ø¹Ø§ÙŠÙ†Ø© ÙƒØ§Ù…Ù„Ø©
                                        </button>
                                        <button class="btn btn-success" onclick="approveProductDirect('${productId}')">
                                            âœ“ Ù…ÙˆØ§ÙÙ‚Ø© ÙˆÙ†Ø´Ø±
                                        </button>
                                        <button class="btn btn-danger" onclick="rejectProductDirect('${productId}')">
                                            âœ— Ø±ÙØ¶ ÙˆØ­Ø°Ù
                                        </button>
                                    </div>
                                </div>
                            `;
                        }).join('') : `
                            <div style="text-align: center; padding: 40px; color: #9ca3af;">
                                <div style="font-size: 48px; margin-bottom: 10px;">âœ…</div>
                                <h4>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù…Ø¹Ù„Ù‚Ø©</h4>
                                <p>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„ÙŠÙ‡Ø§</p>
                            </div>
                        `}
                    </div>
                `;
                
                hideLoading();
            } catch (error) {
                console.error("âŒ Error loading pending products:", error);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©', 'error');
                hideLoading();
            }
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ø¯Ù„Ø©
        async function loadEditedProducts() {
            showLoading();
            
            try {
                const snapshot = await db.ref('products').once('value');
                const products = snapshot.val() || {};
                allProducts = products;
                
                // ØªØµÙÙŠØ© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ø¯Ù„Ø© Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©
                editedProducts = Object.entries(products)
                    .filter(([_, product]) => product && product.status === PRODUCT_STATUS.EDITED_PENDING)
                    .sort(([,a], [,b]) => (b.lastUpdated || 0) - (a.lastUpdated || 0));
                
                const content = document.getElementById('adminContent');
                
                content.innerHTML = `
                    <div class="content-header">
                        <h3 class="content-title">âœï¸ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª Ø§Ù„Ù…Ø¹Ø¯Ù„Ø© (${editedProducts.length} Ø¥Ø¹Ù„Ø§Ù†)</h3>
                        <div class="content-controls">
                            <button class="btn btn-success" onclick="approveAllEdits()">
                                âœ“ Ù‚Ø¨ÙˆÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
                            </button>
                        </div>
                    </div>
                    
                    <div style="padding: 20px;">
                        ${editedProducts.length > 0 ? editedProducts.map(([productId, product]) => {
                            const seller = allUsers[product.uid] || {};
                            return `
                                <div class="approval-card edited">
                                    <div class="approval-header">
                                        <div class="approval-title">${product.name || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…'}</div>
                                        <div style="display: flex; gap: 8px;">
                                            <span class="status-badge status-edited-pending">ØªØ¹Ø¯ÙŠÙ„</span>
                                            <span style="font-size: 11px; color: #9ca3af;">
                                                ${formatDateTime(product.lastUpdated)}
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <div style="margin: 15px 0; padding: 15px; background: #1f2937; border-radius: 8px;">
                                        <div style="color: #38bdf8; font-size: 13px; margin-bottom: 10px; font-weight: bold;">
                                            ğŸ“ ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†
                                        </div>
                                        <div style="font-size: 12px; color: #9ca3af;">
                                            Ù‚Ø§Ù… <strong>${seller.fullName || seller.username || product.seller || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</strong> 
                                            Ø¨ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† ÙÙŠ ${formatDateTime(product.lastUpdated)}
                                        </div>
                                    </div>
                                    
                                    <div class="approval-meta">
                                        <span>ğŸ’° <strong>${product.price ? parseInt(product.price).toLocaleString('ar-SA') + ' Ø¯.Ø¹' : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</strong></span>
                                        <span>ğŸ“‚ ${product.category || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                                        <span>ğŸ“ ${product.province || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                                        <span>ğŸšš ${product.delivery || 'Ù„Ø§'}</span>
                                    </div>
                                    
                                    ${product.images && product.images.length > 0 ? `
                                        <div style="margin: 10px 0;">
                                            <div style="color: #9ca3af; font-size: 12px; margin-bottom: 5px;">Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:</div>
                                            <img src="${product.images[0]}" 
                                                 style="width: 100%; max-width: 300px; height: 180px; object-fit: cover; border-radius: 6px; border: 2px solid #38bdf8;"
                                                 onerror="this.src='https://via.placeholder.com/300x180/1f2937/9ca3af?text=Ù„Ø§+ØªÙˆØ¬Ø¯+ØµÙˆØ±Ø©'">
                                        </div>
                                    ` : ''}
                                    
                                    <div class="approval-actions">
                                        <button class="btn btn-primary" onclick="reviewEditedProduct('${productId}')">
                                            ğŸ‘ï¸ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
                                        </button>
                                        <button class="btn btn-success" onclick="approveEditDirect('${productId}')">
                                            âœ“ Ù‚Ø¨ÙˆÙ„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
                                        </button>
                                        <button class="btn btn-danger" onclick="rejectEditDirect('${productId}')">
                                            âœ— Ø±ÙØ¶ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
                                        </button>
                                    </div>
                                </div>
                            `;
                        }).join('') : `
                            <div style="text-align: center; padding: 40px; color: #9ca3af;">
                                <div style="font-size: 48px; margin-bottom: 10px;">âœ…</div>
                                <h4>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ù…Ø¹Ù„Ù‚Ø©</h4>
                                <p>Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª ØªÙ…Øª Ù…Ø¹Ø§Ù„Ø¬ØªÙ‡Ø§</p>
                            </div>
                        `}
                    </div>
                `;
                
                hideLoading();
            } catch (error) {
                console.error("âŒ Error loading edited products:", error);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ø¯Ù„Ø©', 'error');
                hideLoading();
            }
        }
        
        // Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¥Ø¹Ù„Ø§Ù† Ù…Ø¹Ù„Ù‚
        async function reviewProduct(productId) {
            showLoading();
            
            try {
                const snapshot = await db.ref('products/' + productId).once('value');
                const product = snapshot.val();
                
                if (!product) {
                    showNotification('Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
                    hideLoading();
                    return;
                }
                
                const seller = allUsers[product.uid] || {};
                currentApprovalProduct = { id: productId, data: product };
                
                document.getElementById('approvalModalTitle').textContent = 'â³ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¥Ø¹Ù„Ø§Ù† Ø¬Ø¯ÙŠØ¯';
                
                document.getElementById('approvalModalBody').innerHTML = `
                    <div class="comparison-container">
                        <h4 style="color: #38bdf8; margin-bottom: 15px;">ğŸ“‹ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                            <div style="background: #374151; padding: 15px; border-radius: 8px;">
                                <div style="color: #9ca3af; font-size: 12px; margin-bottom: 5px;">Ø§Ø³Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©</div>
                                <div style="font-weight: bold; font-size: 16px; color: #e5e7eb;">${product.name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                            </div>
                            <div style="background: #374151; padding: 15px; border-radius: 8px;">
                                <div style="color: #9ca3af; font-size: 12px; margin-bottom: 5px;">Ø§Ù„Ø³Ø¹Ø±</div>
                                <div style="font-weight: bold; font-size: 18px; color: #38bdf8;">${product.price ? parseInt(product.price).toLocaleString('ar-SA') + ' Ø¯.Ø¹' : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                            <div style="background: #374151; padding: 15px; border-radius: 8px;">
                                <div style="color: #9ca3af; font-size: 12px; margin-bottom: 5px;">Ø§Ù„Ù‚Ø³Ù…</div>
                                <div style="font-weight: bold; font-size: 14px; color: #e5e7eb;">${product.category || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                            </div>
                            <div style="background: #374151; padding: 15px; border-radius: 8px;">
                                <div style="color: #9ca3af; font-size: 12px; margin-bottom: 5px;">Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</div>
                                <div style="font-weight: bold; font-size: 14px; color: #e5e7eb;">${product.province || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                            </div>
                        </div>
                        
                        <div style="background: #374151; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <div style="color: #9ca3af; font-size: 12px; margin-bottom: 5px;">Ø§Ù„ØªÙˆØµÙŠÙ„</div>
                            <div style="font-weight: bold; font-size: 14px; color: #e5e7eb;">${product.delivery || 'Ù„Ø§'}</div>
                        </div>
                        
                        <div style="background: #374151; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <div style="color: #9ca3af; font-size: 12px; margin-bottom: 5px;">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¨Ø§Ø¦Ø¹</div>
                            <div style="display: flex; align-items: center; gap: 10px; margin-top: 10px;">
                                <div style="width: 40px; height: 40px; background: #10b981; border-radius: 50%; 
                                            display: flex; align-items: center; justify-content: center; 
                                            color: white; font-weight: bold; font-size: 16px;">
                                    ${(seller.fullName || seller.username || product.seller || '?').charAt(0).toUpperCase()}
                                </div>
                                <div>
                                    <div style="font-weight: bold; font-size: 14px; color: #e5e7eb;">
                                        <span class="user-name-wrapper">
                                            ${seller.isVerified ? '<span class="verified-badge">âœ“</span>' : ''}
                                            ${seller.fullName || seller.username || product.seller || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}
                                        </span>
                                    </div>
                                    <div style="font-size: 12px; color: #9ca3af;">${product.phone || 'Ø¨Ø¯ÙˆÙ† Ø±Ù‚Ù…'}</div>
                                    <div style="font-size: 11px; color: #9ca3af; margin-top: 2px;">
                                        ${seller.email || 'Ø¨Ø¯ÙˆÙ† Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ'}
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        ${product.images && product.images.length > 0 ? `
                            <div style="background: #374151; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                                <div style="color: #9ca3af; font-size: 12px; margin-bottom: 10px;">ØµÙˆØ±Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</div>
                                <div style="text-align: center;">
                                    <img src="${product.images[0]}" 
                                         style="max-width: 100%; max-height: 300px; border-radius: 8px; border: 2px solid #1f2937;"
                                         onerror="this.src='https://via.placeholder.com/500x300/1f2937/9ca3af?text=Ù„Ø§+ØªÙˆØ¬Ø¯+ØµÙˆØ±Ø©'">
                                </div>
                            </div>
                        ` : ''}
                        
                        <div style="background: #1f2937; padding: 15px; border-radius: 8px;">
                            <div style="color: #9ca3af; font-size: 12px; margin-bottom: 5px;">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</div>
                            <div style="font-size: 12px; color: #9ca3af;">
                                <div>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ø´Ø±: ${product.timestamp ? formatDateTime(product.timestamp) : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
                                <div>Ù…Ø¹Ø±Ù Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†: ${productId}</div>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('approvalModal').style.display = 'flex';
                hideLoading();
            } catch (error) {
                console.error("âŒ Error reviewing product:", error);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†', 'error');
                hideLoading();
            }
        }
        
        // Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¥Ø¹Ù„Ø§Ù† Ù…Ø¹Ø¯Ù„
        async function reviewEditedProduct(productId) {
            showLoading();
            
            try {
                const snapshot = await db.ref('products/' + productId).once('value');
                const product = snapshot.val();
                
                if (!product) {
                    showNotification('Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
                    hideLoading();
                    return;
                }
                
                const seller = allUsers[product.uid] || {};
                currentApprovalProduct = { id: productId, data: product };
                
                document.getElementById('approvalModalTitle').textContent = 'âœï¸ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª';
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ Ø¨ÙŠØ§Ù†Ø§Øª Ø£ØµÙ„ÙŠØ© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„
                const hasOriginalData = product.originalData && Object.keys(product.originalData).length > 0;
                
                document.getElementById('approvalModalBody').innerHTML = `
                    <div class="comparison-container">
                        <h4 style="color: #38bdf8; margin-bottom: 15px;">ğŸ“Š Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</h4>
                        
                        ${hasOriginalData ? `
                            <div style="margin-bottom: 20px;">
                                <div style="color: #9ca3af; font-size: 12px; margin-bottom: 10px;">Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø©:</div>
                                <div class="comparison-row">
                                    <div class="comparison-item">
                                        <div class="comparison-label">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ©</div>
                                        <div class="comparison-value">${product.originalData.name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                                    </div>
                                    <div class="comparison-item">
                                        <div class="comparison-label">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ø¯Ù„Ø©</div>
                                        <div class="comparison-value ${product.originalData.name !== product.name ? 'changed' : ''}">${product.name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                                    </div>
                                </div>
                                
                                <div class="comparison-row">
                                    <div class="comparison-item">
                                        <div class="comparison-label">Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£ØµÙ„ÙŠ</div>
                                        <div class="comparison-value">${product.originalData.price ? parseInt(product.originalData.price).toLocaleString('ar-SA') + ' Ø¯.Ø¹' : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                                    </div>
                                    <div class="comparison-item">
                                        <div class="comparison-label">Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ø¹Ø¯Ù„</div>
                                        <div class="comparison-value ${product.originalData.price !== product.price ? 'changed' : ''}">${product.price ? parseInt(product.price).toLocaleString('ar-SA') + ' Ø¯.Ø¹' : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                                    </div>
                                </div>
                                
                                <div class="comparison-row">
                                    <div class="comparison-item">
                                        <div class="comparison-label">Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø£ØµÙ„ÙŠ</div>
                                        <div class="comparison-value">${product.originalData.category || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                                    </div>
                                    <div class="comparison-item">
                                        <div class="comparison-label">Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø¹Ø¯Ù„</div>
                                        <div class="comparison-value ${product.originalData.category !== product.category ? 'changed' : ''}">${product.category || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                                    </div>
                                </div>
                                
                                <div class="comparison-row">
                                    <div class="comparison-item">
                                        <div class="comparison-label">Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©</div>
                                        <div class="comparison-value">${getStatusText(product.originalData.status2 || 'available')}</div>
                                    </div>
                                    <div class="comparison-item">
                                        <div class="comparison-label">Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø¹Ø¯Ù„Ø©</div>
                                        <div class="comparison-value ${product.originalData.status2 !== product.status2 ? 'changed' : ''}">${getStatusText(product.status2 || 'available')}</div>
                                    </div>
                                </div>
                            </div>
                            
                            ${product.originalData.images && product.originalData.images.length > 0 ? `
                                <div style="margin-bottom: 20px;">
                                    <div style="color: #9ca3af; font-size: 12px; margin-bottom: 10px;">Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„ØµÙˆØ±:</div>
                                    <div class="image-comparison">
                                        <div>
                                            <img src="${product.originalData.images[0] || 'https://via.placeholder.com/150x100/1f2937/9ca3af?text=ØµÙˆØ±Ø©+Ù‚Ø¯ÙŠÙ…Ø©'}" 
                                                 onerror="this.src='https://via.placeholder.com/150x100/1f2937/9ca3af?text=Ù„Ø§+ØªÙˆØ¬Ø¯+ØµÙˆØ±Ø©'">
                                            <div class="image-label">Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©</div>
                                        </div>
                                        <div>
                                            <img src="${product.images && product.images.length > 0 ? product.images[0] : 'https://via.placeholder.com/150x100/1f2937/38bdf8?text=ØµÙˆØ±Ø©+Ø¬Ø¯ÙŠØ¯Ø©'}" 
                                                 class="${product.originalData.images[0] !== (product.images && product.images[0]) ? 'new' : ''}"
                                                 onerror="this.src='https://via.placeholder.com/150x100/1f2937/38bdf8?text=Ù„Ø§+ØªÙˆØ¬Ø¯+ØµÙˆØ±Ø©'">
                                            <div class="image-label">Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø¹Ø¯Ù„Ø©</div>
                                        </div>
                                    </div>
                                </div>
                            ` : ''}
                        ` : `
                            <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); 
                                        padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                                <div style="color: #f59e0b; font-size: 14px; font-weight: bold; margin-bottom: 5px;">âš ï¸ Ù…Ù„Ø§Ø­Ø¸Ø©</div>
                                <div style="color: #9ca3af; font-size: 12px;">
                                    Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø£ØµÙ„ÙŠØ© Ù…Ø®Ø²Ù†Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†. Ø±Ø¨Ù…Ø§ ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø¥Ø¹Ù„Ø§Ù† ÙƒØ§Ù† Ù…Ø¹Ù„Ù‚Ø§Ù‹ Ø³Ø§Ø¨Ù‚Ø§Ù‹.
                                </div>
                            </div>
                        `}
                        
                        <div style="background: #374151; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <div style="color: #9ca3af; font-size: 12px; margin-bottom: 10px;">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„Ø­Ø§Ù„ÙŠ:</div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 13px;">
                                <div>
                                    <div style="color: #9ca3af;">Ø§Ù„Ø§Ø³Ù…:</div>
                                    <div style="color: #e5e7eb; font-weight: bold;">${product.name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                                </div>
                                <div>
                                    <div style="color: #9ca3af;">Ø§Ù„Ø³Ø¹Ø±:</div>
                                    <div style="color: #38bdf8; font-weight: bold;">${product.price ? parseInt(product.price).toLocaleString('ar-SA') + ' Ø¯.Ø¹' : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                                </div>
                                <div>
                                    <div style="color: #9ca3af;">Ø§Ù„Ù‚Ø³Ù…:</div>
                                    <div style="color: #e5e7eb;">${product.category || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                                </div>
                                <div>
                                    <div style="color: #9ca3af;">Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©:</div>
                                    <div style="color: #e5e7eb;">${product.province || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                                </div>
                                <div>
                                    <div style="color: #9ca3af;">Ø§Ù„Ø­Ø§Ù„Ø©:</div>
                                    <div style="color: #e5e7eb; font-weight: bold;">${getStatusText(product.status2 || 'available')}</div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="background: #1f2937; padding: 15px; border-radius: 8px;">
                            <div style="color: #9ca3af; font-size: 12px; margin-bottom: 5px;">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¨Ø§Ø¦Ø¹:</div>
                            <div style="display: flex; align-items: center; gap: 10px; margin-top: 10px;">
                                <div style="width: 40px; height: 40px; background: #9333ea; border-radius: 50%; 
                                            display: flex; align-items: center; justify-content: center; 
                                            color: white; font-weight: bold; font-size: 16px;">
                                    ${(seller.fullName || seller.username || product.seller || '?').charAt(0).toUpperCase()}
                                </div>
                                <div>
                                    <div style="font-weight: bold; font-size: 14px; color: #e5e7eb;">
                                        <span class="user-name-wrapper">
                                            ${seller.isVerified ? '<span class="verified-badge">âœ“</span>' : ''}
                                            ${seller.fullName || seller.username || product.seller || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}
                                        </span>
                                    </div>
                                    <div style="font-size: 12px; color: #9ca3af;">${product.phone || 'Ø¨Ø¯ÙˆÙ† Ø±Ù‚Ù…'}</div>
                                    <div style="font-size: 11px; color: #9ca3af; margin-top: 2px;">
                                        Ø¢Ø®Ø± ØªØ¹Ø¯ÙŠÙ„: ${product.lastUpdated ? formatDateTime(product.lastUpdated) : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('approvalModal').style.display = 'flex';
                hideLoading();
            } catch (error) {
                console.error("âŒ Error reviewing edited product:", error);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª', 'error');
                hideLoading();
            }
        }
        
        // Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø¥Ø¹Ù„Ø§Ù† Ù…Ø¨Ø§Ø´Ø±Ø©
        async function approveProductDirect(productId) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ØŸ')) {
                showLoading();
                
                try {
                    await db.ref('products/' + productId).update({
                        status: PRODUCT_STATUS.APPROVED,
                        approvedAt: firebase.database.ServerValue.TIMESTAMP,
                        approvedBy: currentUser.uid,
                        lastUpdated: firebase.database.ServerValue.TIMESTAMP
                    });
                    
                    // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
                    const productSnapshot = await db.ref('products/' + productId).once('value');
                    const product = productSnapshot.val();
                    
                    if (product && product.uid) {
                        await db.ref('notifications/' + product.uid).push().set({
                            title: 'ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø¥Ø¹Ù„Ø§Ù†Ùƒ',
                            message: `ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø¥Ø¹Ù„Ø§Ù†Ùƒ "${product.name}" ÙˆÙ‡Ùˆ Ø§Ù„Ø¢Ù† Ù…Ø±Ø¦ÙŠ Ù„Ù„Ø¬Ù…ÙŠØ¹`,
                            type: 'success',
                            read: false,
                            timestamp: firebase.database.ServerValue.TIMESTAMP
                        });
                    }
                    
                    showNotification('ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                    if (currentTab === 'pending') {
                        loadPendingProducts();
                    } else if (currentTab === 'dashboard') {
                        loadDashboard();
                    }
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª
                    updatePendingCounts();
                    
                    hideLoading();
                } catch (error) {
                    console.error("âŒ Error approving product:", error);
                    showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†', 'error');
                    hideLoading();
                }
            }
        }
        
        // Ø±ÙØ¶ Ø¥Ø¹Ù„Ø§Ù† Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ø¹ Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø©
        async function rejectProductDirect(productId) {
            const reason = prompt('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):', '');
            
            if (reason !== null) { // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù… ÙŠØ¶ØºØ· Ø¥Ù„ØºØ§Ø¡
                if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ÙØ¶ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† ÙˆØµÙˆØ±Ù‡.')) {
                    showLoading();
                    
                    try {
                        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø£ÙˆÙ„Ø§Ù‹ Ù„Ø­Ø°Ù Ø§Ù„ØµÙˆØ±
                        const productSnapshot = await db.ref('products/' + productId).once('value');
                        const product = productSnapshot.val();
                        
                        // Ø­Ø°Ù Ø§Ù„ØµÙˆØ± Ù…Ù† Supabase
                        if (product && product.images && product.images.length > 0) {
                            for (let imageUrl of product.images) {
                                await deleteImageFromSupabase(imageUrl);
                            }
                        }
                        
                        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø¥Ù„Ù‰ Ù…Ø±ÙÙˆØ¶
                        await db.ref('products/' + productId).update({
                            status: PRODUCT_STATUS.REJECTED,
                            rejectedAt: firebase.database.ServerValue.TIMESTAMP,
                            rejectedBy: currentUser.uid,
                            rejectionReason: reason || '',
                            lastUpdated: firebase.database.ServerValue.TIMESTAMP
                        });
                        
                        // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
                        if (product && product.uid) {
                            await db.ref('notifications/' + product.uid).push().set({
                                title: 'ØªÙ… Ø±ÙØ¶ Ø¥Ø¹Ù„Ø§Ù†Ùƒ',
                                message: `ØªÙ… Ø±ÙØ¶ Ø¥Ø¹Ù„Ø§Ù†Ùƒ "${product.name}"${reason ? 'ØŒ Ø§Ù„Ø³Ø¨Ø¨: ' + reason : ''}`,
                                type: 'error',
                                read: false,
                                timestamp: firebase.database.ServerValue.TIMESTAMP
                            });
                        }
                        
                        showNotification('ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø¨Ù†Ø¬Ø§Ø­', 'success');
                        
                        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                        if (currentTab === 'pending') {
                            loadPendingProducts();
                        } else if (currentTab === 'dashboard') {
                            loadDashboard();
                        }
                        
                        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª
                        updatePendingCounts();
                        
                        hideLoading();
                    } catch (error) {
                        console.error("âŒ Error rejecting product:", error);
                        showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¶ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†', 'error');
                        hideLoading();
                    }
                }
            }
        }
        
        // Ù‚Ø¨ÙˆÙ„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø©
        async function approveEditDirect(productId) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù‚Ø¨ÙˆÙ„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ØŸ')) {
                showLoading();
                
                try {
                    const productSnapshot = await db.ref('products/' + productId).once('value');
                    const product = productSnapshot.val();
                    
                    if (!product) {
                        showNotification('Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
                        hideLoading();
                        return;
                    }
                    
                    // ØªØ­Ø¶ÙŠØ± Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª
                    const updates = {
                        status: PRODUCT_STATUS.APPROVED,
                        approvedAt: firebase.database.ServerValue.TIMESTAMP,
                        approvedBy: currentUser.uid,
                        lastUpdated: firebase.database.ServerValue.TIMESTAMP
                    };
                    
                    // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ Ø­Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ status2ØŒ Ø§Ø­ÙØ¸Ù‡Ø§
                    if (product.status2) {
                        updates.status2 = product.status2;
                    }
                    
                    // Ø­Ø°Ù Ø­Ù‚Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ© Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
                    if (product.originalData) {
                        updates.originalData = null;
                    }
                    
                    await db.ref('products/' + productId).update(updates);
                    
                    // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
                    if (product.uid) {
                        await db.ref('notifications/' + product.uid).push().set({
                            title: 'ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¥Ø¹Ù„Ø§Ù†Ùƒ',
                            message: `ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¥Ø¹Ù„Ø§Ù†Ùƒ "${product.name}"`,
                            type: 'success',
                            read: false,
                            timestamp: firebase.database.ServerValue.TIMESTAMP
                        });
                    }
                    
                    showNotification('ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                    if (currentTab === 'edited') {
                        loadEditedProducts();
                    } else if (currentTab === 'dashboard') {
                        loadDashboard();
                    }
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª
                    updatePendingCounts();
                    
                    hideLoading();
                } catch (error) {
                    console.error("âŒ Error approving edit:", error);
                    showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù‚Ø¨ÙˆÙ„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª', 'error');
                    hideLoading();
                }
            }
        }
        
        // Ø±ÙØ¶ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ù…Ø¹ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ©
        async function rejectEditDirect(productId) {
            const reason = prompt('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¨Ø¨ Ø±ÙØ¶ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):', '');
            
            if (reason !== null) {
                if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ÙØ¶ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§ØªØŸ Ø³ÙŠØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ©.')) {
                    showLoading();
                    
                    try {
                        const productSnapshot = await db.ref('products/' + productId).once('value');
                        const product = productSnapshot.val();
                        
                        if (!product) {
                            showNotification('Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
                            hideLoading();
                            return;
                        }
                        
                        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ Ø¨ÙŠØ§Ù†Ø§Øª Ø£ØµÙ„ÙŠØ©
                        if (product.originalData) {
                            // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ© ÙˆØ­Ø°Ù Ø§Ù„ØµÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                            const originalData = product.originalData;
                            
                            // Ø­Ø°Ù Ø§Ù„ØµÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù† Supabase
                            if (product.images && product.images.length > 0) {
                                // Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„ØµÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù…Ø¹ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
                                const hasNewImage = !originalData.images || 
                                                   originalData.images.length === 0 || 
                                                   product.images[0] !== originalData.images[0];
                                
                                if (hasNewImage && product.images[0]) {
                                    await deleteImageFromSupabase(product.images[0]);
                                }
                            }
                            
                            // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ©
                            await db.ref('products/' + productId).update({
                                ...originalData,
                                status: PRODUCT_STATUS.APPROVED, // Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©
                                lastUpdated: firebase.database.ServerValue.TIMESTAMP,
                                editRejectedAt: firebase.database.ServerValue.TIMESTAMP,
                                editRejectedBy: currentUser.uid,
                                editRejectionReason: reason || '',
                                originalData: null // Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ© Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©
                            });
                        } else {
                            // Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù‡Ù†Ø§Ùƒ Ø¨ÙŠØ§Ù†Ø§Øª Ø£ØµÙ„ÙŠØ©ØŒ Ù†Ø±ÙØ¶ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆÙ†Ø­ÙˆÙ„ Ù„Ù„Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„Ù…Ø¹ØªÙ…Ø¯
                            await db.ref('products/' + productId).update({
                                status: PRODUCT_STATUS.APPROVED,
                                lastUpdated: firebase.database.ServerValue.TIMESTAMP,
                                editRejectedAt: firebase.database.ServerValue.TIMESTAMP,
                                editRejectedBy: currentUser.uid,
                                editRejectionReason: reason || ''
                            });
                        }
                        
                        // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
                        if (product.uid) {
                            await db.ref('notifications/' + product.uid).push().set({
                                title: 'ØªÙ… Ø±ÙØ¶ ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¥Ø¹Ù„Ø§Ù†Ùƒ',
                                message: `ØªÙ… Ø±ÙØ¶ ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¥Ø¹Ù„Ø§Ù†Ùƒ "${product.name}"${reason ? 'ØŒ Ø§Ù„Ø³Ø¨Ø¨: ' + reason : ''}`,
                                type: 'warning',
                                read: false,
                                timestamp: firebase.database.ServerValue.TIMESTAMP
                            });
                        }
                        
                        showNotification('ØªÙ… Ø±ÙØ¶ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
                        
                        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                        if (currentTab === 'edited') {
                            loadEditedProducts();
                        } else if (currentTab === 'dashboard') {
                            loadDashboard();
                        }
                        
                        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª
                        updatePendingCounts();
                        
                        hideLoading();
                    } catch (error) {
                        console.error("âŒ Error rejecting edit:", error);
                        showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¶ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª', 'error');
                        hideLoading();
                    }
                }
            }
        }
        
        // Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©
        async function approveAllPending() {
            if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© (${pendingProducts.length} Ø¥Ø¹Ù„Ø§Ù†)ØŸ`)) {
                showLoading();
                
                try {
                    let approvedCount = 0;
                    
                    for (const [productId, product] of pendingProducts) {
                        await db.ref('products/' + productId).update({
                            status: PRODUCT_STATUS.APPROVED,
                            approvedAt: firebase.database.ServerValue.TIMESTAMP,
                            approvedBy: currentUser.uid,
                            lastUpdated: firebase.database.ServerValue.TIMESTAMP
                        });
                        
                        approvedCount++;
                    }
                    
                    showNotification(`ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ ${approvedCount} Ø¥Ø¹Ù„Ø§Ù† Ø¨Ù†Ø¬Ø§Ø­`, 'success');
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©
                    loadPendingProducts();
                    updatePendingCounts();
                    
                    hideLoading();
                } catch (error) {
                    console.error("âŒ Error approving all pending:", error);
                    showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª', 'error');
                    hideLoading();
                }
            }
        }
        
        // Ù‚Ø¨ÙˆÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
        async function approveAllEdits() {
            if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù‚Ø¨ÙˆÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª (${editedProducts.length} Ø¥Ø¹Ù„Ø§Ù†)ØŸ`)) {
                showLoading();
                
                try {
                    let approvedCount = 0;
                    
                    for (const [productId, product] of editedProducts) {
                        const updates = {
                            status: PRODUCT_STATUS.APPROVED,
                            approvedAt: firebase.database.ServerValue.TIMESTAMP,
                            approvedBy: currentUser.uid,
                            lastUpdated: firebase.database.ServerValue.TIMESTAMP
                        };
                        
                        // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ Ø­Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ status2ØŒ Ø§Ø­ÙØ¸Ù‡Ø§
                        if (product.status2) {
                            updates.status2 = product.status2;
                        }
                        
                        // Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ©
                        if (product.originalData) {
                            updates.originalData = null;
                        }
                        
                        await db.ref('products/' + productId).update(updates);
                        
                        approvedCount++;
                    }
                    
                    showNotification(`ØªÙ… Ù‚Ø¨ÙˆÙ„ ØªØ¹Ø¯ÙŠÙ„Ø§Øª ${approvedCount} Ø¥Ø¹Ù„Ø§Ù† Ø¨Ù†Ø¬Ø§Ø­`, 'success');
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©
                    loadEditedProducts();
                    updatePendingCounts();
                    
                    hideLoading();
                } catch (error) {
                    console.error("âŒ Error approving all edits:", error);
                    showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù‚Ø¨ÙˆÙ„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª', 'error');
                    hideLoading();
                }
            }
        }
        
        // Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø¥Ø¹Ù„Ø§Ù† Ù…Ù† Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
        async function approveProduct() {
            if (!currentApprovalProduct) return;
            
            await approveProductDirect(currentApprovalProduct.id);
            closeApprovalModal();
        }
        
        // Ø±ÙØ¶ Ø¥Ø¹Ù„Ø§Ù† Ù…Ù† Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
        async function rejectProduct() {
            if (!currentApprovalProduct) return;
            
            await rejectProductDirect(currentApprovalProduct.id);
            closeApprovalModal();
        }
        
        // Ø¥ØºÙ„Ø§Ù‚ Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©
        function closeApprovalModal() {
            document.getElementById('approvalModal').style.display = 'none';
            currentApprovalProduct = null;
        }
        
        // Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø© Ù…Ù† Supabase
        async function deleteImageFromSupabase(imageUrl) {
            try {
                // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·
                const urlParts = imageUrl.split('/');
                const fileName = urlParts[urlParts.length - 1];
                
                if (!fileName) {
                    console.error('âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·:', imageUrl);
                    return false;
                }
                
                const { error } = await supabaseClient.storage
                    .from('ads-images')
                    .remove([`products/${fileName}`]);
                
                if (error) {
                    console.error('âŒ ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø©:', error.message);
                    return false;
                }
                
                console.log(`âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø©: ${fileName}`);
                return true;
            } catch (err) {
                console.error('âŒ Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹ ÙÙŠ Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø©:', err.message || err);
                return false;
            }
        }
        
        // === Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† (Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±) ===
        function loadUsersManagement() {
            showLoading();
            
            db.ref('users').once('value')
                .then(snapshot => {
                    const users = snapshot.val() || {};
                    allUsers = users;
                    
                    const content = document.getElementById('adminContent');
                    
                    content.innerHTML = `
                        <div class="content-header">
                            <h3 class="content-title">ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† (${Object.keys(users).length} Ù…Ø³ØªØ®Ø¯Ù…)</h3>
                            <div class="content-controls">
                                <select class="filter-select" id="userFilter" onchange="filterUsers()">
                                    <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</option>
                                    <option value="verified">Ø§Ù„Ù…ÙˆØ«Ù‘Ù‚ÙŠÙ† ÙÙ‚Ø·</option>
                                    <option value="admin">Ø§Ù„Ù…Ø¯ÙŠØ±ÙŠÙ† ÙÙ‚Ø·</option>
                                </select>
                                <input type="text" class="form-control" id="userSearch" 
                                       placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯..." 
                                       style="width: 200px;" onkeyup="searchUsers()">
                            </div>
                        </div>
                        
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                                        <th>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„</th>
                                        <th>Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</th>
                                        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                        <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTableBody">
                                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
                                </tbody>
                            </table>
                        </div>
                        
                        ${Object.keys(users).length === 0 ? `
                            <div style="text-align: center; padding: 40px; color: #9ca3af;">
                                <div style="font-size: 48px; margin-bottom: 10px;">ğŸ‘¥</div>
                                <h4>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ø³Ø¬Ù„ÙŠÙ†</h4>
                                <p>Ù„Ù… ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø£ÙŠ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</p>
                            </div>
                        ` : ''}
                    `;
                    
                    if (Object.keys(users).length > 0) {
                        displayUsersTable(users);
                    }
                    hideLoading();
                })
                .catch(error => {
                    console.error("âŒ Error loading users:", error);
                    showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†', 'error');
                    hideLoading();
                });
        }
        
        // Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        function displayUsersTable(users, filteredUsers = null) {
            const tbody = document.getElementById('usersTableBody');
            if (!tbody) return;
            
            const usersToDisplay = filteredUsers || Object.entries(users).filter(([_, user]) => user);
            
            tbody.innerHTML = usersToDisplay.map(([userId, user]) => {
                if (!user) return '';
                
                const username = user.username || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…';
                const fullName = user.fullName || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                const email = user.email || 'Ø¨Ø¯ÙˆÙ† Ø¨Ø±ÙŠØ¯';
                const phone = user.phone || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                const productCount = user.totalProducts || 0;
                const isAdmin = user.isAdmin || false;
                const isVerified = user.isVerified || false;
                const lastActive = user.lastActive ? formatDateTime(user.lastActive) : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                const createdAt = user.createdAt ? formatDate(user.createdAt) : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                
                return `
                    <tr data-user-id="${userId}">
                        <td>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <div style="width: 36px; height: 36px; background: #38bdf8; border-radius: 50%; 
                                            display: flex; align-items: center; justify-content: center; 
                                            color: white; font-weight: bold; font-size: 14px;">
                                    ${(fullName || username).charAt(0).toUpperCase()}
                                </div>
                                <div>
                                    <div style="font-weight: 500; font-size: 13px;">
                                        <span class="user-name-wrapper">
                                            ${isVerified ? '<span class="verified-badge">âœ“</span>' : ''}
                                            ${fullName}
                                            ${isAdmin ? '<span style="color:#8b5cf6; font-size:11px;">ğŸ‘‘</span>' : ''}
                                        </span>
                                    </div>
                                    <div style="color: #9ca3af; font-size: 11px;">@${username}</div>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div style="font-size: 12px;">
                                <div>${email}</div>
                                <div style="color: #9ca3af; margin-top: 2px;">${phone}</div>
                                <div style="color: #9ca3af; font-size: 11px; margin-top: 2px;">${createdAt}</div>
                            </div>
                        </td>
                        <td>
                            <div style="display: flex; gap: 12px;">
                                <div style="text-align: center;">
                                    <div style="color: #38bdf8; font-weight: bold; font-size: 16px;">${productCount}</div>
                                    <div style="font-size: 10px; color: #9ca3af;">Ø¥Ø¹Ù„Ø§Ù†</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="color: #10b981; font-weight: bold; font-size: 16px;">${user.followersCount || 0}</div>
                                    <div style="font-size: 10px; color: #9ca3af;">Ù…ØªØ§Ø¨Ø¹</div>
                                </div>
                            </div>
                        </td>
                        <td>
                            ${isVerified ? 
                                '<span class="status-badge status-verified">Ù…ÙˆØ«Ù‘Ù‚</span>' : 
                                '<span class="status-badge status-pending">ØºÙŠØ± Ù…ÙˆØ«Ù‘Ù‚</span>'
                            }
                            <div style="margin-top: 3px; font-size: 10px; color: #9ca3af;">
                                ${lastActive}
                            </div>
                        </td>
                        <td>
                            <div class="action-btns">
                                <button class="btn btn-xs btn-primary" onclick="viewUserDetails('${userId}')">
                                    Ø¹Ø±Ø¶
                                </button>
                                ${isVerified ?
                                    '<button class="btn btn-xs btn-danger" onclick="toggleVerification(\'' + userId + '\', false)">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªÙˆØ«ÙŠÙ‚</button>' :
                                    '<button class="btn btn-xs btn-success" onclick="toggleVerification(\'' + userId + '\', true)">ØªÙˆØ«ÙŠÙ‚</button>'
                                }
                                ${isAdmin ? 
                                    '<button class="btn btn-xs btn-danger" onclick="toggleAdminStatus(\'' + userId + '\', false)">Ø³Ø­Ø¨ Ø§Ù„Ù…Ø¯ÙŠØ±</button>' :
                                    '<button class="btn btn-xs btn-success" onclick="toggleAdminStatus(\'' + userId + '\', true)">Ù…Ù†Ø­ Ø§Ù„Ù…Ø¯ÙŠØ±</button>'
                                }
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        // === Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø© ===
        function loadProductsManagement() {
            showLoading();
            
            db.ref('products').once('value')
                .then(snapshot => {
                    allProducts = snapshot.val() || {};
                    
                    // ØªØµÙÙŠØ© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø© ÙÙ‚Ø·
                    const approvedProducts = Object.entries(allProducts)
                        .filter(([_, product]) => product && product.status === PRODUCT_STATUS.APPROVED);
                    
                    const content = document.getElementById('adminContent');
                    
                    content.innerHTML = `
                        <div class="content-header">
                            <h3 class="content-title">âœ… Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø© (${approvedProducts.length} Ø¥Ø¹Ù„Ø§Ù†)</h3>
                            <div class="content-controls">
                                <select class="filter-select" id="productFilter" onchange="filterProducts()">
                                    <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</option>
                                    <option value="available">Ø§Ù„Ù…ØªØ§Ø­Ø© ÙÙ‚Ø·</option>
                                    <option value="sold">Ø§Ù„Ù…Ø¨Ø§Ø¹Ø©</option>
                                    <option value="reserved">Ø§Ù„Ù…Ø­Ø¬ÙˆØ²Ø©</option>
                                </select>
                                <input type="text" class="form-control" id="productSearch" 
                                       placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©..." 
                                       style="width: 200px;" onkeyup="searchProducts()">
                            </div>
                        </div>
                        
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</th>
                                        <th>Ø§Ù„Ø³Ø¹Ø±</th>
                                        <th>Ø§Ù„Ø¨Ø§Ø¦Ø¹</th>
                                        <th>Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</th>
                                        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                        <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                    </tr>
                                </thead>
                                <tbody id="productsTableBody">
                                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
                                </tbody>
                            </table>
                        </div>
                        
                        ${approvedProducts.length === 0 ? `
                            <div style="text-align: center; padding: 40px; color: #9ca3af;">
                                <div style="font-size: 48px; margin-bottom: 10px;">ğŸ›’</div>
                                <h4>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù…Ø¹ØªÙ…Ø¯Ø©</h4>
                                <p>Ù„Ù… ÙŠØªÙ… Ø§Ø¹ØªÙ…Ø§Ø¯ Ø£ÙŠ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</p>
                            </div>
                        ` : ''}
                    `;
                    
                    if (approvedProducts.length > 0) {
                        displayApprovedProductsTable(approvedProducts);
                    }
                    hideLoading();
                })
                .catch(error => {
                    console.error("âŒ Error loading products:", error);
                    showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª', 'error');
                    hideLoading();
                });
        }
        
        // Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©
        function displayApprovedProductsTable(approvedProducts, filteredProducts = null) {
            const tbody = document.getElementById('productsTableBody');
            if (!tbody) return;
            
            const productsToDisplay = filteredProducts || approvedProducts;
            
            tbody.innerHTML = productsToDisplay.map(([productId, product]) => {
                if (!product) return '';
                
                const price = product.price ? parseInt(product.price).toLocaleString('ar-SA') + ' Ø¯.Ø¹' : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                const seller = allUsers[product.uid] || {};
                const sellerName = seller.fullName || seller.username || product.seller || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                const isVerified = seller.isVerified || false;
                const date = product.timestamp ? formatDate(product.timestamp) : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                const status = product.status2 || 'available';
                
                return `
                    <tr data-product-id="${productId}">
                        <td>
                            <div style="font-weight: 500; font-size: 13px;">${product.name || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…'}</div>
                            <div style="color: #9ca3af; font-size: 11px;">${product.category || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                        </td>
                        <td style="font-weight: bold; color: #38bdf8; font-size: 14px;">
                            ${price}
                        </td>
                        <td>
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <div style="width: 28px; height: 28px; background: #10b981; border-radius: 50%; 
                                            display: flex; align-items: center; justify-content: center; 
                                            color: white; font-size: 11px; font-weight: bold;">
                                    ${sellerName.charAt(0).toUpperCase()}
                                </div>
                                <div>
                                    <div style="font-size: 12px;">
                                        <span class="user-name-wrapper">
                                            ${isVerified ? '<span class="verified-badge" style="font-size:9px;">âœ“</span>' : ''}
                                            ${sellerName}
                                        </span>
                                    </div>
                                    <div style="font-size: 10px; color: #9ca3af;">${product.phone || 'Ø¨Ø¯ÙˆÙ† Ø±Ù‚Ù…'}</div>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div style="font-size: 11px;">
                                <div><strong>Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©:</strong> ${product.province || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                                <div><strong>Ø§Ù„ØªÙˆØµÙŠÙ„:</strong> ${product.delivery || 'Ù„Ø§'}</div>
                                <div style="color: #9ca3af; font-size: 10px;">${date}</div>
                            </div>
                        </td>
                        <td>
                            <span class="status-badge status-${status}">
                                ${getStatusText(status)}
                            </span>
                            <div style="margin-top: 3px;">
                                <select class="form-control" style="padding: 2px 6px; font-size: 11px; width: 80px;" 
                                        onchange="updateProductStatus('${productId}', this.value)">
                                    <option value="available" ${status === 'available' ? 'selected' : ''}>Ù…ØªØ§Ø­</option>
                                    <option value="sold" ${status === 'sold' ? 'selected' : ''}>Ù…Ø¨Ø§Ø¹</option>
                                    <option value="reserved" ${status === 'reserved' ? 'selected' : ''}>Ù…Ø­Ø¬ÙˆØ²</option>
                                </select>
                            </div>
                        </td>
                        <td>
                            <div class="action-btns">
                                <button class="btn btn-xs btn-primary" onclick="viewProductDetails('${productId}')">
                                    Ø¹Ø±Ø¶
                                </button>
                                <button class="btn btn-xs btn-warning" onclick="forceEditProduct('${productId}')">
                                    ØªØ¹Ø¯ÙŠÙ„ Ø¥Ø¬Ø¨Ø§Ø±ÙŠ
                                </button>
                                <button class="btn btn-xs btn-danger" onclick="deleteSingleProduct('${productId}')">
                                    Ø­Ø°Ù
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
        function loadSettings() {
            const content = document.getElementById('adminContent');
            
            content.innerHTML = `
                <div class="content-header">
                    <h3 class="content-title">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
                </div>
                
                <div class="content-body" style="padding: 20px;">
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #38bdf8; margin-bottom: 15px;">ğŸ”’ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©</h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr; gap: 15px;">
                            <div style="background: #1f2937; padding: 15px; border-radius: 8px;">
                                <div style="color: #9ca3af; font-size: 12px; margin-bottom: 5px;">ÙˆØ¶Ø¹ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„ÙŠØ¯ÙˆÙŠØ©</div>
                                <div style="font-size: 14px; color: #e5e7eb;">
                                    Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª ØªØªØ·Ù„Ø¨ Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ù‚Ø¨Ù„ Ø§Ù„Ø¸Ù‡ÙˆØ± Ù„Ù„Ø¬Ù…ÙŠØ¹
                                </div>
                            </div>
                            
                            <div style="background: #1f2937; padding: 15px; border-radius: 8px;">
                                <div style="color: #9ca3af; font-size: 12px; margin-bottom: 5px;">ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</div>
                                <div style="font-size: 14px; color: #e5e7eb;">
                                    Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø© ØªØªØ·Ù„Ø¨ Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #38bdf8; margin-bottom: 15px;">ğŸ—‘ï¸ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr; gap: 10px;">
                            <button class="btn btn-danger" onclick="clearCache()">
                                ğŸ§¹ Ù…Ø³Ø­ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø¤Ù‚ØªØ©
                            </button>
                            <button class="btn btn-primary" onclick="exportData()">
                                ğŸ’¾ Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
                            </button>
                            <button class="btn btn-warning" onclick="cleanupRejectedProducts()">
                                ğŸ—‘ï¸ ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¶Ø©
                            </button>
                        </div>
                    </div>
                    
                    <div>
                        <h4 style="color: #38bdf8; margin-bottom: 15px;">ğŸ“Š Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h4>
                        <div style="background: #1f2937; padding: 15px; border-radius: 8px; font-size: 13px;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
                                <div>
                                    <div style="color: #9ca3af;">Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù…</div>
                                    <div style="color: #38bdf8; font-weight: bold;">a3len v2.1</div>
                                </div>
                                <div>
                                    <div style="color: #9ca3af">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«</div>
                                    <div style="color: #38bdf8; font-weight: bold;">${formatDateTime(Date.now())}</div>
                                </div>
                                <div>
                                    <div style="color: #9ca3af;">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div>
                                    <div style="color: #10b981; font-weight: bold;">${Object.keys(allUsers).length}</div>
                                </div>
                                <div>
                                    <div style="color: #9ca3af;">Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©</div>
                                    <div style="color: #10b981; font-weight: bold;">${Object.entries(allProducts).filter(([_, p]) => p && p.status === PRODUCT_STATUS.APPROVED).length}</div>
                                </div>
                                <div>
                                    <div style="color: #9ca3af;">Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©</div>
                                    <div style="color: #f59e0b; font-weight: bold;">${Object.entries(allProducts).filter(([_, p]) => p && p.status === PRODUCT_STATUS.PENDING).length}</div>
                                </div>
                                <div>
                                    <div style="color: #9ca3af;">Ø§Ù„Ù…Ø¹Ø¯Ù„Ø©</div>
                                    <div style="color: #9333ea; font-weight: bold;">${Object.entries(allProducts).filter(([_, p]) => p && p.status === PRODUCT_STATUS.EDITED_PENDING).length}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            hideLoading();
        }
        
        // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¶Ø©
        async function cleanupRejectedProducts() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªÙ†Ø¸ÙŠÙ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¶Ø©ØŸ Ø³ÙŠØªÙ… Ø­Ø°ÙÙ‡Ø§ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ Ù…Ø¹ ØµÙˆØ±Ù‡Ø§.')) {
                showLoading();
                
                try {
                    const snapshot = await db.ref('products').once('value');
                    const products = snapshot.val() || {};
                    
                    let deletedCount = 0;
                    
                    for (const [productId, product] of Object.entries(products)) {
                        if (product && product.status === PRODUCT_STATUS.REJECTED) {
                            // Ø­Ø°Ù Ø§Ù„ØµÙˆØ± Ù…Ù† Supabase
                            if (product.images && product.images.length > 0) {
                                for (let imageUrl of product.images) {
                                    await deleteImageFromSupabase(imageUrl);
                                }
                            }
                            
                            // Ø­Ø°Ù Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ù…Ù† Firebase
                            await db.ref('products/' + productId).remove();
                            deletedCount++;
                        }
                    }
                    
                    showNotification(`ØªÙ… ØªÙ†Ø¸ÙŠÙ ${deletedCount} Ø¥Ø¹Ù„Ø§Ù† Ù…Ø±ÙÙˆØ¶`, 'success');
                    loadDashboard();
                    hideLoading();
                } catch (error) {
                    console.error("âŒ Error cleaning rejected products:", error);
                    showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¶Ø©', 'error');
                    hideLoading();
                }
            }
        }
        
        // ========================================
        // Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø©
        // ========================================
        
        function showNotification(message, type = 'info') {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <span>${type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : type === 'warning' ? 'âš ï¸' : 'â„¹ï¸'}</span>
                <span>${message}</span>
            `;
            
            container.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 4000);
        }
        
        function showLoading() {
            const loadingEl = document.getElementById('loadingContent');
            if (loadingEl) {
                loadingEl.style.display = 'block';
            }
        }
        
        function hideLoading() {
            const loadingEl = document.getElementById('loadingContent');
            if (loadingEl) {
                loadingEl.style.display = 'none';
            }
        }
        
        function closeUserModal() {
            document.getElementById('userModal').style.display = 'none';
        }
        
        function closeProductModal() {
            document.getElementById('productModal').style.display = 'none';
        }
        
        function getStatusText(status) {
            const statuses = {
                'available': 'Ù…ØªØ§Ø­',
                'sold': 'Ù…Ø¨Ø§Ø¹',
                'reserved': 'Ù…Ø­Ø¬ÙˆØ²',
                'pending': 'Ù…Ø¹Ù„Ù‚',
                'edited_pending': 'ØªØ¹Ø¯ÙŠÙ„ Ù…Ø¹Ù„Ù‚',
                'approved': 'Ù…Ø¹ØªÙ…Ø¯',
                'rejected': 'Ù…Ø±ÙÙˆØ¶'
            };
            return statuses[status] || status;
        }
        
        function formatDate(timestamp) {
            if (!timestamp) return 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
            try {
                const date = new Date(timestamp);
                if (isNaN(date.getTime())) return 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                return date.toLocaleDateString('ar-SA');
            } catch (e) {
                return 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
            }
        }
        
        function formatDateTime(timestamp) {
            if (!timestamp) return 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
            try {
                const date = new Date(timestamp);
                if (isNaN(date.getTime())) return 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                return date.toLocaleString('ar-SA', {
                    year: 'numeric',
                    month: 'numeric',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            } catch (e) {
                return 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
            }
        }
        
        // ========================================
        // Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­ÙƒÙ… (Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£ØµÙ„ÙŠ)
        // ========================================
        
        function toggleAdminStatus(userId, makeAdmin) {
            const action = makeAdmin ? 'Ù…Ù†Ø­ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù…Ø¯ÙŠØ±' : 'Ø³Ø­Ø¨ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù…Ø¯ÙŠØ±';
            if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ${action}ØŸ`)) {
                showLoading();
                db.ref('users/' + userId).update({
                    isAdmin: makeAdmin,
                    lastUpdated: Date.now()
                }).then(() => {
                    const message = makeAdmin ? 'ØªÙ… Ù…Ù†Ø­ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù…Ø¯ÙŠØ±' : 'ØªÙ… Ø³Ø­Ø¨ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù…Ø¯ÙŠØ±';
                    showNotification(message, 'success');
                    loadUsersManagement();
                    hideLoading();
                }).catch(error => {
                    console.error("âŒ Error updating admin status:", error);
                    showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©', 'error');
                    hideLoading();
                });
            }
        }
        
        function toggleVerification(userId, verify) {
            const action = verify ? 'ØªÙˆØ«ÙŠÙ‚' : 'Ø¥Ù„ØºØ§Ø¡ ØªÙˆØ«ÙŠÙ‚';
            if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ${action} Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ`)) {
                showLoading();
                db.ref('users/' + userId).update({
                    isVerified: verify,
                    lastUpdated: Date.now()
                }).then(() => {
                    const message = verify ? 'ØªÙ… ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…' : 'ØªÙ… Ø¥Ù„ØºØ§Ø¡ ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…';
                    showNotification(message, 'success');
                    loadUsersManagement();
                    hideLoading();
                }).catch(error => {
                    console.error("âŒ Error updating verification:", error);
                    showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙˆØ«ÙŠÙ‚', 'error');
                    hideLoading();
                });
            }
        }
        
        function updateProductStatus(productId, newStatus) {
            db.ref('products/' + productId).update({
                status2: newStatus,
                lastUpdated: firebase.database.ServerValue.TIMESTAMP
            }).then(() => {
                showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†', 'success');
            }).catch(error => {
                console.error("âŒ Error updating product status:", error);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©', 'error');
            });
        }
        
        async function deleteSingleProduct(productId) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„ØµÙˆØ± Ø£ÙŠØ¶Ø§Ù‹.')) {
                showLoading();
                
                try {
                    const productSnapshot = await db.ref('products/' + productId).once('value');
                    const product = productSnapshot.val();
                    
                    if (!product) {
                        showNotification('Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
                        hideLoading();
                        return;
                    }
                    
                    // Ø­Ø°Ù Ø§Ù„ØµÙˆØ± Ù…Ù† Supabase
                    if (product.images && product.images.length > 0) {
                        for (let imageUrl of product.images) {
                            await deleteImageFromSupabase(imageUrl);
                        }
                    }
                    
                    // Ø­Ø°Ù Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ù…Ù† Firebase
                    await db.ref('products/' + productId).remove();
                    
                    // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                    if (product.uid) {
                        const userSnapshot = await db.ref('users/' + product.uid).once('value');
                        const userData = userSnapshot.val();
                        if (userData && userData.totalProducts && userData.totalProducts > 0) {
                            await db.ref('users/' + product.uid).update({
                                totalProducts: userData.totalProducts - 1
                            });
                        }
                    }
                    
                    showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                    if (currentTab === 'products') {
                        loadProductsManagement();
                    } else if (currentTab === 'dashboard') {
                        loadDashboard();
                    }
                    
                    hideLoading();
                } catch (error) {
                    console.error("âŒ Error deleting product:", error);
                    showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†', 'error');
                    hideLoading();
                }
            }
        }
        
        function forceEditProduct(productId) {
            // Ù‡Ø°Ø§ Ø§Ù„Ø²Ø± ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¥Ø¹Ù„Ø§Ù† Ù…Ø¨Ø§Ø´Ø±Ø©
            // Ù†ÙØªØ­ ØµÙØ­Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ ÙÙŠ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø©
            window.open(`index.html?edit=${productId}&admin=true`, '_blank');
        }
        
        function refreshAllData() {
            showNotification('Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...', 'info');
            showTab('dashboard');
        }
        
        function performSearch() {
            const query = document.getElementById('globalSearch').value.trim().toLowerCase();
            if (!query) {
                showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù†Øµ Ù„Ù„Ø¨Ø­Ø«', 'warning');
                return;
            }
            
            const userResults = Object.entries(allUsers).filter(([, user]) => 
                user && (
                    (user.fullName && user.fullName.toLowerCase().includes(query)) ||
                    (user.username && user.username.toLowerCase().includes(query)) ||
                    (user.email && user.email.toLowerCase().includes(query))
                )
            );
            
            const productResults = Object.entries(allProducts).filter(([, product]) => 
                product && (
                    (product.name && product.name.toLowerCase().includes(query)) ||
                    (product.seller && product.seller.toLowerCase().includes(query))
                )
            );
            
            const content = document.getElementById('adminContent');
            content.innerHTML = `
                <div class="content-header">
                    <h3 class="content-title">ğŸ” Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù†: "${query}"</h3>
                    <button class="btn btn-outline" onclick="showTab('${currentTab}')">
                        Ø±Ø¬ÙˆØ¹
                    </button>
                </div>
                
                <div class="content-body" style="padding: 20px;">
                    <h4 style="color: #38bdf8; margin-bottom: 12px;">ğŸ‘¥ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† (${userResults.length})</h4>
                    ${userResults.length > 0 ? `
                        <div class="table-container" style="margin-bottom: 20px;">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                                        <th>Ø§Ù„Ø¨Ø±ÙŠØ¯</th>
                                        <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</th>
                                        <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${userResults.slice(0, 5).map(([userId, user]) => `
                                        <tr>
                                            <td>
                                                <span class="user-name-wrapper">
                                                    ${user.isVerified ? '<span class="verified-badge">âœ“</span>' : ''}
                                                    ${user.fullName || user.username || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}
                                                </span>
                                            </td>
                                            <td>${user.email || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</td>
                                            <td>${user.totalProducts || 0}</td>
                                            <td>
                                                <button class="btn btn-xs btn-primary" onclick="viewUserDetails('${userId}')">
                                                    Ø¹Ø±Ø¶
                                                </button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    ` : `
                        <div style="text-align: center; padding: 20px; color: #9ca3af; background: #1f2937; border-radius: 8px; margin-bottom: 20px;">
                            <div style="font-size: 32px; margin-bottom: 10px;">ğŸ‘¤</div>
                            <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</p>
                        </div>
                    `}
                    
                    <h4 style="color: #38bdf8; margin-bottom: 12px;">ğŸ›’ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª (${productResults.length})</h4>
                    ${productResults.length > 0 ? `
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</th>
                                        <th>Ø§Ù„Ø³Ø¹Ø±</th>
                                        <th>Ø§Ù„Ø¨Ø§Ø¦Ø¹</th>
                                        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                        <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${productResults.slice(0, 5).map(([productId, product]) => {
                                        const seller = allUsers[product.uid] || {};
                                        const status = product.status || PRODUCT_STATUS.PENDING;
                                        return `
                                            <tr>
                                                <td>${product.name || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…'}</td>
                                                <td>${product.price ? parseInt(product.price).toLocaleString('ar-SA') + ' Ø¯.Ø¹' : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                                                <td>
                                                    <span class="user-name-wrapper">
                                                        ${seller.isVerified ? '<span class="verified-badge">âœ“</span>' : ''}
                                                        ${seller.fullName || seller.username || product.seller || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}
                                                    </span>
                                                </td>
                                                <td><span class="status-badge status-${status}">
                                                    ${getStatusText(status)}
                                                </span></td>
                                                <td>
                                                    <button class="btn btn-xs btn-primary" onclick="viewProductDetails('${productId}')">
                                                        Ø¹Ø±Ø¶
                                                    </button>
                                                </td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                    ` : `
                        <div style="text-align: center; padding: 20px; color: #9ca3af; background: #1f2937; border-radius: 8px;">
                            <div style="font-size: 32px; margin-bottom: 10px;">ğŸ›’</div>
                            <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</p>
                        </div>
                    `}
                </div>
            `;
        }
        
        function handleGlobalSearch(event) {
            if (event.key === 'Enter') {
                performSearch();
            }
        }
        
        function exportData() {
            try {
                const data = {
                    users: allUsers,
                    products: allProducts,
                    exportedAt: new Date().toISOString(),
                    exportedBy: currentUser?.uid,
                    exportType: 'admin_backup'
                };
                
                const dataStr = JSON.stringify(data, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `a3len-admin-backup-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showNotification('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
            } catch (error) {
                console.error("âŒ Error exporting data:", error);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
            }
        }
        
        // ========================================
        // Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
        // ========================================
        
        function toggleFeature(feature, enable) {
            showNotification(`ØªÙ… ${enable ? 'ØªÙØ¹ÙŠÙ„' : 'ØªØ¹Ø·ÙŠÙ„'} ${feature === 'twoFactor' ? 'Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ø®Ø·ÙˆØªÙŠÙ†' : 'Ø§Ù„Ù…ÙŠØ²Ø©'}`, 'info');
        }
        
        function clearCache() {
            // Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
            allUsers = {};
            allProducts = {};
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            showNotification('ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø¤Ù‚ØªØ© ÙˆØ¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'success');
            refreshAllData();
        }
        
        // ========================================
        // ØªØµÙÙŠØ© ÙˆØ¨Ø­Ø« (Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª)
        // ========================================
        
        function filterUsers() {
            const filter = document.getElementById('userFilter').value;
            const searchTerm = document.getElementById('userSearch')?.value.toLowerCase() || '';
            
            let filteredUsers = Object.entries(allUsers).filter(([_, user]) => user);
            
            if (filter === 'verified') {
                filteredUsers = filteredUsers.filter(([, user]) => user.isVerified);
            } else if (filter === 'admin') {
                filteredUsers = filteredUsers.filter(([, user]) => user.isAdmin);
            }
            
            if (searchTerm) {
                filteredUsers = filteredUsers.filter(([, user]) =>
                    (user.fullName && user.fullName.toLowerCase().includes(searchTerm)) ||
                    (user.username && user.username.toLowerCase().includes(searchTerm)) ||
                    (user.email && user.email.toLowerCase().includes(searchTerm))
                );
            }
            
            displayUsersTable(allUsers, filteredUsers);
        }
        
        function searchUsers() {
            filterUsers();
        }
        
        function filterProducts() {
            const filter = document.getElementById('productFilter').value;
            const searchTerm = document.getElementById('productSearch')?.value.toLowerCase() || '';
            
            let filteredProducts = Object.entries(allProducts)
                .filter(([_, product]) => product && product.status === PRODUCT_STATUS.APPROVED);
            
            if (filter === 'available') {
                filteredProducts = filteredProducts.filter(([, product]) => (product.status2 || 'available') === 'available');
            } else if (filter === 'sold') {
                filteredProducts = filteredProducts.filter(([, product]) => product.status2 === 'sold');
            } else if (filter === 'reserved') {
                filteredProducts = filteredProducts.filter(([, product]) => product.status2 === 'reserved');
            }
            
            if (searchTerm) {
                filteredProducts = filteredProducts.filter(([, product]) =>
                    (product.name && product.name.toLowerCase().includes(searchTerm))
                );
            }
            
            displayApprovedProductsTable(Object.entries(allProducts)
                .filter(([_, product]) => product && product.status === PRODUCT_STATUS.APPROVED), 
                filteredProducts);
        }
        
        function searchProducts() {
            filterProducts();
        }
        
        // ========================================
        // Ø¯ÙˆØ§Ù„ Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ ÙˆØ§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£ØµÙ„ÙŠ)
        // ========================================
        
        async function viewUserDetails(userId) {
            showLoading();
            
            try {
                const userSnapshot = await db.ref('users/' + userId).once('value');
                const user = userSnapshot.val();
                
                if (!user) {
                    showNotification('Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
                    hideLoading();
                    return;
                }
                
                const modalBody = document.getElementById('userModalBody');
                const fullName = user.fullName || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                const username = user.username || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…';
                const email = user.email || 'Ø¨Ø¯ÙˆÙ† Ø¨Ø±ÙŠØ¯';
                const phone = user.phone || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                const bio = user.bio || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ Ø´Ø®ØµÙŠ';
                const createdAt = user.createdAt ? formatDateTime(user.createdAt) : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                const lastActive = user.lastActive ? formatDateTime(user.lastActive) : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                const isAdmin = user.isAdmin || false;
                const isVerified = user.isVerified || false;
                
                // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                const productsSnapshot = await db.ref('products').orderByChild('uid').equalTo(userId).once('value');
                const userProducts = productsSnapshot.val() || {};
                const productCount = Object.keys(userProducts).length;
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©
                const pendingCount = Object.values(userProducts).filter(p => p.status === PRODUCT_STATUS.PENDING).length;
                const approvedCount = Object.values(userProducts).filter(p => p.status === PRODUCT_STATUS.APPROVED).length;
                const editedCount = Object.values(userProducts).filter(p => p.status === PRODUCT_STATUS.EDITED_PENDING).length;
                const rejectedCount = Object.values(userProducts).filter(p => p.status === PRODUCT_STATUS.REJECTED).length;
                
                modalBody.innerHTML = `
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <div>
                            <div style="text-align: center;">
                                <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #38bdf8, #0ea5e9); 
                                            border-radius: 50%; margin: 0 auto 10px; display: flex; align-items: center; 
                                            justify-content: center; color: white; font-size: 32px; font-weight: bold;">
                                    ${fullName.charAt(0).toUpperCase()}
                                </div>
                            </div>
                        </div>
                        <div>
                            <label class="form-label">Ø§Ù„Ø­Ø§Ù„Ø©</label>
                            <div style="display: flex; gap: 8px; margin-top: 5px;">
                                ${isVerified ? 
                                    '<span class="verified-badge" style="font-size:11px;">âœ“ Ù…ÙˆØ«Ù‘Ù‚</span>' : 
                                    '<button class="btn btn-xs btn-success" onclick="toggleVerification(\'' + userId + '\', true)">ØªÙˆØ«ÙŠÙ‚</button>'
                                }
                                ${isAdmin ? 
                                    '<span style="background: rgba(139, 92, 246, 0.2); color: #8b5cf6; padding: 3px 8px; border-radius: 10px; font-size: 11px;">Ù…Ø¯ÙŠØ±</span>' : 
                                    '<button class="btn btn-xs btn-success" onclick="toggleAdminStatus(\'' + userId + '\', true)">Ù…Ù†Ø­ Ø§Ù„Ù…Ø¯ÙŠØ±</button>'
                                }
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                            <input type="text" class="form-control" id="editFullName" value="${fullName}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                            <input type="text" class="form-control" id="editUsername" value="${username}">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                            <input type="email" class="form-control" id="editEmail" value="${email}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                            <input type="tel" class="form-control" id="editPhone" value="${phone}">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Ø§Ù„ÙˆØµÙ Ø§Ù„Ø´Ø®ØµÙŠ</label>
                        <textarea class="form-control" id="editBio" rows="2">${bio}</textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„</label>
                            <input type="text" class="form-control" value="${createdAt}" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø¢Ø®Ø± Ù†Ø´Ø§Ø·</label>
                            <input type="text" class="form-control" value="${lastActive}" readonly>
                        </div>
                    </div>
                    
                    <div style="background: #1f2937; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <label class="form-label">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</label>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 10px; margin-top: 10px;">
                            <div style="text-align: center;">
                                <div style="color: #38bdf8; font-weight: bold; font-size: 18px;">${productCount}</div>
                                <div style="font-size: 10px; color: #9ca3af;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="color: #f59e0b; font-weight: bold; font-size: 18px;">${pendingCount}</div>
                                <div style="font-size: 10px; color: #9ca3af;">Ù…Ø¹Ù„Ù‚Ø©</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="color: #10b981; font-weight: bold; font-size: 18px;">${approvedCount}</div>
                                <div style="font-size: 10px; color: #9ca3af;">Ù…Ø¹ØªÙ…Ø¯Ø©</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="color: #9333ea; font-weight: bold; font-size: 18px;">${editedCount}</div>
                                <div style="font-size: 10px; color: #9ca3af;">Ù…Ø¹Ø¯Ù„Ø©</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                            <input type="text" class="form-control" value="${userId}" readonly>
                        </div>
                    </div>
                `;
                
                // Ø¥Ø¹Ø¯Ø§Ø¯ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
                document.getElementById('deleteUserBtn').onclick = () => deleteUser(userId);
                document.getElementById('saveUserBtn').onclick = () => saveUserChanges(userId);
                
                // ÙØªØ­ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
                document.getElementById('userModal').style.display = 'flex';
                hideLoading();
            } catch (error) {
                console.error("âŒ Error loading user details:", error);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', 'error');
                hideLoading();
            }
        }
        
        async function saveUserChanges(userId) {
            const updates = {
                fullName: document.getElementById('editFullName').value.trim(),
                username: document.getElementById('editUsername').value.trim(),
                email: document.getElementById('editEmail').value.trim(),
                phone: document.getElementById('editPhone').value.trim(),
                bio: document.getElementById('editBio').value.trim(),
                lastUpdated: Date.now()
            };
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
            if (!updates.username || !updates.email) {
                showNotification('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø·Ù„ÙˆØ¨Ø§Ù†', 'error');
                return;
            }
            
            showLoading();
            
            try {
                await db.ref('users/' + userId).update(updates);
                showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­', 'success');
                closeUserModal();
                loadUsersManagement();
                hideLoading();
            } catch (error) {
                console.error('âŒ Error updating user:', error);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
                hideLoading();
            }
        }
        
        async function deleteUser(userId) {
            if (confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø¥Ø¹Ù„Ø§Ù†Ø§ØªÙ‡. Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡!')) {
                showLoading();
                
                try {
                    // Ø­Ø°Ù Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£ÙˆÙ„Ø§Ù‹
                    const productsSnapshot = await db.ref('products').orderByChild('uid').equalTo(userId).once('value');
                    const products = productsSnapshot.val() || {};
                    
                    if (products) {
                        // Ø­Ø°Ù ØµÙˆØ± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª
                        for (const [productId, product] of Object.entries(products)) {
                            if (product.images && product.images.length > 0) {
                                for (let imageUrl of product.images) {
                                    await deleteImageFromSupabase(imageUrl);
                                }
                            }
                            await db.ref('products/' + productId).remove();
                        }
                    }
                    
                    // Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                    await db.ref('users/' + userId).remove();
                    
                    showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ¨ÙŠØ§Ù†Ø§ØªÙ‡ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    closeUserModal();
                    loadUsersManagement();
                    hideLoading();
                } catch (error) {
                    console.error('âŒ Error deleting user:', error);
                    showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', 'error');
                    hideLoading();
                }
            }
        }
        
        async function viewProductDetails(productId) {
            showLoading();
            
            try {
                const productSnapshot = await db.ref('products/' + productId).once('value');
                const product = productSnapshot.val();
                
                if (!product) {
                    showNotification('Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
                    hideLoading();
                    return;
                }
                
                const seller = allUsers[product.uid] || {};
                const modalBody = document.getElementById('productModalBody');
                
                modalBody.innerHTML = `
                    <div class="form-group">
                        <label class="form-label">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</label>
                        <input type="text" class="form-control" id="editProductName" value="${product.name || ''}">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ø³Ø¹Ø± (Ø¯ÙŠÙ†Ø§Ø± Ø¹Ø±Ø§Ù‚ÙŠ)</label>
                            <input type="number" class="form-control" id="editProductPrice" value="${product.price || ''}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ù‚Ø³Ù…</label>
                            <select class="form-control" id="editProductCategory">
                                <option ${product.category === 'CPU' ? 'selected' : ''}>CPU</option>
                                <option ${product.category === 'GPU' ? 'selected' : ''}>GPU</option>
                                <option ${product.category === 'RAM' ? 'selected' : ''}>RAM</option>
                                <option ${product.category === 'Motherboard' ? 'selected' : ''}>Motherboard</option>
                                <option ${product.category === 'Storage' ? 'selected' : ''}>Storage</option>
                                <option ${product.category === 'Power Supply' ? 'selected' : ''}>Power Supply</option>
                                <option ${product.category === 'Case' ? 'selected' : ''}>Case</option>
                                <option ${product.category === 'Cooler' ? 'selected' : ''}>Cooler</option>
                                <option ${product.category === 'Accessories' ? 'selected' : ''}>Accessories</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ø¨Ø§Ø¦Ø¹</label>
                            <div class="form-control" style="background:#374151; color:#9ca3af;">
                                <span class="user-name-wrapper">
                                    ${seller.isVerified ? '<span class="verified-badge" style="font-size:9px;">âœ“</span>' : ''}
                                    ${seller.fullName || seller.username || product.seller || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}
                                </span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø§Ù„Ø¨Ø§Ø¦Ø¹</label>
                            <input type="tel" class="form-control" id="editProductPhone" value="${product.phone || ''}">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</label>
                            <input type="text" class="form-control" id="editProductProvince" value="${product.province || ''}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„ØªÙˆØµÙŠÙ„</label>
                            <select class="form-control" id="editProductDelivery">
                                <option value="Ù†Ø¹Ù…" ${product.delivery === 'Ù†Ø¹Ù…' ? 'selected' : ''}>Ù†Ø¹Ù…</option>
                                <option value="Ù„Ø§" ${product.delivery === 'Ù„Ø§' ? 'selected' : ''}>Ù„Ø§</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</label>
                            <select class="form-control" id="editProductStatus">
                                <option value="available" ${product.status2 === 'available' ? 'selected' : ''}>Ù…ØªØ§Ø­</option>
                                <option value="sold" ${product.status2 === 'sold' ? 'selected' : ''}>Ù…Ø¨Ø§Ø¹</option>
                                <option value="reserved" ${product.status2 === 'reserved' ? 'selected' : ''}>Ù…Ø­Ø¬ÙˆØ²</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ø´Ø±</label>
                            <input type="text" class="form-control" value="${product.timestamp ? formatDateTime(product.timestamp) : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}" readonly>
                        </div>
                    </div>
                    
                    ${product.approvedAt ? `
                        <div class="form-group">
                            <label class="form-label">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©</label>
                            <div style="background:#1f2937; padding:10px; border-radius:6px; font-size:12px;">
                                <div>ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© ÙÙŠ: ${formatDateTime(product.approvedAt)}</div>
                                <div>Ø¨ÙˆØ§Ø³Ø·Ø©: ${allUsers[product.approvedBy]?.fullName || allUsers[product.approvedBy]?.username || product.approvedBy || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
                            </div>
                        </div>
                    ` : ''}
                `;
                
                document.getElementById('deleteProductBtn').onclick = () => deleteSingleProduct(productId);
                document.getElementById('saveProductBtn').onclick = () => saveProductChanges(productId);
                
                document.getElementById('productModal').style.display = 'flex';
                hideLoading();
            } catch (error) {
                console.error("âŒ Error loading product details:", error);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†', 'error');
                hideLoading();
            }
        }
        
        async function saveProductChanges(productId) {
            const updates = {
                name: document.getElementById('editProductName').value.trim(),
                price: parseInt(document.getElementById('editProductPrice').value) || 0,
                category: document.getElementById('editProductCategory').value,
                phone: document.getElementById('editProductPhone').value.trim(),
                province: document.getElementById('editProductProvince').value.trim(),
                delivery: document.getElementById('editProductDelivery').value,
                status2: document.getElementById('editProductStatus').value,
                lastUpdated: firebase.database.ServerValue.TIMESTAMP
            };
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            if (!updates.name || updates.price <= 0) {
                showNotification('Ø§Ø³Ù… Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† ÙˆØ§Ù„Ø³Ø¹Ø± Ù…Ø·Ù„ÙˆØ¨Ø§Ù†', 'error');
                return;
            }
            
            showLoading();
            
            try {
                await db.ref('products/' + productId).update(updates);
                showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø¨Ù†Ø¬Ø§Ø­', 'success');
                closeProductModal();
                loadProductsManagement();
                hideLoading();
            } catch (error) {
                console.error('âŒ Error updating product:', error);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†', 'error');
                hideLoading();
            }
        }
    </script>
</body>
</html>
