<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø§Ù„Ù…Ø§Ù„Ùƒ | a3len</title>
    <style>
        @font-face {
            font-family: 'CustomFont';
            src: url('font.ttf') format('truetype');
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'CustomFont', sans-serif;
            background: #0f1115;
            color: #e5e7eb;
            min-height: 100vh;
            padding: 0;
        }
        
        /* Header */
        .admin-header {
            background: #0b0d12;
            padding: 15px 0;
            border-bottom: 1px solid #1f2937;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .back-btn {
            color: #38bdf8;
            text-decoration: none;
            font-size: 16px;
            padding: 8px 16px;
            border-radius: 6px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(56, 189, 248, 0.1);
        }
        
        .back-btn:hover {
            background: rgba(56, 189, 248, 0.2);
        }
        
        .admin-logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo-icon {
            font-size: 28px;
            color: #8b5cf6;
        }
        
        .logo-text {
            color: #38bdf8;
            font-size: 24px;
            font-weight: bold;
        }
        
        .owner-badge {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-right: 10px;
        }
        
        /* Search Bar */
        .admin-search {
            flex: 1;
            max-width: 400px;
            position: relative;
        }
        
        .search-input {
            width: 100%;
            padding: 12px 45px 12px 20px;
            background: #1f2937;
            border: 1px solid #374151;
            border-radius: 8px;
            color: #e5e7eb;
            font-family: inherit;
            font-size: 14px;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #38bdf8;
            box-shadow: 0 0 0 3px rgba(56, 189, 248, 0.1);
        }
        
        .search-btn {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #9ca3af;
            cursor: pointer;
            font-size: 16px;
        }
        
        /* Quick Actions */
        .quick-actions {
            display: flex;
            gap: 10px;
        }
        
        /* Main Container */
        .admin-container {
            max-width: 1400px;
            margin: 20px auto;
            padding: 0 20px;
        }
        
        /* Tabs Navigation */
        .admin-tabs {
            display: flex;
            background: #1c1f27;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #374151;
            overflow-x: auto;
            padding: 5px;
        }
        
        .tab {
            padding: 15px 25px;
            background: none;
            border: none;
            color: #9ca3af;
            font-family: inherit;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 10px;
            border-radius: 8px;
            transition: all 0.2s;
        }
        
        .tab:hover {
            background: rgba(56, 189, 248, 0.1);
            color: #e5e7eb;
        }
        
        .tab.active {
            background: #38bdf8;
            color: #000;
            font-weight: bold;
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: #1c1f27;
            border-radius: 12px;
            padding: 25px;
            border: 1px solid #374151;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            border-color: #38bdf8;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #38bdf8, #0ea5e9);
        }
        
        .stat-icon {
            font-size: 32px;
            margin-bottom: 15px;
        }
        
        .stat-number {
            color: #38bdf8;
            font-size: 36px;
            font-weight: bold;
            display: block;
            line-height: 1;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #9ca3af;
            font-size: 14px;
            display: block;
        }
        
        .stat-trend {
            font-size: 12px;
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .trend-up {
            color: #10b981;
        }
        
        .trend-down {
            color: #ef4444;
        }
        
        /* Main Content */
        .admin-content {
            background: #1c1f27;
            border-radius: 12px;
            padding: 0;
            border: 1px solid #374151;
            overflow: hidden;
        }
        
        .content-header {
            padding: 25px;
            border-bottom: 1px solid #374151;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .content-title {
            color: #38bdf8;
            font-size: 22px;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .content-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .filter-select {
            background: #1f2937;
            border: 1px solid #374151;
            border-radius: 6px;
            padding: 10px 15px;
            color: #e5e7eb;
            font-family: inherit;
            font-size: 14px;
            min-width: 150px;
        }
        
        /* Tables */
        .table-container {
            overflow-x: auto;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }
        
        .data-table th {
            background: #1f2937;
            padding: 18px 20px;
            text-align: right;
            color: #38bdf8;
            font-weight: 600;
            font-size: 14px;
            border-bottom: 2px solid #374151;
            position: sticky;
            top: 0;
        }
        
        .data-table td {
            padding: 16px 20px;
            border-bottom: 1px solid #374151;
            font-size: 14px;
        }
        
        .data-table tr:hover {
            background: rgba(56, 189, 248, 0.05);
        }
        
        .data-table tr.selected {
            background: rgba(56, 189, 248, 0.1);
        }
        
        /* User Status Badges */
        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            display: inline-block;
        }
        
        /* Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø£Ø²Ø±Ù‚ - Ø§Ù„ØªØ­Ø¯ÙŠØ« */
        .status-verified {
            background: rgba(56, 189, 248, 0.15);
            color: #38bdf8;
            border: 1px solid rgba(56, 189, 248, 0.3);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            margin-right: 5px;
            vertical-align: middle;
        }
        
        .verified-badge-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: rgba(56, 189, 248, 0.2);
            color: #38bdf8;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            font-size: 9px;
            border: 1px solid rgba(56, 189, 248, 0.3);
        }
        
        .name-with-verification {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            flex-wrap: wrap;
        }
        
        .status-active {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }
        
        .status-suspended {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }
        
        .status-pending {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
        }
        
        /* Action Buttons */
        .action-btns {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 8px 16px;
            border-radius: 6px;
            font-family: inherit;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            white-space: nowrap;
        }
        
        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }
        
        .btn-xs {
            padding: 4px 8px;
            font-size: 11px;
        }
        
        .btn-primary {
            background: #38bdf8;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0ea5e9;
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        
        .btn-danger:hover {
            background: #dc2626;
        }
        
        .btn-success {
            background: #10b981;
            color: white;
        }
        
        .btn-success:hover {
            background: #059669;
        }
        
        .btn-warning {
            background: #f59e0b;
            color: white;
        }
        
        .btn-warning:hover {
            background: #d97706;
        }
        
        .btn-violet {
            background: #8b5cf6;
            color: white;
        }
        
        .btn-violet:hover {
            background: #7c3aed;
        }
        
        .btn-outline {
            background: transparent;
            border: 1px solid #374151;
            color: #9ca3af;
        }
        
        .btn-outline:hover {
            background: #1f2937;
            color: #e5e7eb;
        }
        
        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
        }
        
        .modal-content {
            background: #1c1f27;
            border-radius: 12px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid #374151;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        
        .modal-header {
            padding: 25px;
            border-bottom: 1px solid #374151;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            color: #38bdf8;
            font-size: 20px;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: #9ca3af;
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
            line-height: 1;
        }
        
        .modal-close:hover {
            color: #ef4444;
        }
        
        .modal-body {
            padding: 25px;
        }
        
        .modal-footer {
            padding: 20px 25px;
            border-top: 1px solid #374151;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            color: #9ca3af;
            font-size: 14px;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            background: #1f2937;
            border: 1px solid #374151;
            border-radius: 8px;
            color: #e5e7eb;
            font-family: inherit;
            font-size: 14px;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #38bdf8;
            box-shadow: 0 0 0 3px rgba(56, 189, 248, 0.1);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        /* Charts */
        .chart-container {
            background: #1c1f27;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid #374151;
        }
        
        .chart-title {
            color: #38bdf8;
            font-size: 18px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Activity Log */
        .activity-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .activity-item {
            padding: 15px;
            border-bottom: 1px solid #374151;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .activity-item:last-child {
            border-bottom: none;
        }
        
        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #1f2937;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }
        
        .activity-content {
            flex: 1;
        }
        
        .activity-text {
            color: #e5e7eb;
            margin-bottom: 5px;
        }
        
        .activity-time {
            color: #9ca3af;
            font-size: 12px;
        }
        
        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            padding: 20px;
            border-top: 1px solid #374151;
        }
        
        .page-btn {
            padding: 8px 15px;
            background: #1f2937;
            border: 1px solid #374151;
            color: #e5e7eb;
            border-radius: 6px;
            cursor: pointer;
            font-family: inherit;
            font-size: 14px;
            min-width: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .page-btn:hover {
            background: #374151;
        }
        
        .page-btn.active {
            background: #38bdf8;
            color: #000;
            border-color: #38bdf8;
        }
        
        .page-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: #9ca3af;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(56, 189, 248, 0.2);
            border-top-color: #38bdf8;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 3000;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s ease;
            max-width: 400px;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .notification.success {
            background: #10b981;
            border-left: 4px solid #059669;
        }
        
        .notification.error {
            background: #ef4444;
            border-left: 4px solid #dc2626;
        }
        
        .notification.warning {
            background: #f59e0b;
            border-left: 4px solid #d97706;
        }
        
        .notification.info {
            background: #38bdf8;
            border-left: 4px solid #0ea5e9;
        }
        
        /* Responsive */
        @media (max-width: 1200px) {
            .header-content {
                flex-direction: column;
                align-items: stretch;
            }
            
            .admin-search {
                max-width: none;
            }
        }
        
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .content-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .content-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .filter-select {
                width: 100%;
            }
            
            .action-btns {
                justify-content: center;
            }
        }
        
        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .admin-tabs {
                flex-direction: column;
            }
            
            .tab {
                width: 100%;
                justify-content: center;
            }
            
            .quick-actions {
                flex-wrap: wrap;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Notifications -->
    <div id="notificationContainer"></div>
    
    <!-- Header -->
    <div class="admin-header">
        <div class="header-content">
            <div class="header-left">
                <a href="index.html" class="back-btn">
                    â† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                </a>
                <div class="admin-logo">
                    <div class="logo-icon">ğŸ‘‘</div>
                    <div class="logo-text">a3len</div>
                    <div class="owner-badge">Ø§Ù„Ù…Ø§Ù„Ùƒ</div>
                </div>
            </div>
            
            <div class="admin-search">
                <input type="text" class="search-input" id="globalSearch" 
                       placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†ØŒ Ø¥Ø¹Ù„Ø§Ù†Ø§ØªØŒ Ø£Ùˆ Ø£ÙŠ Ø´ÙŠØ¡..." 
                       onkeyup="handleGlobalSearch(event)">
                <button class="search-btn" onclick="performSearch()">ğŸ”</button>
            </div>
            
            <div class="quick-actions">
                <button class="btn btn-violet" onclick="refreshAllData()">
                    âŸ³ ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒÙ„
                </button>
                <button class="btn btn-success" onclick="exportData()">
                    ğŸ“¥ ØªØµØ¯ÙŠØ±
                </button>
                <button class="btn btn-danger" onclick="showSystemLogs()">
                    ğŸ“‹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª
                </button>
            </div>
        </div>
    </div>
    
    <!-- Main Container -->
    <div class="admin-container">
        <!-- Tabs -->
        <div class="admin-tabs">
            <button class="tab active" onclick="showTab('dashboard')">
                ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
            </button>
            <button class="tab" onclick="showTab('users')">
                ğŸ‘¥ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
            </button>
            <button class="tab" onclick="showTab('products')">
                ğŸ›’ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª
            </button>
            <button class="tab" onclick="showTab('analytics')">
                ğŸ“ˆ Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª
            </button>
            <button class="tab" onclick="showTab('reports')">
                âš ï¸ Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª
            </button>
            <button class="tab" onclick="showTab('settings')">
                âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            </button>
            <button class="tab" onclick="showTab('activity')">
                ğŸ“ Ø§Ù„Ù†Ø´Ø§Ø·
            </button>
        </div>
        
        <!-- Stats Grid -->
        <div class="stats-grid" id="statsGrid">
            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
        </div>
        
        <!-- Main Content -->
        <div class="admin-content" id="adminContent">
            <!-- Ù…Ø­ØªÙˆÙ‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
            <div class="loading" id="loadingContent">
                <div class="loading-spinner"></div>
                <div>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…...</div>
            </div>
        </div>
    </div>
    
    <!-- Modals -->
    <div class="modal-overlay" id="userModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ğŸ‘¤ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h3>
                <button class="modal-close" onclick="closeUserModal()">Ã—</button>
            </div>
            <div class="modal-body" id="userModalBody">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeUserModal()">Ø¥ØºÙ„Ø§Ù‚</button>
                <button class="btn btn-danger" id="deleteUserBtn">Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨</button>
                <button class="btn btn-primary" id="saveUserBtn">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="productModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ğŸ›’ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</h3>
                <button class="modal-close" onclick="closeProductModal()">Ã—</button>
            </div>
            <div class="modal-body" id="productModalBody">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeProductModal()">Ø¥ØºÙ„Ø§Ù‚</button>
                <button class="btn btn-danger" id="deleteProductBtn">Ø­Ø°Ù Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</button>
                <button class="btn btn-primary" id="saveProductBtn">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="systemLogsModal">
        <div class="modal-content" style="max-width: 1000px;">
            <div class="modal-header">
                <h3 class="modal-title">ğŸ“‹ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
                <button class="modal-close" onclick="closeSystemLogs()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="content-controls">
                    <select class="filter-select" id="logTypeFilter" onchange="filterLogs()">
                        <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</option>
                        <option value="user">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</option>
                        <option value="product">Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</option>
                        <option value="admin">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</option>
                        <option value="system">Ø§Ù„Ù†Ø¸Ø§Ù…</option>
                    </select>
                    <button class="btn btn-danger" onclick="clearAllLogs()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
                    <button class="btn btn-success" onclick="exportLogs()">ğŸ“¥ ØªØµØ¯ÙŠØ± Ø§Ù„Ø³Ø¬Ù„Ø§Øª</button>
                </div>
                <div class="activity-list" id="systemLogsList" style="height: 500px;">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    
    <script>
        // ØªÙƒÙˆÙŠÙ† Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAl3XunFOwHpGw-4_VYyETMtoLgk4mnRpQ",
            authDomain: "a3len-3ad54.firebasestorage.app",
            databaseURL: "https://a3len-3ad54-default-rtdb.firebaseio.com",
            projectId: "a3len-3ad54",
            storageBucket: "a3len-3ad54.firebasestorage.app",
            messagingSenderId: "767338034080",
            appId: "1:767338034080:web:801d77fb74c0aa56e92ac5"
        };
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙ‡ÙŠØ¦Ø©
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        
        const db = firebase.database();
        const auth = firebase.auth();
        
        // Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø©
        let currentUser = null;
        let isSuperAdmin = false;
        let allUsers = {};
        let allProducts = {};
        let currentTab = 'dashboard';
        
        // ========================================
        // Ø¯ÙˆØ§Ù„ Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
        // ========================================
        
        /**
         * Ø¹Ø±Ø¶ Ø´Ø§Ø±Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø²Ø±Ù‚Ø§Ø¡ Ø¨Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø§Ø³Ù…
         * @param {string} userId - Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
         * @returns {string} HTML Ù„Ø´Ø§Ø±Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚
         */
        function getVerifiedBadge(userId) {
            const user = allUsers[userId];
            if (user && user.isVerified) {
                return `
                    <span class="status-verified" title="Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ«Ù‘Ù‚">
                        <span class="verified-badge-icon">âœ“</span>
                        Ù…ÙˆØ«Ù‘Ù‚
                    </span>
                `;
            }
            return '';
        }
        
        /**
         * Ø¹Ø±Ø¶ Ø§Ù„Ø§Ø³Ù… Ù…Ø¹ Ø´Ø§Ø±Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚
         * @param {string} userId - Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
         * @param {string} customName - Ø§Ø³Ù… Ù…Ø®ØµØµ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
         * @returns {string} HTML Ù„Ù„Ø§Ø³Ù… Ù…Ø¹ Ø§Ù„ØªÙˆØ«ÙŠÙ‚
         */
        function displayNameWithVerification(userId, customName = '') {
            const user = allUsers[userId];
            const name = customName || user?.fullName || user?.username || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
            const verifiedBadge = getVerifiedBadge(userId);
            
            return `
                <div class="name-with-verification">
                    <span>${name}</span>
                    ${verifiedBadge}
                </div>
            `;
        }
        
        /**
         * Ø¯Ø§Ù„Ø© Ø³Ø±ÙŠØ¹Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙˆØ«ÙŠÙ‚ ÙÙŠ Ø£ÙŠ Ù…ÙƒØ§Ù†
         * @param {string} userId - Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
         * @returns {string} HTML Ù…ØµØºØ± Ù„Ù„ØªÙˆØ«ÙŠÙ‚
         */
        function getMiniVerifiedBadge(userId) {
            const user = allUsers[userId];
            if (user && user.isVerified) {
                return `
                    <span class="status-verified" style="font-size: 10px; padding: 1px 6px;" title="Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ«Ù‘Ù‚">
                        <span class="verified-badge-icon" style="width: 14px; height: 14px; font-size: 8px;">âœ“</span>
                        Ù…ÙˆØ«Ù‘Ù‚
                    </span>
                `;
            }
            return '';
        }
        
        // ========================================
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
        // ========================================
        
        document.addEventListener('DOMContentLoaded', function() {
            checkAdminPermissions();
            setupEventListeners();
        });
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù…Ø¯ÙŠØ±
        function checkAdminPermissions() {
            auth.onAuthStateChanged((user) => {
                if (user) {
                    currentUser = user;
                    
                    db.ref('users/' + user.uid).once('value', (snapshot) => {
                        const userData = snapshot.val();
                        
                        if (userData && userData.isAdmin) {
                            isSuperAdmin = true;
                            loadDashboard();
                        } else {
                            showNotification('Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©', 'error');
                            setTimeout(() => {
                                window.location.href = 'index.html';
                            }, 2000);
                        }
                    });
                } else {
                    showNotification('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'error');
                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 1500);
                }
            });
        }
        
        // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        function setupEventListeners() {
            // Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹Ø§Ù…
            document.getElementById('globalSearch').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    performSearch();
                }
            });
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
        function loadDashboard() {
            showLoading();
            
            Promise.all([
                db.ref('users').once('value'),
                db.ref('products').once('value'),
                db.ref('reports').once('value'),
                db.ref('systemLogs').limitToLast(20).once('value')
            ]).then(([usersSnap, productsSnap, reportsSnap, logsSnap]) => {
                allUsers = usersSnap.val() || {};
                allProducts = productsSnap.val() || {};
                
                const stats = calculateStatistics(usersSnap, productsSnap, reportsSnap);
                displayStats(stats);
                displayDashboardContent(usersSnap, productsSnap, logsSnap);
            }).catch(error => {
                console.error('Error loading dashboard:', error);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
            });
        }
        
        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        function calculateStatistics(usersSnap, productsSnap, reportsSnap) {
            const users = usersSnap.val() || {};
            const products = productsSnap.val() || {};
            const reports = reportsSnap.val() || {};
            
            const totalUsers = Object.keys(users).length;
            const totalProducts = Object.keys(products).length;
            const totalReports = Object.keys(reports).length;
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø¹Ø© ÙˆØ§Ù„Ù…Ø­Ø¬ÙˆØ²Ø©
            let soldProducts = 0;
            let reservedProducts = 0;
            let activeProducts = 0;
            
            Object.values(products).forEach(product => {
                if (product.status === 'sold') soldProducts++;
                else if (product.status === 'reserved') reservedProducts++;
                else if (product.status === 'available') activeProducts++;
            });
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ† Ø§Ù„ÙŠÙˆÙ…
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            let activeToday = 0;
            
            Object.values(users).forEach(user => {
                if (user.lastActive && new Date(user.lastActive) >= today) {
                    activeToday++;
                }
            });
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ÙˆØ«Ù‚ÙŠÙ†
            let verifiedUsers = 0;
            Object.values(users).forEach(user => {
                if (user.isVerified) verifiedUsers++;
            });
            
            return {
                totalUsers,
                totalProducts,
                totalReports,
                soldProducts,
                reservedProducts,
                activeProducts,
                activeToday,
                verifiedUsers
            };
        }
        
        // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        function displayStats(stats) {
            const statsGrid = document.getElementById('statsGrid');
            
            statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-icon">ğŸ‘¥</div>
                    <span class="stat-number">${stats.totalUsers}</span>
                    <span class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</span>
                    <div class="stat-trend trend-up">
                        <span>${stats.activeToday} Ù†Ø´Ø·ÙŠÙ† Ø§Ù„ÙŠÙˆÙ…</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">ğŸ›’</div>
                    <span class="stat-number">${stats.totalProducts}</span>
                    <span class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</span>
                    <div class="stat-trend">
                        <span>${stats.activeProducts} Ù…ØªØ§Ø­</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">ğŸ”µ</div>
                    <span class="stat-number">${stats.verifiedUsers}</span>
                    <span class="stat-label">Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…ÙˆØ«Ù‘ÙÙ‚ÙŠÙ†</span>
                    <div class="stat-trend trend-up">
                        <span>${Math.round((stats.verifiedUsers / stats.totalUsers) * 100) || 0}%</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">âš ï¸</div>
                    <span class="stat-number">${stats.totalReports}</span>
                    <span class="stat-label">Ø¨Ù„Ø§ØºØ§Øª Ù…Ø¹Ù„Ù‚Ø©</span>
                    <div class="stat-trend">
                        <span>Ø¨Ø­Ø§Ø¬Ø© Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</span>
                    </div>
                </div>
            `;
        }
        
        // Ø¹Ø±Ø¶ Ù…Ø­ØªÙˆÙ‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
        function displayDashboardContent(usersSnap, productsSnap, logsSnap) {
            const users = usersSnap.val() || {};
            const products = productsSnap.val() || {};
            const logs = logsSnap.val() || {};
            
            const recentUsers = Object.entries(users)
                .sort(([,a], [,b]) => (b.createdAt || 0) - (a.createdAt || 0))
                .slice(0, 5);
            
            const recentProducts = Object.entries(products)
                .sort(([,a], [,b]) => (b.timestamp || 0) - (a.timestamp || 0))
                .slice(0, 5);
            
            const recentLogs = Object.entries(logs)
                .sort(([,a], [,b]) => (b.timestamp || 0) - (a.timestamp || 0))
                .slice(0, 10);
            
            const content = document.getElementById('adminContent');
            
            content.innerHTML = `
                <div class="content-header">
                    <h3 class="content-title">ğŸ“Š Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
                    <div class="content-controls">
                        <button class="btn btn-primary" onclick="generateReport()">
                            ğŸ“„ ØªÙ‚Ø±ÙŠØ± Ø´Ù‡Ø±ÙŠ
                        </button>
                    </div>
                </div>
                
                <div class="content-body" style="padding: 25px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
                        <div>
                            <h4 style="color: #38bdf8; margin-bottom: 15px;">ğŸ‘¤ Ø¢Ø®Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†</h4>
                            <div class="table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Ø§Ù„Ø§Ø³Ù…</th>
                                            <th>Ø§Ù„Ø¨Ø±ÙŠØ¯</th>
                                            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${recentUsers.map(([userId, user]) => {
                                            const verifiedBadge = user.isVerified ? 
                                                '<span class="status-verified" style="margin-right: 5px;"><span class="verified-badge-icon">âœ“</span>Ù…ÙˆØ«Ù‘Ù‚</span>' : '';
                                            
                                            return `
                                                <tr>
                                                    <td>
                                                        <div style="display: flex; align-items: center; gap: 8px;">
                                                            ${user.fullName || user.username || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…'}
                                                            ${verifiedBadge}
                                                        </div>
                                                    </td>
                                                    <td>${user.email || 'Ø¨Ø¯ÙˆÙ† Ø¨Ø±ÙŠØ¯'}</td>
                                                    <td>${user.createdAt ? formatDate(user.createdAt) : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</td>
                                                    <td>
                                                        <button class="btn btn-xs btn-primary" onclick="viewUserDetails('${userId}')">
                                                            Ø¹Ø±Ø¶
                                                        </button>
                                                    </td>
                                                </tr>
                                            `;
                                        }).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div>
                            <h4 style="color: #38bdf8; margin-bottom: 15px;">ğŸ›’ Ø¢Ø®Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø¶Ø§ÙØ©</h4>
                            <div class="table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Ø§Ù„Ø§Ø³Ù…</th>
                                            <th>Ø§Ù„Ø³Ø¹Ø±</th>
                                            <th>Ø§Ù„Ø¨Ø§Ø¦Ø¹</th>
                                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${recentProducts.map(([productId, product]) => {
                                            const seller = users[product.uid];
                                            const verifiedBadge = seller?.isVerified ? 
                                                '<span class="status-verified" style="margin-right: 5px;"><span class="verified-badge-icon">âœ“</span>Ù…ÙˆØ«Ù‘Ù‚</span>' : '';
                                            
                                            return `
                                                <tr>
                                                    <td>${product.name || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…'}</td>
                                                    <td>${product.price ? parseInt(product.price).toLocaleString('ar-SA') + ' Ø¯.Ø¹' : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                                                    <td>
                                                        <div style="display: flex; align-items: center; gap: 5px;">
                                                            ${seller?.fullName || seller?.username || product.seller || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}
                                                            ${verifiedBadge}
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <button class="btn btn-xs btn-primary" onclick="viewProductDetails('${productId}')">
                                                            Ø¹Ø±Ø¶
                                                        </button>
                                                    </td>
                                                </tr>
                                            `;
                                        }).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <h4 style="color: #38bdf8; margin-bottom: 15px;">ğŸ“ Ø¢Ø®Ø± Ù†Ø´Ø§Ø·Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h4>
                    <div class="activity-list">
                        ${Object.entries(recentLogs).map(([logId, log]) => `
                            <div class="activity-item">
                                <div class="activity-icon">
                                    ${getLogIcon(log.type)}
                                </div>
                                <div class="activity-content">
                                    <div class="activity-text">${log.message || 'Ù†Ø´Ø§Ø· ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
                                    <div class="activity-time">
                                        ${log.timestamp ? formatDateTime(log.timestamp) : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}
                                        ${log.userId ? ` | Ø¨ÙˆØ§Ø³Ø·Ø©: ${getUserName(log.userId)}` : ''}
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            hideLoading();
        }
        
        // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
        function showTab(tabName) {
            currentTab = tabName;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`.tab[onclick*="${tabName}"]`).classList.add('active');
            
            // ØªØ­Ù…ÙŠÙ„ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¨ÙˆÙŠØ¨
            switch(tabName) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'users':
                    loadUsersManagement();
                    break;
                case 'products':
                    loadProductsManagement();
                    break;
                case 'analytics':
                    loadAnalytics();
                    break;
                case 'reports':
                    loadReports();
                    break;
                case 'settings':
                    loadSettings();
                    break;
                case 'activity':
                    loadActivityLogs();
                    break;
            }
        }
        
        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        function loadUsersManagement() {
            showLoading();
            
            db.ref('users').once('value').then(snapshot => {
                const users = snapshot.val() || {};
                allUsers = users;
                
                const content = document.getElementById('adminContent');
                
                content.innerHTML = `
                    <div class="content-header">
                        <h3 class="content-title">ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† (${Object.keys(users).length} Ù…Ø³ØªØ®Ø¯Ù…)</h3>
                        <div class="content-controls">
                            <select class="filter-select" id="userFilter" onchange="filterUsers()">
                                <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</option>
                                <option value="admin">Ø§Ù„Ù…Ø¯ÙŠØ±ÙŠÙ† ÙÙ‚Ø·</option>
                                <option value="verified">Ø§Ù„Ù…ÙˆØ«Ù‘Ù‚ÙŠÙ† ÙÙ‚Ø·</option>
                                <option value="unverified">ØºÙŠØ± Ø§Ù„Ù…ÙˆØ«Ù‘Ù‚ÙŠÙ†</option>
                                <option value="active">Ø§Ù„Ù†Ø´Ø·ÙŠÙ† Ø§Ù„ÙŠÙˆÙ…</option>
                                <option value="inactive">ØºÙŠØ± Ø§Ù„Ù†Ø´Ø·ÙŠÙ†</option>
                            </select>
                            <input type="text" class="form-control" id="userSearch" 
                                   placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯..." 
                                   style="width: 250px;" onkeyup="searchUsers()">
                            <button class="btn btn-success" onclick="addNewUser()">
                                + Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>
                                        <input type="checkbox" id="selectAllUsers" onclick="toggleSelectAllUsers()">
                                    </th>
                                    <th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                                    <th>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„</th>
                                    <th>Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</th>
                                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                    <th>Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</th>
                                    <th>Ø¢Ø®Ø± Ù†Ø´Ø§Ø·</th>
                                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody">
                                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="pagination" id="usersPagination">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
                    </div>
                `;
                
                displayUsersTable(users);
                hideLoading();
            });
        }
        
        // Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        function displayUsersTable(users, filteredUsers = null) {
            const tbody = document.getElementById('usersTableBody');
            const usersToDisplay = filteredUsers || Object.entries(users);
            
            tbody.innerHTML = usersToDisplay.map(([userId, user]) => {
                const username = user.username || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…';
                const fullName = user.fullName || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                const email = user.email || 'Ø¨Ø¯ÙˆÙ† Ø¨Ø±ÙŠØ¯';
                const phone = user.phone || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                const productCount = user.totalProducts || 0;
                const followers = user.followersCount || 0;
                const following = user.followingCount || 0;
                const isAdmin = user.isAdmin || false;
                const isVerified = user.isVerified || false;
                const lastActive = user.lastActive ? formatDateTime(user.lastActive) : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                const createdAt = user.createdAt ? formatDate(user.createdAt) : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                const bio = user.bio || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ';
                
                // Ø´Ø§Ø±Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚
                const verifiedBadge = isVerified ? 
                    '<span class="status-verified" style="margin-right: 5px;"><span class="verified-badge-icon">âœ“</span>Ù…ÙˆØ«Ù‘Ù‚</span>' : '';
                
                // Ø´Ø§Ø±Ø© Ø§Ù„Ù…Ø¯ÙŠØ±
                const adminBadge = isAdmin ? 
                    '<span class="status-badge" style="background: rgba(139, 92, 246, 0.2); color: #8b5cf6; margin-right: 5px;">Ù…Ø¯ÙŠØ±</span>' : '';
                
                return `
                    <tr data-user-id="${userId}">
                        <td>
                            <input type="checkbox" class="user-checkbox" value="${userId}">
                        </td>
                        <td>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="width: 40px; height: 40px; background: #38bdf8; border-radius: 50%; 
                                            display: flex; align-items: center; justify-content: center; 
                                            color: white; font-weight: bold;">
                                    ${(fullName || username).charAt(0).toUpperCase()}
                                </div>
                                <div>
                                    <div style="font-weight: 500; display: flex; align-items: center; gap: 5px;">
                                        ${fullName}
                                        ${verifiedBadge}
                                        ${adminBadge}
                                    </div>
                                    <div style="color: #9ca3af; font-size: 12px;">@${username}</div>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div style="font-size: 13px;">
                                <div><strong>Ø§Ù„Ø¨Ø±ÙŠØ¯:</strong> ${email}</div>
                                <div><strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${phone}</div>
                                <div><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„:</strong> ${createdAt}</div>
                            </div>
                        </td>
                        <td>
                            <div style="display: flex; gap: 15px;">
                                <div style="text-align: center;">
                                    <div style="color: #38bdf8; font-weight: bold;">${productCount}</div>
                                    <div style="font-size: 11px; color: #9ca3af;">Ø¥Ø¹Ù„Ø§Ù†</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="color: #10b981; font-weight: bold;">${followers}</div>
                                    <div style="font-size: 11px; color: #9ca3af;">Ù…ØªØ§Ø¨Ø¹</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="color: #8b5cf6; font-weight: bold;">${following}</div>
                                    <div style="font-size: 11px; color: #9ca3af;">ÙŠØªØ¨Ø¹</div>
                                </div>
                            </div>
                        </td>
                        <td>
                            ${isVerified ? 
                                '<span class="status-badge status-verified">âœ“ Ù…ÙˆØ«Ù‘Ù‚</span>' : 
                                '<span class="status-badge status-pending">ØºÙŠØ± Ù…ÙˆØ«Ù‘Ù‚</span>'
                            }
                            <div style="margin-top: 5px; font-size: 11px; color: #9ca3af;">
                                ${lastActive}
                            </div>
                        </td>
                        <td>
                            ${isAdmin ? 
                                '<span class="status-badge" style="background: rgba(139, 92, 246, 0.2); color: #8b5cf6;">Ù…Ø¯ÙŠØ±</span>' : 
                                '<span class="status-badge status-active">Ù…Ø³ØªØ®Ø¯Ù…</span>'
                            }
                        </td>
                        <td>
                            ${lastActive}
                        </td>
                        <td>
                            <div class="action-btns">
                                <button class="btn btn-xs btn-primary" onclick="viewUserDetails('${userId}')">
                                    Ø¹Ø±Ø¶
                                </button>
                                <button class="btn btn-xs btn-warning" onclick="editUser('${userId}')">
                                    ØªØ¹Ø¯ÙŠÙ„
                                </button>
                                ${isAdmin ? 
                                    '<button class="btn btn-xs btn-danger" onclick="toggleAdminStatus(\'' + userId + '\', false)">Ø³Ø­Ø¨ Ø§Ù„Ù…Ø¯ÙŠØ±</button>' :
                                    '<button class="btn btn-xs btn-success" onclick="toggleAdminStatus(\'' + userId + '\', true)">Ù…Ù†Ø­ Ø§Ù„Ù…Ø¯ÙŠØ±</button>'
                                }
                                ${isVerified ?
                                    '<button class="btn btn-xs btn-danger" onclick="toggleVerification(\'' + userId + '\', false)">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªÙˆØ«ÙŠÙ‚</button>' :
                                    '<button class="btn btn-xs btn-success" onclick="toggleVerification(\'' + userId + '\', true)">ØªÙˆØ«ÙŠÙ‚</button>'
                                }
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØµÙØ­
            setupPagination('users', usersToDisplay.length, 20);
        }
        
        // Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ù…ÙˆØ¯Ø§Ù„
        function viewUserDetails(userId) {
            db.ref('users/' + userId).once('value').then(snapshot => {
                const user = snapshot.val();
                if (!user) {
                    showNotification('Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
                    return;
                }
                
                const modalBody = document.getElementById('userModalBody');
                const fullName = user.fullName || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                const username = user.username || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…';
                const email = user.email || 'Ø¨Ø¯ÙˆÙ† Ø¨Ø±ÙŠØ¯';
                const phone = user.phone || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                const bio = user.bio || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ Ø´Ø®ØµÙŠ';
                const createdAt = user.createdAt ? formatDateTime(user.createdAt) : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                const lastActive = user.lastActive ? formatDateTime(user.lastActive) : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                const isAdmin = user.isAdmin || false;
                const isVerified = user.isVerified || false;
                
                // Ø´Ø§Ø±Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
                const verifiedDisplay = isVerified ? 
                    '<span class="status-verified" style="margin-right: 10px;"><span class="verified-badge-icon">âœ“</span>Ù…ÙˆØ«Ù‘Ù‚</span>' : 
                    '<span class="status-badge status-pending" style="margin-right: 10px;">ØºÙŠØ± Ù…ÙˆØ«Ù‘Ù‚</span>';
                
                // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                db.ref('products').orderByChild('uid').equalTo(userId).once('value').then(productsSnap => {
                    const userProducts = productsSnap.val() || {};
                    const productCount = Object.keys(userProducts).length;
                    
                    modalBody.innerHTML = `
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©</label>
                                <div style="text-align: center;">
                                    <div style="width: 100px; height: 100px; background: linear-gradient(135deg, #38bdf8, #0ea5e9); 
                                                border-radius: 50%; margin: 0 auto 15px; display: flex; align-items: center; 
                                                justify-content: center; color: white; font-size: 40px; font-weight: bold;">
                                        ${fullName.charAt(0).toUpperCase()}
                                    </div>
                                    <div style="display: flex; align-items: center; justify-content: center; gap: 10px; margin-top: 10px;">
                                        ${verifiedDisplay}
                                        ${isAdmin ? 
                                            '<span class="status-badge" style="background: rgba(139, 92, 246, 0.2); color: #8b5cf6;">Ù…Ø¯ÙŠØ±</span>' : 
                                            '<span class="status-badge status-active">Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ø§Ø¯ÙŠ</span>'
                                        }
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø­Ø§Ù„Ø©</label>
                                <div style="display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap;">
                                    ${isVerified ? 
                                        '<button class="btn btn-sm btn-danger" onclick="toggleVerification(\'' + userId + '\', false)">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªÙˆØ«ÙŠÙ‚</button>' : 
                                        '<button class="btn btn-sm btn-success" onclick="toggleVerification(\'' + userId + '\', true)">ØªÙˆØ«ÙŠÙ‚</button>'
                                    }
                                    ${isAdmin ? 
                                        '<button class="btn btn-sm btn-danger" onclick="toggleAdminStatus(\'' + userId + '\', false)">Ø³Ø­Ø¨ Ø§Ù„Ù…Ø¯ÙŠØ±</button>' : 
                                        '<button class="btn btn-sm btn-success" onclick="toggleAdminStatus(\'' + userId + '\', true)">Ù…Ù†Ø­ Ø§Ù„Ù…Ø¯ÙŠØ±</button>'
                                    }
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                                <input type="text" class="form-control" id="editFullName" value="${fullName}">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                                <input type="text" class="form-control" id="editUsername" value="${username}">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                                <input type="email" class="form-control" id="editEmail" value="${email}">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                                <input type="tel" class="form-control" id="editPhone" value="${phone}">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„ÙˆØµÙ Ø§Ù„Ø´Ø®ØµÙŠ</label>
                            <textarea class="form-control" id="editBio" rows="3">${bio}</textarea>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„</label>
                                <input type="text" class="form-control" value="${createdAt}" readonly>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø¢Ø®Ø± Ù†Ø´Ø§Ø·</label>
                                <input type="text" class="form-control" value="${lastActive}" readonly>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</label>
                                <input type="text" class="form-control" value="${productCount} Ø¥Ø¹Ù„Ø§Ù†" readonly>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                                <input type="text" class="form-control" value="${userId}" readonly>
                            </div>
                        </div>
                        
                        <h4 style="color: #38bdf8; margin: 25px 0 15px;">ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h4>
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 20px;">
                            <div style="background: #1f2937; padding: 15px; border-radius: 8px; text-align: center;">
                                <div style="color: #38bdf8; font-size: 24px; font-weight: bold;">${productCount}</div>
                                <div style="color: #9ca3af; font-size: 12px;">Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</div>
                            </div>
                            <div style="background: #1f2937; padding: 15px; border-radius: 8px; text-align: center;">
                                <div style="color: #10b981; font-size: 24px; font-weight: bold;">${user.followersCount || 0}</div>
                                <div style="color: #9ca3af; font-size: 12px;">Ù…ØªØ§Ø¨Ø¹ÙŠÙ†</div>
                            </div>
                            <div style="background: #1f2937; padding: 15px; border-radius: 8px; text-align: center;">
                                <div style="color: #8b5cf6; font-size: 24px; font-weight: bold;">${user.followingCount || 0}</div>
                                <div style="color: #9ca3af; font-size: 12px;">ÙŠØªØ¨Ø¹</div>
                            </div>
                            <div style="background: #1f2937; padding: 15px; border-radius: 8px; text-align: center;">
                                <div style="color: #f59e0b; font-size: 24px; font-weight: bold;">${user.totalReviews || 0}</div>
                                <div style="color: #9ca3af; font-size: 12px;">ØªÙ‚ÙŠÙŠÙ…Ø§Øª</div>
                            </div>
                        </div>
                    `;
                    
                    // Ø¥Ø¹Ø¯Ø§Ø¯ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
                    document.getElementById('deleteUserBtn').onclick = () => deleteUser(userId);
                    document.getElementById('saveUserBtn').onclick = () => saveUserChanges(userId);
                    
                    // ÙØªØ­ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
                    document.getElementById('userModal').style.display = 'flex';
                });
            });
        }
                // Ø­ÙØ¸ ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        function saveUserChanges(userId) {
            const updates = {
                fullName: document.getElementById('editFullName').value.trim(),
                username: document.getElementById('editUsername').value.trim(),
                email: document.getElementById('editEmail').value.trim(),
                phone: document.getElementById('editPhone').value.trim(),
                bio: document.getElementById('editBio').value.trim(),
                lastUpdated: Date.now()
            };
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
            if (!updates.username || !updates.email) {
                showNotification('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø·Ù„ÙˆØ¨Ø§Ù†', 'error');
                return;
            }
            
            db.ref('users/' + userId).update(updates).then(() => {
                logSystemActivity('user_updated', `ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ${updates.username}`);
                showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­', 'success');
                closeUserModal();
                loadUsersManagement();
            }).catch(error => {
                console.error('Error updating user:', error);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
            });
        }
        
        // Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        function deleteUser(userId) {
            if (confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø¥Ø¹Ù„Ø§Ù†Ø§ØªÙ‡ ÙˆØªÙ‚ÙŠÙŠÙ…Ø§ØªÙ‡ ÙˆÙ…ØªØ§Ø¨Ø¹Ø§ØªÙ‡. Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡!')) {
                showLoading();
                
                // Ø­Ø°Ù Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£ÙˆÙ„Ø§Ù‹
                db.ref('products').orderByChild('uid').equalTo(userId).once('value', (snapshot) => {
                    const products = snapshot.val();
                    const deletePromises = [];
                    
                    if (products) {
                        Object.keys(products).forEach(productId => {
                            deletePromises.push(db.ref('products/' + productId).remove());
                        });
                    }
                    
                    // Ø­Ø°Ù ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                    deletePromises.push(db.ref('reviews/' + userId).remove());
                    
                    // Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©
                    deletePromises.push(db.ref('followers/' + userId).remove());
                    deletePromises.push(db.ref('following/' + userId).remove());
                    
                    // Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                    deletePromises.push(db.ref('users/' + userId).remove());
                    
                    Promise.all(deletePromises).then(() => {
                        logSystemActivity('user_deleted', `ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ${userId}`);
                        showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ¨ÙŠØ§Ù†Ø§ØªÙ‡ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                        closeUserModal();
                        loadUsersManagement();
                        hideLoading();
                    }).catch(error => {
                        console.error('Error deleting user:', error);
                        showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', 'error');
                        hideLoading();
                    });
                });
            }
        }
        
        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª
        function loadProductsManagement() {
            showLoading();
            
            db.ref('products').once('value').then(snapshot => {
                allProducts = snapshot.val() || {};
                
                const content = document.getElementById('adminContent');
                
                content.innerHTML = `
                    <div class="content-header">
                        <h3 class="content-title">ğŸ›’ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª (${Object.keys(allProducts).length} Ø¥Ø¹Ù„Ø§Ù†)</h3>
                        <div class="content-controls">
                            <select class="filter-select" id="productFilter" onchange="filterProducts()">
                                <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</option>
                                <option value="available">Ø§Ù„Ù…ØªØ§Ø­Ø© ÙÙ‚Ø·</option>
                                <option value="sold">Ø§Ù„Ù…Ø¨Ø§Ø¹Ø©</option>
                                <option value="reserved">Ø§Ù„Ù…Ø­Ø¬ÙˆØ²Ø©</option>
                                <option value="today">Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„ÙŠÙˆÙ…</option>
                                <option value="verified">Ø¨Ø§Ø¦Ø¹ÙŠÙ† Ù…ÙˆØ«Ù‘Ù‚ÙŠÙ† ÙÙ‚Ø·</option>
                            </select>
                            <input type="text" class="form-control" id="productSearch" 
                                   placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ù‚Ø·Ø¹Ø© Ø£Ùˆ Ø§Ù„Ø¨Ø§Ø¦Ø¹..." 
                                   style="width: 250px;" onkeyup="searchProducts()">
                            <button class="btn btn-danger" onclick="deleteSelectedProducts()">
                                ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø¯Ø¯
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th><input type="checkbox" id="selectAllProducts" onclick="toggleSelectAllProducts()"></th>
                                    <th>Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</th>
                                    <th>Ø§Ù„Ø³Ø¹Ø±</th>
                                    <th>Ø§Ù„Ø¨Ø§Ø¦Ø¹</th>
                                    <th>Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</th>
                                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody id="productsTableBody">
                                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="pagination" id="productsPagination">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
                    </div>
                `;
                
                displayProductsTable(allProducts);
                hideLoading();
            });
        }
        
        // Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª
        function displayProductsTable(products, filteredProducts = null) {
            const tbody = document.getElementById('productsTableBody');
            const productsToDisplay = filteredProducts || Object.entries(products);
            
            tbody.innerHTML = productsToDisplay.map(([productId, product]) => {
                const price = product.price ? parseInt(product.price).toLocaleString('ar-SA') + ' Ø¯.Ø¹' : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                const seller = allUsers[product.uid];
                const sellerName = seller ? 
                    (seller.fullName || seller.username) : 
                    product.seller || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                const date = product.timestamp ? formatDate(product.timestamp) : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                
                // Ø´Ø§Ø±Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ù„Ù„Ø¨Ø§Ø¦Ø¹
                const verifiedBadge = seller?.isVerified ? 
                    '<span class="status-verified" style="margin-right: 5px;"><span class="verified-badge-icon">âœ“</span>Ù…ÙˆØ«Ù‘Ù‚</span>' : '';
                
                return `
                    <tr data-product-id="${productId}">
                        <td>
                            <input type="checkbox" class="product-checkbox" value="${productId}">
                        </td>
                        <td>
                            <div style="font-weight: 500;">${product.name || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…'}</div>
                            <div style="color: #9ca3af; font-size: 12px;">${product.category || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                        </td>
                        <td style="font-weight: bold; color: #38bdf8;">
                            ${price}
                        </td>
                        <td>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <div style="width: 30px; height: 30px; background: #10b981; border-radius: 50%; 
                                            display: flex; align-items: center; justify-content: center; 
                                            color: white; font-size: 12px; font-weight: bold;">
                                    ${sellerName.charAt(0).toUpperCase()}
                                </div>
                                <div>
                                    <div style="font-size: 13px; display: flex; align-items: center; gap: 3px;">
                                        ${sellerName}
                                        ${verifiedBadge}
                                    </div>
                                    <div style="font-size: 11px; color: #9ca3af;">${product.phone || 'Ø¨Ø¯ÙˆÙ† Ø±Ù‚Ù…'}</div>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div style="font-size: 12px;">
                                <div><strong>Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©:</strong> ${product.province || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                                <div><strong>Ø§Ù„ØªÙˆØµÙŠÙ„:</strong> ${product.delivery || 'Ù„Ø§'}</div>
                                <div><strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${product.phone || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
                            </div>
                        </td>
                        <td>
                            <span class="status-badge status-${product.status || 'available'}">
                                ${getStatusText(product.status || 'available')}
                            </span>
                            <div style="margin-top: 5px;">
                                <select class="form-control" style="padding: 3px 8px; font-size: 12px; width: 100px;" 
                                        onchange="updateProductStatus('${productId}', this.value)">
                                    <option value="available" ${product.status === 'available' ? 'selected' : ''}>Ù…ØªØ§Ø­</option>
                                    <option value="sold" ${product.status === 'sold' ? 'selected' : ''}>Ù…Ø¨Ø§Ø¹</option>
                                    <option value="reserved" ${product.status === 'reserved' ? 'selected' : ''}>Ù…Ø­Ø¬ÙˆØ²</option>
                                </select>
                            </div>
                        </td>
                        <td>
                            ${date}
                            <div style="font-size: 11px; color: #9ca3af;">
                                ${product.timestamp ? formatTimeAgo(product.timestamp) : ''}
                            </div>
                        </td>
                        <td>
                            <div class="action-btns">
                                <button class="btn btn-xs btn-primary" onclick="viewProductDetails('${productId}')">
                                    Ø¹Ø±Ø¶
                                </button>
                                <button class="btn btn-xs btn-warning" onclick="editProductAdmin('${productId}')">
                                    ØªØ¹Ø¯ÙŠÙ„
                                </button>
                                <button class="btn btn-xs btn-danger" onclick="deleteSingleProduct('${productId}')">
                                    Ø­Ø°Ù
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
            
            setupPagination('products', productsToDisplay.length, 15);
        }
        
        // Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† ÙÙŠ Ù…ÙˆØ¯Ø§Ù„
        function viewProductDetails(productId) {
            db.ref('products/' + productId).once('value').then(snapshot => {
                const product = snapshot.val();
                if (!product) {
                    showNotification('Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
                    return;
                }
                
                const seller = allUsers[product.uid] || {};
                const modalBody = document.getElementById('productModalBody');
                
                // Ø´Ø§Ø±Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ù„Ù„Ø¨Ø§Ø¦Ø¹
                const sellerVerifiedBadge = seller.isVerified ? 
                    '<span class="status-verified" style="margin-right: 8px;"><span class="verified-badge-icon">âœ“</span>Ù…ÙˆØ«Ù‘Ù‚</span>' : '';
                
                modalBody.innerHTML = `
                    <div class="form-group">
                        <label class="form-label">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</label>
                        <input type="text" class="form-control" id="editProductName" value="${product.name || ''}">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ø³Ø¹Ø± (Ø¯ÙŠÙ†Ø§Ø± Ø¹Ø±Ø§Ù‚ÙŠ)</label>
                            <input type="number" class="form-control" id="editProductPrice" value="${product.price || ''}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ù‚Ø³Ù…</label>
                            <select class="form-control" id="editProductCategory">
                                <option ${product.category === 'CPU' ? 'selected' : ''}>CPU</option>
                                <option ${product.category === 'GPU' ? 'selected' : ''}>GPU</option>
                                <option ${product.category === 'RAM' ? 'selected' : ''}>RAM</option>
                                <option ${product.category === 'Motherboard' ? 'selected' : ''}>Motherboard</option>
                                <option ${product.category === 'Storage' ? 'selected' : ''}>Storage</option>
                                <option ${product.category === 'Power Supply' ? 'selected' : ''}>Power Supply</option>
                                <option ${product.category === 'Case' ? 'selected' : ''}>Case</option>
                                <option ${product.category === 'Cooler' ? 'selected' : ''}>Cooler</option>
                                <option ${product.category === 'Accessories' ? 'selected' : ''}>Accessories</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ø¨Ø§Ø¦Ø¹</label>
                            <div style="display: flex; align-items: center; gap: 8px; margin-top: 5px;">
                                <span>${seller.fullName || seller.username || product.seller || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</span>
                                ${sellerVerifiedBadge}
                                <button class="btn btn-xs btn-primary" onclick="viewUserDetails('${product.uid}')" style="margin-right: auto;">
                                    Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ù
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø§Ù„Ø¨Ø§Ø¦Ø¹</label>
                            <input type="tel" class="form-control" id="editProductPhone" value="${product.phone || ''}">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</label>
                            <input type="text" class="form-control" id="editProductProvince" value="${product.province || ''}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„ØªÙˆØµÙŠÙ„</label>
                            <select class="form-control" id="editProductDelivery">
                                <option value="Ù†Ø¹Ù…" ${product.delivery === 'Ù†Ø¹Ù…' ? 'selected' : ''}>Ù†Ø¹Ù…</option>
                                <option value="Ù„Ø§" ${product.delivery === 'Ù„Ø§' ? 'selected' : ''}>Ù„Ø§</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</label>
                            <select class="form-control" id="editProductStatus">
                                <option value="available" ${product.status === 'available' ? 'selected' : ''}>Ù…ØªØ§Ø­</option>
                                <option value="sold" ${product.status === 'sold' ? 'selected' : ''}>Ù…Ø¨Ø§Ø¹</option>
                                <option value="reserved" ${product.status === 'reserved' ? 'selected' : ''}>Ù…Ø­Ø¬ÙˆØ²</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ù…Ø¹Ø±Ù Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</label>
                            <input type="text" class="form-control" value="${productId}" readonly>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ø´Ø±</label>
                            <input type="text" class="form-control" value="${product.timestamp ? formatDateTime(product.timestamp) : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«</label>
                            <input type="text" class="form-control" value="${product.lastUpdated ? formatDateTime(product.lastUpdated) : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}" readonly>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</label>
                        <div style="background: #1f2937; padding: 15px; border-radius: 8px; margin-top: 5px;">
                            <div style="font-size: 13px;">
                                <div><strong>Ù…Ø¹Ø±Ù Ø§Ù„Ø¨Ø§Ø¦Ø¹:</strong> ${product.uid || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
                                <div><strong>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù„Ù„Ø¨Ø§Ø¦Ø¹:</strong> ${seller.email || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
                                <div><strong>Ø¹Ø¯Ø¯ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ø¨Ø§Ø¦Ø¹:</strong> ${seller.totalProducts || 0}</div>
                                <div><strong>Ø­Ø§Ù„Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚:</strong> ${seller.isVerified ? 'âœ… Ù…ÙˆØ«Ù‘Ù‚' : 'âŒ ØºÙŠØ± Ù…ÙˆØ«Ù‘Ù‚'}</div>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('deleteProductBtn').onclick = () => deleteSingleProduct(productId);
                document.getElementById('saveProductBtn').onclick = () => saveProductChanges(productId);
                
                document.getElementById('productModal').style.display = 'flex';
            });
        }
        
        // Ø­ÙØ¸ ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†
        function saveProductChanges(productId) {
            const updates = {
                name: document.getElementById('editProductName').value.trim(),
                price: parseInt(document.getElementById('editProductPrice').value) || 0,
                category: document.getElementById('editProductCategory').value,
                phone: document.getElementById('editProductPhone').value.trim(),
                province: document.getElementById('editProductProvince').value.trim(),
                delivery: document.getElementById('editProductDelivery').value,
                status: document.getElementById('editProductStatus').value,
                lastUpdated: Date.now()
            };
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            if (!updates.name || updates.price <= 0) {
                showNotification('Ø§Ø³Ù… Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† ÙˆØ§Ù„Ø³Ø¹Ø± Ù…Ø·Ù„ÙˆØ¨Ø§Ù†', 'error');
                return;
            }
            
            db.ref('products/' + productId).update(updates).then(() => {
                logSystemActivity('product_updated', `ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¥Ø¹Ù„Ø§Ù†: ${updates.name}`);
                showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø¨Ù†Ø¬Ø§Ø­', 'success');
                closeProductModal();
                loadProductsManagement();
            }).catch(error => {
                console.error('Error updating product:', error);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†', 'error');
            });
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª
        function loadAnalytics() {
            showLoading();
            
            Promise.all([
                db.ref('users').once('value'),
                db.ref('products').once('value'),
                db.ref('reviews').once('value')
            ]).then(([usersSnap, productsSnap, reviewsSnap]) => {
                const content = document.getElementById('adminContent');
                
                const usersByMonth = groupDataByMonth(usersSnap.val(), 'createdAt');
                const productsByMonth = groupDataByMonth(productsSnap.val(), 'timestamp');
                const reviewsByMonth = groupDataByMonth(reviewsSnap.val(), 'timestamp');
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ÙˆØ«Ù‚ÙŠÙ†
                const totalUsers = Object.keys(usersSnap.val() || {}).length;
                const verifiedUsers = Object.values(usersSnap.val() || {}).filter(user => user.isVerified).length;
                const verificationRate = totalUsers > 0 ? Math.round((verifiedUsers / totalUsers) * 100) : 0;
                
                content.innerHTML = `
                    <div class="content-header">
                        <h3 class="content-title">ğŸ“ˆ Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</h3>
                        <div class="content-controls">
                            <select class="filter-select" id="analyticsPeriod" onchange="updateAnalytics()">
                                <option value="monthly">Ø´Ù‡Ø±ÙŠ</option>
                                <option value="weekly">Ø£Ø³Ø¨ÙˆØ¹ÙŠ</option>
                                <option value="yearly">Ø³Ù†ÙˆÙŠ</option>
                            </select>
                            <button class="btn btn-success" onclick="exportAnalytics()">
                                ğŸ“Š ØªØµØ¯ÙŠØ± Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª
                            </button>
                        </div>
                    </div>
                    
                    <div class="content-body" style="padding: 25px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
                            <div>
                                <h4 style="color: #38bdf8; margin-bottom: 15px;">ğŸ“ˆ Ù†Ù…Ùˆ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h4>
                                <div id="usersChart" style="background: #1f2937; padding: 20px; border-radius: 8px; height: 300px;">
                                    <div style="display: flex; justify-content: center; align-items: center; height: 100%; color: #9ca3af;">
                                        Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ Ù‡Ù†Ø§
                                    </div>
                                </div>
                            </div>
                            <div>
                                <h4 style="color: #38bdf8; margin-bottom: 15px;">ğŸ“Š Ù†Ø´Ø§Ø· Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</h4>
                                <div id="productsChart" style="background: #1f2937; padding: 20px; border-radius: 8px; height: 300px;">
                                    <div style="display: flex; justify-content: center; align-items: center; height: 100%; color: #9ca3af;">
                                        Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ Ù‡Ù†Ø§
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <h4 style="color: #38bdf8; margin-bottom: 15px;">ğŸ“‹ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ØªÙØµÙŠÙ„ÙŠØ©</h4>
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 30px;">
                            <div style="background: #1f2937; padding: 20px; border-radius: 8px; text-align: center;">
                                <div style="color: #38bdf8; font-size: 28px; font-weight: bold;">${totalUsers}</div>
                                <div style="color: #9ca3af; font-size: 14px;">Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„</div>
                            </div>
                            <div style="background: #1f2937; padding: 20px; border-radius: 8px; text-align: center;">
                                <div style="color: #10b981; font-size: 28px; font-weight: bold;">${Object.keys(productsSnap.val() || {}).length}</div>
                                <div style="color: #9ca3af; font-size: 14px;">Ø¥Ø¹Ù„Ø§Ù† Ù†Ø´Ø·</div>
                            </div>
                            <div style="background: #1f2937; padding: 20px; border-radius: 8px; text-align: center;">
                                <div style="color: #38bdf8; font-size: 28px; font-weight: bold;">${verifiedUsers}</div>
                                <div style="color: #9ca3af; font-size: 14px;">Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ«Ù‘Ù‚</div>
                                <div style="color: #38bdf8; font-size: 12px; margin-top: 5px;">${verificationRate}%</div>
                            </div>
                            <div style="background: #1f2937; padding: 20px; border-radius: 8px; text-align: center;">
                                <div style="color: #f59e0b; font-size: 28px; font-weight: bold;">
                                    ${calculateAverageRating(reviewsSnap.val())}/5
                                </div>
                                <div style="color: #9ca3af; font-size: 14px;">Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</div>
                            </div>
                        </div>
                        
                        <h4 style="color: #38bdf8; margin-bottom: 15px;">ğŸ† Ø£ÙØ¶Ù„ Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ† (Ù…ÙˆØ«Ù‘Ù‚ÙŠÙ†)</h4>
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Ø§Ù„Ø¨Ø§Ø¦Ø¹</th>
                                        <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</th>
                                        <th>Ø§Ù„Ù…Ø¨Ø§Ø¹Ø©</th>
                                        <th>Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</th>
                                        <th>Ø­Ø§Ù„Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚</th>
                                        <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                    </tr>
                                </thead>
                                <tbody id="topSellersBody">
                                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
                
                displayTopSellers(usersSnap.val(), productsSnap.val(), reviewsSnap.val());
                hideLoading();
            });
        }
        
        // Ø¹Ø±Ø¶ Ø£ÙØ¶Ù„ Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ†
        function displayTopSellers(users, products, reviews) {
            const tbody = document.getElementById('topSellersBody');
            
            if (!users) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align:center; padding:20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>';
                return;
            }
            
            const sellerStats = {};
            
            // Ø­Ø³Ø§Ø¨ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙƒÙ„ Ø¨Ø§Ø¦Ø¹
            Object.values(products || {}).forEach(product => {
                if (product.uid) {
                    if (!sellerStats[product.uid]) {
                        sellerStats[product.uid] = {
                            totalProducts: 0,
                            soldProducts: 0,
                            totalPrice: 0
                        };
                    }
                    
                    sellerStats[product.uid].totalProducts++;
                    if (product.status === 'sold') {
                        sellerStats[product.uid].soldProducts++;
                        sellerStats[product.uid].totalPrice += parseInt(product.price) || 0;
                    }
                }
            });
            
            // ØªØ­Ø¶ÙŠØ± Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ† Ù…Ø¹ Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ«Ù‚ÙŠÙ†
            const topSellers = Object.entries(sellerStats)
                .map(([userId, stats]) => {
                    const user = users[userId];
                    return {
                        userId,
                        username: user?.username || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ',
                        fullName: user?.fullName || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ',
                        isVerified: user?.isVerified || false,
                        ...stats
                    };
                })
                .sort((a, b) => {
                    // Ø¥Ø¹Ø·Ø§Ø¡ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ù„Ù„Ù…ÙˆØ«Ù‚ÙŠÙ†
                    if (a.isVerified && !b.isVerified) return -1;
                    if (!a.isVerified && b.isVerified) return 1;
                    // Ø«Ù… Ø§Ù„ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
                    return b.soldProducts - a.soldProducts;
                })
                .slice(0, 10);
            
            tbody.innerHTML = topSellers.map(seller => {
                const verifiedBadge = seller.isVerified ? 
                    '<span class="status-verified" style="margin-right: 5px;"><span class="verified-badge-icon">âœ“</span>Ù…ÙˆØ«Ù‘Ù‚</span>' : 
                    '<span class="status-badge status-pending" style="margin-right: 5px;">ØºÙŠØ± Ù…ÙˆØ«Ù‘Ù‚</span>';
                
                return `
                    <tr>
                        <td>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="width: 40px; height: 40px; background: ${seller.isVerified ? '#38bdf8' : '#6b7280'}; border-radius: 50%; 
                                            display: flex; align-items: center; justify-content: center; 
                                            color: white; font-weight: bold;">
                                    ${seller.fullName.charAt(0).toUpperCase()}
                                </div>
                                <div>
                                    <div style="font-weight: 500; display: flex; align-items: center; gap: 5px;">
                                        ${seller.fullName}
                                        ${verifiedBadge}
                                    </div>
                                    <div style="color: #9ca3af; font-size: 12px;">@${seller.username}</div>
                                </div>
                            </div>
                        </td>
                        <td>${seller.totalProducts}</td>
                        <td>${seller.soldProducts}</td>
                        <td>${calculateUserRating(seller.userId, reviews)}</td>
                        <td>
                            ${seller.isVerified ? 
                                '<span style="color: #38bdf8; font-weight: bold;">âœ… Ù…ÙˆØ«Ù‘Ù‚</span>' : 
                                '<span style="color: #9ca3af;">âŒ ØºÙŠØ± Ù…ÙˆØ«Ù‘Ù‚</span>'
                            }
                        </td>
                        <td>
                            <div class="action-btns">
                                <button class="btn btn-xs btn-primary" onclick="viewUserDetails('${seller.userId}')">
                                    Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ù
                                </button>
                                ${!seller.isVerified ? 
                                    `<button class="btn btn-xs btn-success" onclick="toggleVerification('${seller.userId}', true)">
                                        ØªÙˆØ«ÙŠÙ‚
                                    </button>` : 
                                    ''
                                }
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª
        function loadReports() {
            showLoading();
            
            db.ref('reports').once('value').then(snapshot => {
                const reports = snapshot.val() || {};
                
                const content = document.getElementById('adminContent');
                
                content.innerHTML = `
                    <div class="content-header">
                        <h3 class="content-title">âš ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª (${Object.keys(reports).length} Ø¨Ù„Ø§Øº)</h3>
                        <div class="content-controls">
                            <select class="filter-select" id="reportFilter" onchange="filterReports()">
                                <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª</option>
                                <option value="pending">Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©</option>
                                <option value="resolved">Ø§Ù„Ù…Ø­Ù„ÙˆÙ„Ø©</option>
                                <option value="spam">Ø§Ù„Ù…Ø²Ø¹Ø¬Ø©</option>
                                <option value="verified">Ø¹Ù„Ù‰ Ù…ÙˆØ«Ù‘Ù‚ÙŠÙ†</option>
                            </select>
                            <button class="btn btn-success" onclick="resolveAllReports()">
                                âœ… Ø­Ù„ Ø§Ù„ÙƒÙ„
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Ù†ÙˆØ¹ Ø§Ù„Ø¨Ù„Ø§Øº</th>
                                    <th>Ø§Ù„ØªÙØ§ØµÙŠÙ„</th>
                                    <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                    <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø¹Ù†Ù‡</th>
                                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody id="reportsTableBody">
                                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
                            </tbody>
                        </table>
                    </div>
                `;
                
                displayReportsTable(reports);
                hideLoading();
            });
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
        function loadSettings() {
            const content = document.getElementById('adminContent');
            
            content.innerHTML = `
                <div class="content-header">
                    <h3 class="content-title">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
                </div>
                
                <div class="content-body" style="padding: 25px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                        <div>
                            <h4 style="color: #38bdf8; margin-bottom: 20px;">ğŸ”’ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙˆØ«ÙŠÙ‚</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„ØªÙˆØ«ÙŠÙ‚</label>
                                <div style="display: flex; gap: 10px; margin-top: 5px; flex-wrap: wrap;">
                                    <button class="btn btn-sm ${isRequirementActive('verified_phone') ? 'btn-primary' : 'btn-outline'}" 
                                            onclick="toggleVerificationRequirement('verified_phone')">
                                        ğŸ“± Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ù…ÙˆØ«Ù‘Ù‚
                                    </button>
                                    <button class="btn btn-sm ${isRequirementActive('min_products') ? 'btn-primary' : 'btn-outline'}" 
                                            onclick="toggleVerificationRequirement('min_products')">
                                        ğŸ›’ 5 Ø¥Ø¹Ù„Ø§Ù†Ø§Øª ÙƒØ­Ø¯ Ø£Ø¯Ù†Ù‰
                                    </button>
                                    <button class="btn btn-sm ${isRequirementActive('min_rating') ? 'btn-primary' : 'btn-outline'}" 
                                            onclick="toggleVerificationRequirement('min_rating')">
                                        â­ ØªÙ‚ÙŠÙŠÙ… 4+
                                    </button>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">ØªÙˆØ«ÙŠÙ‚ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</label>
                                <div style="display: flex; gap: 10px; margin-top: 5px;">
                                    <button class="btn btn-success" onclick="toggleAutoVerification(true)">ØªÙØ¹ÙŠÙ„</button>
                                    <button class="btn btn-danger" onclick="toggleAutoVerification(false)">ØªØ¹Ø·ÙŠÙ„</button>
                                </div>
                                <div style="color: #9ca3af; font-size: 12px; margin-top: 5px;">
                                    Ø³ÙŠØªÙ… ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø§Ø³ØªÙŠÙØ§Ø¡ Ø§Ù„Ø´Ø±ÙˆØ·
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Ù…Ø²Ø§ÙŠØ§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ÙˆØ«Ù‚ÙŠÙ†</label>
                                <div style="display: flex; gap: 10px; margin-top: 5px; flex-wrap: wrap;">
                                    <span class="status-verified" style="margin: 2px;">Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù…Ù…ÙŠØ²Ø©</span>
                                    <span class="status-verified" style="margin: 2px;">Ø´Ø¹Ø§Ø± Ø§Ù„ØªÙˆØ«ÙŠÙ‚</span>
                                    <span class="status-verified" style="margin: 2px;">Ù…ØµØ¯Ø§Ù‚ÙŠØ© Ø£Ø¹Ù„Ù‰</span>
                                    <span class="status-verified" style="margin: 2px;">Ø£ÙˆÙ„ÙˆÙŠØ© ÙÙŠ Ø§Ù„Ø¨Ø­Ø«</span>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <h4 style="color: #38bdf8; margin-bottom: 20px;">ğŸ› ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h4>
                            
                            <div class="form-group">
                                <label class="form-label">ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø¨ÙŠÙ† Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª (Ø³Ø§Ø¹Ø§Øª)</label>
                                <input type="number" class="form-control" id="publishCooldown" value="1" min="1" max="24">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</label>
                                <input type="number" class="form-control" id="dailyLimit" value="10" min="1" max="100">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ</label>
                                <div style="display: flex; gap: 10px; margin-top: 5px;">
                                    <button class="btn btn-success" onclick="toggleMaintenance(true)">ØªÙØ¹ÙŠÙ„</button>
                                    <button class="btn btn-danger" onclick="toggleMaintenance(false)">ØªØ¹Ø·ÙŠÙ„</button>
                                </div>
                            </div>
                            
                            <button class="btn btn-primary" onclick="saveSystemSettings()" style="width: 100%; margin-top: 20px;">
                                ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                            </button>
                        </div>
                    </div>
                    
                    <h4 style="color: #38bdf8; margin: 30px 0 15px;">ğŸ”µ Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªÙˆØ«ÙŠÙ‚</h4>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                        <button class="btn btn-primary" onclick="verifyAllEligibleUsers()">
                            ğŸ”„ ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ù…Ø¤Ù‡Ù„ÙŠÙ† ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
                        </button>
                        <button class="btn btn-warning" onclick="showVerificationStats()">
                            ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªÙˆØ«ÙŠÙ‚
                        </button>
                        <button class="btn btn-danger" onclick="removeAllVerifications()">
                            ğŸ—‘ï¸ Ø¥Ù„ØºØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙˆØ«ÙŠÙ‚Ø§Øª
                        </button>
                    </div>
                    
                    <h4 style="color: #38bdf8; margin: 30px 0 15px;">ğŸ“Š Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h4>
                    <div style="background: #1f2937; padding: 20px; border-radius: 8px;">
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; font-size: 14px;">
                            <div>
                                <div style="color: #9ca3af;">Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù…</div>
                                <div style="color: #38bdf8; font-weight: bold;">a3len v2.0</div>
                            </div>
                            <div>
                                <div style="color: #9ca3af">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«</div>
                                <div style="color: #38bdf8; font-weight: bold;">${formatDate(Date.now())}</div>
                            </div>
                            <div>
                                <div style="color: #9ca3af;">Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø§Ø¯Ù…</div>
                                <div style="color: #10b981; font-weight: bold;">ğŸŸ¢ Ù†Ø´Ø·</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            hideLoading();
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù†Ø´Ø§Ø·
        function loadActivityLogs() {
            showLoading();
            
            db.ref('systemLogs').limitToLast(100).once('value').then(snapshot => {
                const logs = snapshot.val() || {};
                
                const content = document.getElementById('adminContent');
                
                content.innerHTML = `
                    <div class="content-header">
                        <h3 class="content-title">ğŸ“ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù†Ø´Ø§Ø· (Ø¢Ø®Ø± 100 Ø­Ø¯Ø«)</h3>
                        <div class="content-controls">
                            <select class="filter-select" id="activityFilter" onchange="filterActivityLogs()">
                                <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«</option>
                                <option value="user">Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</option>
                                <option value="verification">Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ØªÙˆØ«ÙŠÙ‚</option>
                                <option value="admin">Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</option>
                                <option value="system">Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù†Ø¸Ø§Ù…</option>
                            </select>
                            <button class="btn btn-danger" onclick="clearActivityLogs()">
                                ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„Ø§Øª
                            </button>
                        </div>
                    </div>
                    
                    <div class="activity-list" style="height: 600px;">
                        ${Object.entries(logs).sort(([,a], [,b]) => (b.timestamp || 0) - (a.timestamp || 0))
                            .map(([logId, log]) => {
                                // Ø¥Ø¶Ø§ÙØ© Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø®Ø§ØµØ© Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ØªÙˆØ«ÙŠÙ‚
                                const icon = log.type === 'verification' ? 'ğŸ”µ' : getLogIcon(log.type);
                                
                                return `
                                <div class="activity-item">
                                    <div class="activity-icon">
                                        ${icon}
                                    </div>
                                    <div class="activity-content">
                                        <div class="activity-text">${log.message || 'Ø­Ø¯Ø« ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
                                        <div class="activity-time">
                                            ${log.timestamp ? formatDateTime(log.timestamp) : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}
                                            ${log.userId ? ` | Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${getUserName(log.userId)}` : ''}
                                        </div>
                                    </div>
                                </div>
                            `;
                            }).join('')}
                    </div>
                `;
                
                hideLoading();
            });
        }
        
        // ========================================
        // Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø©
        // ========================================
        
        function showNotification(message, type = 'info') {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <span>${type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : type === 'warning' ? 'âš ï¸' : 'â„¹ï¸'}</span>
                <span>${message}</span>
            `;
            
            container.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }
        
        function showLoading() {
            document.getElementById('loadingContent').style.display = 'block';
        }
        
        function hideLoading() {
            document.getElementById('loadingContent').style.display = 'none';
        }
        
        function closeUserModal() {
            document.getElementById('userModal').style.display = 'none';
        }
        
        function closeProductModal() {
            document.getElementById('productModal').style.display = 'none';
        }
        
        function closeSystemLogs() {
            document.getElementById('systemLogsModal').style.display = 'none';
        }
        
        function showSystemLogs() {
            document.getElementById('systemLogsModal').style.display = 'flex';
            loadSystemLogsModal();
        }
        
        function loadSystemLogsModal() {
            // Ø³ÙŠØªÙ… ØªÙ†ÙÙŠØ°Ù‡Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹
        }
        
        function getStatusText(status) {
            const statuses = {
                'available': 'Ù…ØªØ§Ø­',
                'sold': 'Ù…Ø¨Ø§Ø¹',
                'reserved': 'Ù…Ø­Ø¬ÙˆØ²'
            };
            return statuses[status] || status;
        }
        
        function formatDate(timestamp) {
            if (!timestamp) return 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
            const date = new Date(timestamp);
            return date.toLocaleDateString('ar-SA');
        }
        
        function formatDateTime(timestamp) {
            if (!timestamp) return 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
            const date = new Date(timestamp);
            return date.toLocaleString('ar-SA');
        }
        
        function formatTimeAgo(timestamp) {
            if (!timestamp) return '';
            const date = new Date(timestamp);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / (1000 * 60));
            
            if (diffMins < 60) return `Ù‚Ø¨Ù„ ${diffMins} Ø¯Ù‚ÙŠÙ‚Ø©`;
            if (diffMins < 1440) return `Ù‚Ø¨Ù„ ${Math.floor(diffMins / 60)} Ø³Ø§Ø¹Ø©`;
            return `Ù‚Ø¨Ù„ ${Math.floor(diffMins / 1440)} ÙŠÙˆÙ…`;
        }
        
        function getLogIcon(logType) {
            const icons = {
                'user': 'ğŸ‘¤',
                'product': 'ğŸ›’',
                'admin': 'ğŸ‘‘',
                'system': 'âš™ï¸',
                'verification': 'ğŸ”µ',
                'security': 'ğŸ”’',
                'report': 'âš ï¸',
                'login': 'ğŸ”‘',
                'logout': 'ğŸšª'
            };
            return icons[logType] || 'ğŸ“';
        }
        
        function getUserName(userId) {
            const user = allUsers[userId];
            return user ? (user.fullName || user.username || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ') : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
        }
        
        function calculateAverageRating(reviews) {
            if (!reviews) return 0;
            const ratings = Object.values(reviews).map(r => r.rating || 0);
            if (ratings.length === 0) return 0;
            const sum = ratings.reduce((a, b) => a + b, 0);
            return (sum / ratings.length).toFixed(1);
        }
        
        function calculateUserRating(userId, reviews) {
            if (!reviews || !reviews[userId]) return '0.0';
            const userReviews = Object.values(reviews[userId]);
            if (userReviews.length === 0) return '0.0';
            const sum = userReviews.reduce((a, b) => a + (b.rating || 0), 0);
            return (sum / userReviews.length).toFixed(1);
        }
        
        function groupDataByMonth(data, timestampField) {
            const monthlyData = {};
            
            Object.values(data || {}).forEach(item => {
                if (item[timestampField]) {
                    const date = new Date(item[timestampField]);
                    const monthKey = `${date.getFullYear()}-${date.getMonth() + 1}`;
                    
                    if (!monthlyData[monthKey]) {
                        monthlyData[monthKey] = 0;
                    }
                    monthlyData[monthKey]++;
                }
            });
            
            return monthlyData;
        }
        
        function logSystemActivity(type, message) {
            const logData = {
                type,
                message,
                timestamp: Date.now(),
                userId: currentUser?.uid,
                ip: 'unknown'
            };
            
            db.ref('systemLogs').push(logData);
        }
        
        // ========================================
        // Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­ÙƒÙ…
        // ========================================
        
        function toggleAdminStatus(userId, makeAdmin) {
            const action = makeAdmin ? 'Ù…Ù†Ø­ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù…Ø¯ÙŠØ±' : 'Ø³Ø­Ø¨ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù…Ø¯ÙŠØ±';
            if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ${action}ØŸ`)) {
                db.ref('users/' + userId).update({
                    isAdmin: makeAdmin,
                    lastUpdated: Date.now()
                }).then(() => {
                    const message = makeAdmin ? 'ØªÙ… Ù…Ù†Ø­ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù…Ø¯ÙŠØ±' : 'ØªÙ… Ø³Ø­Ø¨ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù…Ø¯ÙŠØ±';
                    showNotification(message, 'success');
                    logSystemActivity('admin', `${message} Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… ${userId}`);
                    loadUsersManagement();
                });
            }
        }
        
        function toggleVerification(userId, verify) {
            const action = verify ? 'ØªÙˆØ«ÙŠÙ‚' : 'Ø¥Ù„ØºØ§Ø¡ ØªÙˆØ«ÙŠÙ‚';
            if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ${action} Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ`)) {
                db.ref('users/' + userId).update({
                    isVerified: verify,
                    lastUpdated: Date.now(),
                    verifiedAt: verify ? Date.now() : null,
                    verifiedBy: verify ? currentUser?.uid : null
                }).then(() => {
                    const message = verify ? 'ØªÙ… ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…' : 'ØªÙ… Ø¥Ù„ØºØ§Ø¡ ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…';
                    showNotification(message, 'success');
                    logSystemActivity('verification', `${message}: ${userId}`);
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                    if (allUsers[userId]) {
                        allUsers[userId].isVerified = verify;
                    }
                    
                    loadUsersManagement();
                });
            }
        }
        
        // ØªÙˆØ«ÙŠÙ‚ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‡Ù„ÙŠÙ†
        function verifyAllEligibleUsers() {
            if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªÙˆØ«ÙŠÙ‚ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‡Ù„ÙŠÙ† ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ØŸ')) return;
            
            showLoading();
            let verifiedCount = 0;
            
            Object.entries(allUsers).forEach(([userId, user]) => {
                // Ø´Ø±ÙˆØ· Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
                const hasEnoughProducts = (user.totalProducts || 0) >= 5;
                const hasGoodRating = (user.avgRating || 0) >= 4;
                const hasPhone = user.phone && user.phone.length > 5;
                
                if (!user.isVerified && hasEnoughProducts && hasGoodRating && hasPhone) {
                    db.ref('users/' + userId).update({
                        isVerified: true,
                        lastUpdated: Date.now(),
                        verifiedAt: Date.now(),
                        verifiedBy: 'system_auto'
                    });
                    verifiedCount++;
                }
            });
            
            setTimeout(() => {
                hideLoading();
                showNotification(`ØªÙ… ØªÙˆØ«ÙŠÙ‚ ${verifiedCount} Ù…Ø³ØªØ®Ø¯Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹`, 'success');
                logSystemActivity('verification', `ØªÙ… ØªÙˆØ«ÙŠÙ‚ ${verifiedCount} Ù…Ø³ØªØ®Ø¯Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹`);
                loadUsersManagement();
            }, 1000);
        }
        
        function updateProductStatus(productId, newStatus) {
            db.ref('products/' + productId).update({
                status: newStatus,
                lastUpdated: Date.now()
            }).then(() => {
                showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†', 'success');
                logSystemActivity('product', `ØªÙ… ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† ${productId} Ø¥Ù„Ù‰ ${newStatus}`);
            });
        }
        
        function deleteSingleProduct(productId) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ØŸ')) {
                db.ref('products/' + productId).remove().then(() => {
                    showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†', 'success');
                    logSystemActivity('product', `ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† ${productId}`);
                    loadProductsManagement();
                });
            }
        }
        
        function deleteSelectedProducts() {
            const selected = Array.from(document.querySelectorAll('.product-checkbox:checked'))
                .map(cb => cb.value);
            
            if (selected.length === 0) {
                showNotification('Ù„Ù… ØªÙ‚Ù… Ø¨ØªØ­Ø¯ÙŠØ¯ Ø£ÙŠ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª', 'warning');
                return;
            }
            
            if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ${selected.length} Ø¥Ø¹Ù„Ø§Ù†ØŸ`)) {
                const deletePromises = selected.map(productId => 
                    db.ref('products/' + productId).remove()
                );
                
                Promise.all(deletePromises).then(() => {
                    showNotification(`ØªÙ… Ø­Ø°Ù ${selected.length} Ø¥Ø¹Ù„Ø§Ù†`, 'success');
                    logSystemActivity('product', `ØªÙ… Ø­Ø°Ù ${selected.length} Ø¥Ø¹Ù„Ø§Ù†`);
                    loadProductsManagement();
                });
            }
        }
        
        function toggleSelectAllUsers() {
            const selectAll = document.getElementById('selectAllUsers').checked;
            document.querySelectorAll('.user-checkbox').forEach(cb => {
                cb.checked = selectAll;
            });
        }
        
        function toggleSelectAllProducts() {
            const selectAll = document.getElementById('selectAllProducts').checked;
            document.querySelectorAll('.product-checkbox').forEach(cb => {
                cb.checked = selectAll;
            });
        }
        
        function refreshAllData() {
            showNotification('Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...', 'info');
            loadDashboard();
        }
        
        function performSearch() {
            const query = document.getElementById('globalSearch').value.trim().toLowerCase();
            if (!query) return;
            
            // Ø¨Ø­Ø« Ø´Ø§Ù…Ù„ ÙÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª
            const userResults = Object.entries(allUsers).filter(([, user]) => 
                (user.fullName && user.fullName.toLowerCase().includes(query)) ||
                (user.username && user.username.toLowerCase().includes(query)) ||
                (user.email && user.email.toLowerCase().includes(query))
            );
            
            const productResults = Object.entries(allProducts).filter(([, product]) => 
                (product.name && product.name.toLowerCase().includes(query)) ||
                (product.seller && product.seller.toLowerCase().includes(query)) ||
                (product.category && product.category.toLowerCase().includes(query))
            );
            
            // Ø¹Ø±Ø¶ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«
            const content = document.getElementById('adminContent');
            content.innerHTML = `
                <div class="content-header">
                    <h3 class="content-title">ğŸ” Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù†: "${query}"</h3>
                    <button class="btn btn-outline" onclick="showTab('${currentTab}')">
                        Ø±Ø¬ÙˆØ¹
                    </button>
                </div>
                
                <div class="content-body" style="padding: 25px;">
                    <h4 style="color: #38bdf8; margin-bottom: 15px;">ğŸ‘¥ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† (${userResults.length})</h4>
                    <div class="table-container" style="margin-bottom: 30px;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                                    <th>Ø§Ù„Ø¨Ø±ÙŠØ¯</th>
                                    <th>Ø­Ø§Ù„Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚</th>
                                    <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</th>
                                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${userResults.slice(0, 10).map(([userId, user]) => {
                                    const verifiedBadge = user.isVerified ? 
                                        '<span class="status-verified" style="margin-right: 5px;"><span class="verified-badge-icon">âœ“</span>Ù…ÙˆØ«Ù‘Ù‚</span>' : 
                                        '<span class="status-badge status-pending">ØºÙŠØ± Ù…ÙˆØ«Ù‘Ù‚</span>';
                                    
                                    return `
                                        <tr>
                                            <td>
                                                <div style="display: flex; align-items: center; gap: 8px;">
                                                    ${user.fullName || user.username || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}
                                                    ${verifiedBadge}
                                                </div>
                                            </td>
                                            <td>${user.email || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</td>
                                            <td>${verifiedBadge}</td>
                                            <td>${user.totalProducts || 0}</td>
                                            <td>
                                                <button class="btn btn-xs btn-primary" onclick="viewUserDetails('${userId}')">
                                                    Ø¹Ø±Ø¶
                                                </button>
                                            </td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                    
                    <h4 style="color: #38bdf8; margin-bottom: 15px;">ğŸ›’ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª (${productResults.length})</h4>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</th>
                                    <th>Ø§Ù„Ø³Ø¹Ø±</th>
                                    <th>Ø§Ù„Ø¨Ø§Ø¦Ø¹</th>
                                    <th>Ø­Ø§Ù„Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚</th>
                                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${productResults.slice(0, 10).map(([productId, product]) => {
                                    const seller = allUsers[product.uid];
                                    const verifiedBadge = seller?.isVerified ? 
                                        '<span class="status-verified" style="margin-right: 5px;"><span class="verified-badge-icon">âœ“</span>Ù…ÙˆØ«Ù‘Ù‚</span>' : 
                                        '<span class="status-badge status-pending">ØºÙŠØ± Ù…ÙˆØ«Ù‘Ù‚</span>';
                                    
                                    return `
                                        <tr>
                                            <td>${product.name || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…'}</td>
                                            <td>${product.price ? parseInt(product.price).toLocaleString('ar-SA') + ' Ø¯.Ø¹' : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                                            <td>
                                                <div style="display: flex; align-items: center; gap: 5px;">
                                                    ${seller?.fullName || seller?.username || product.seller || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}
                                                    ${verifiedBadge}
                                                </div>
                                            </td>
                                            <td>${verifiedBadge}</td>
                                            <td><span class="status-badge status-${product.status || 'available'}">
                                                ${getStatusText(product.status || 'available')}
                                            </span></td>
                                            <td>
                                                <button class="btn btn-xs btn-primary" onclick="viewProductDetails('${productId}')">
                                                    Ø¹Ø±Ø¶
                                                </button>
                                            </td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }
        
        function handleGlobalSearch(event) {
            if (event.key === 'Enter') {
                performSearch();
            }
        }
        
        function exportData() {
            // ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒÙ…Ù„Ù JSON
            const data = {
                users: allUsers,
                products: allProducts,
                exportedAt: new Date().toISOString(),
                exportedBy: currentUser?.uid
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `a3len-backup-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showNotification('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
            logSystemActivity('system', 'ØªÙ… ØªØµØ¯ÙŠØ± Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
        }
        
        // ========================================
        // Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
        // ========================================
        
        function saveSystemSettings() {
            const settings = {
                publishCooldown: parseInt(document.getElementById('publishCooldown').value) || 1,
                dailyLimit: parseInt(document.getElementById('dailyLimit').value) || 10,
                lastUpdated: Date.now(),
                updatedBy: currentUser?.uid
            };
            
            db.ref('systemSettings').set(settings).then(() => {
                showNotification('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
                logSystemActivity('system', 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…');
            });
        }
        
        function isRequirementActive(requirement) {
            // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙØ¹ÙŠÙ„ Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„ØªÙˆØ«ÙŠÙ‚
            return true; // Ù…Ø¤Ù‚ØªØ§Ù‹
        }
        
        function toggleVerificationRequirement(requirement) {
            showNotification(`ØªÙ… ØªØ­Ø¯ÙŠØ« Ù…ØªØ·Ù„Ø¨ Ø§Ù„ØªÙˆØ«ÙŠÙ‚: ${requirement}`, 'info');
        }
        
        function toggleAutoVerification(enable) {
            showNotification(`Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ${enable ? 'ØªÙ… ØªÙØ¹ÙŠÙ„Ù‡' : 'ØªÙ… ØªØ¹Ø·ÙŠÙ„Ù‡'}`, 'info');
        }
        
        function showVerificationStats() {
            const totalUsers = Object.keys(allUsers).length;
            const verifiedUsers = Object.values(allUsers).filter(user => user.isVerified).length;
            const verificationRate = totalUsers > 0 ? Math.round((verifiedUsers / totalUsers) * 100) : 0;
            
            alert(`ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªÙˆØ«ÙŠÙ‚:\n\nğŸ‘¥ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†: ${totalUsers}\nâœ… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ÙˆØ«Ù‚ÙŠÙ†: ${verifiedUsers}\nğŸ“ˆ Ù†Ø³Ø¨Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚: ${verificationRate}%\n\nğŸ”µ Ø§Ù„Ø´Ø§Ø±Ø© Ø§Ù„Ø²Ø±Ù‚Ø§Ø¡ ØªØ¸Ù‡Ø± Ø¨Ø¬Ø§Ù†Ø¨ Ø§Ø³Ù… ÙƒÙ„ Ø´Ø®Øµ Ù…ÙˆØ«Ù‘Ù‚ ÙÙŠ:\nâ€¢ Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„\nâ€¢ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª\nâ€¢ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª\nâ€¢ Ø£ÙŠ Ù…ÙƒØ§Ù† ÙŠØ¸Ù‡Ø± ÙÙŠÙ‡ Ø§Ù„Ø§Ø³Ù…`);
        }
        
        function removeAllVerifications() {
            if (!confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù„ØºØ§Ø¡ Ø¬Ù…ÙŠØ¹ ØªÙˆØ«ÙŠÙ‚Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†ØŸ')) return;
            
            showLoading();
            let updatedCount = 0;
            
            Object.entries(allUsers).forEach(([userId, user]) => {
                if (user.isVerified) {
                    db.ref('users/' + userId).update({
                        isVerified: false,
                        lastUpdated: Date.now(),
                        verifiedAt: null,
                        verifiedBy: null
                    });
                    updatedCount++;
                }
            });
            
            setTimeout(() => {
                hideLoading();
                showNotification(`ØªÙ… Ø¥Ù„ØºØ§Ø¡ ØªÙˆØ«ÙŠÙ‚ ${updatedCount} Ù…Ø³ØªØ®Ø¯Ù…`, 'success');
                logSystemActivity('verification', `ØªÙ… Ø¥Ù„ØºØ§Ø¡ ØªÙˆØ«ÙŠÙ‚ ${updatedCount} Ù…Ø³ØªØ®Ø¯Ù…`);
                loadUsersManagement();
            }, 1000);
        }
        
        // ========================================
        // ØªØµÙÙŠØ© ÙˆØ¨Ø­Ø«
        // ========================================
        
        function filterUsers() {
            const filter = document.getElementById('userFilter').value;
            const searchTerm = document.getElementById('userSearch')?.value.toLowerCase() || '';
            
            let filteredUsers = Object.entries(allUsers);
            
            // Ø§Ù„ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
            if (filter === 'admin') {
                filteredUsers = filteredUsers.filter(([, user]) => user.isAdmin);
            } else if (filter === 'verified') {
                filteredUsers = filteredUsers.filter(([, user]) => user.isVerified);
            } else if (filter === 'unverified') {
                filteredUsers = filteredUsers.filter(([, user]) => !user.isVerified);
            } else if (filter === 'active') {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                filteredUsers = filteredUsers.filter(([, user]) => 
                    user.lastActive && new Date(user.lastActive) >= today
                );
            } else if (filter === 'inactive') {
                const weekAgo = new Date();
                weekAgo.setDate(weekAgo.getDate() - 7);
                filteredUsers = filteredUsers.filter(([, user]) => 
                    !user.lastActive || new Date(user.lastActive) < weekAgo
                );
            }
            
            // Ø§Ù„Ø¨Ø­Ø«
            if (searchTerm) {
                filteredUsers = filteredUsers.filter(([, user]) =>
                    (user.fullName && user.fullName.toLowerCase().includes(searchTerm)) ||
                    (user.username && user.username.toLowerCase().includes(searchTerm)) ||
                    (user.email && user.email.toLowerCase().includes(searchTerm))
                );
            }
            
            displayUsersTable(allUsers, filteredUsers);
        }
        
        function searchUsers() {
            filterUsers();
        }
        
        function filterProducts() {
            const filter = document.getElementById('productFilter').value;
            const searchTerm = document.getElementById('productSearch')?.value.toLowerCase() || '';
            
            let filteredProducts = Object.entries(allProducts);
            
            // Ø§Ù„ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
            if (filter === 'available') {
                filteredProducts = filteredProducts.filter(([, product]) => product.status === 'available');
            } else if (filter === 'sold') {
                filteredProducts = filteredProducts.filter(([, product]) => product.status === 'sold');
            } else if (filter === 'reserved') {
                filteredProducts = filteredProducts.filter(([, product]) => product.status === 'reserved');
            } else if (filter === 'today') {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                filteredProducts = filteredProducts.filter(([, product]) => 
                    product.timestamp && new Date(product.timestamp) >= today
                );
            } else if (filter === 'verified') {
                filteredProducts = filteredProducts.filter(([, product]) => {
                    const seller = allUsers[product.uid];
                    return seller && seller.isVerified;
                });
            }
            
            // Ø§Ù„Ø¨Ø­Ø«
            if (searchTerm) {
                filteredProducts = filteredProducts.filter(([, product]) =>
                    (product.name && product.name.toLowerCase().includes(searchTerm)) ||
                    (product.seller && product.seller.toLowerCase().includes(searchTerm)) ||
                    (product.category && product.category.toLowerCase().includes(searchTerm))
                );
            }
            
            displayProductsTable(allProducts, filteredProducts);
        }
        
        function searchProducts() {
            filterProducts();
        }
        
        // ========================================
        // Ø¯ÙˆØ§Ù„ Ù…ØªØ¨Ù‚ÙŠØ©
        // ========================================
        
        function addNewUser() {
            showNotification('Ø®Ø§ØµÙŠØ© Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯ Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±', 'info');
        }
        
        function editUser(userId) {
            viewUserDetails(userId);
        }
        
        function editProductAdmin(productId) {
            viewProductDetails(productId);
        }
        
        function generateReport() {
            showNotification('Ø®Ø§ØµÙŠØ© Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±', 'info');
        }
        
        function updateAnalytics() {
            showNotification('Ø®Ø§ØµÙŠØ© Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±', 'info');
        }
        
        function exportAnalytics() {
            showNotification('Ø®Ø§ØµÙŠØ© ØªØµØ¯ÙŠØ± Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±', 'info');
        }
        
        function filterReports() {
            showNotification('Ø®Ø§ØµÙŠØ© ØªØµÙÙŠØ© Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±', 'info');
        }
        
        function displayReportsTable(reports) {
            // Ø³ÙŠØªÙ… ØªÙ†ÙÙŠØ°Ù‡Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹
            const tbody = document.getElementById('reportsTableBody');
            tbody.innerHTML = '<tr><td colspan="7" style="text-align:center; padding:40px; color:#9ca3af;">Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±</td></tr>';
        }
        
        function resolveAllReports() {
            showNotification('Ø®Ø§ØµÙŠØ© Ø­Ù„ Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±', 'info');
        }
        
        function filterActivityLogs() {
            showNotification('Ø®Ø§ØµÙŠØ© ØªØµÙÙŠØ© Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù†Ø´Ø§Ø· Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±', 'info');
        }
        
        function clearActivityLogs() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù†Ø´Ø§Ø·ØŸ')) {
                db.ref('systemLogs').remove().then(() => {
                    showNotification('ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù†Ø´Ø§Ø·', 'success');
                    loadActivityLogs();
                });
            }
        }
        
        function toggleTwoFactor(enable) {
            showNotification(`Ø®Ø§ØµÙŠØ© Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ø®Ø·ÙˆØªÙŠÙ† ${enable ? 'ØªÙ… ØªÙØ¹ÙŠÙ„Ù‡Ø§' : 'ØªÙ… ØªØ¹Ø·ÙŠÙ„Ù‡Ø§'}`, 'info');
        }
        
        function toggleSessionLogging(enable) {
            showNotification(`ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¬Ù„Ø³Ø§Øª ${enable ? 'ØªÙ… ØªÙØ¹ÙŠÙ„Ù‡' : 'ØªÙ… ØªØ¹Ø·ÙŠÙ„Ù‡'}`, 'info');
        }
        
        function resetAllPasswords() {
            showNotification('Ø®Ø§ØµÙŠØ© Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±', 'info');
        }
        
        function toggleMaintenance(enable) {
            showNotification(`ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø© ${enable ? 'ØªÙ… ØªÙØ¹ÙŠÙ„Ù‡' : 'ØªÙ… ØªØ¹Ø·ÙŠÙ„Ù‡'}`, 'info');
        }
        
        function clearAllLogs() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§ØªØŸ')) {
                db.ref('systemLogs').remove().then(() => {
                    showNotification('ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª', 'success');
                    loadSystemLogsModal();
                });
            }
        }
        
        function exportLogs() {
            showNotification('Ø®Ø§ØµÙŠØ© ØªØµØ¯ÙŠØ± Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±', 'info');
        }
        
        // ========================================
        // Ø¯ÙˆØ§Ù„ Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ù„Ù„ØµÙØ­Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰
        // ========================================
        
        /**
         * Ù‡Ø°Ù‡ Ø§Ù„Ø¯ÙˆØ§Ù„ ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØªÙ‡Ø§ Ù„Ù…Ù„Ù JavaScript Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ù„Ù…ÙˆÙ‚Ø¹
         * Ø­ØªÙ‰ ØªØ¸Ù‡Ø± Ø´Ø§Ø±Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚ ÙÙŠ Ø¬Ù…ÙŠØ¹ ØµÙØ­Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹
         */
        
        // Ø¯Ø§Ù„Ø© Ø¹Ø§Ù…Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø§Ø³Ù… Ù…Ø¹ Ø§Ù„ØªÙˆØ«ÙŠÙ‚ (Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙØ­Ø§Øª)
        window.displayUserNameWithVerification = function(userId, containerId) {
            const user = allUsers[userId];
            if (!user) return;
            
            const container = document.getElementById(containerId);
            if (!container) return;
            
            const verifiedBadge = user.isVerified ? 
                '<span class="status-verified" style="margin-right: 5px;"><span class="verified-badge-icon">âœ“</span>Ù…ÙˆØ«Ù‘Ù‚</span>' : '';
            
            container.innerHTML = `
                <span>${user.fullName || user.username}</span>
                ${verifiedBadge}
            `;
        };
        
        // Ø¯Ø§Ù„Ø© Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙˆØ«ÙŠÙ‚ ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
        window.checkUserVerification = function(userId) {
            return allUsers[userId]?.isVerified || false;
        };
        
        // ØªÙ‡ÙŠØ¦Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø£ÙŠ ØµÙØ­Ø©
        window.initializeUsersData = function() {
            if (window.allUsers && Object.keys(window.allUsers).length > 0) return;
            
            // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ù† Firebase
            db.ref('users').once('value').then(snapshot => {
                window.allUsers = snapshot.val() || {};
                console.log('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù„Ù„ØªÙˆØ«ÙŠÙ‚');
            });
        };
        
        // ØªØ´ØºÙŠÙ„ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        if (typeof initialize === 'undefined') {
            document.addEventListener('DOMContentLoaded', function() {
                setTimeout(() => {
                    window.initializeUsersData();
                }, 1000);
            });
        }
    </script>
</body>
</html>
