<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>a3len | Ø­Ø³Ø§Ø¨ÙŠ</title>
<link rel="stylesheet" href="style.css">

<style>
/* ===== Custom Font ===== */
@font-face {
  font-family: 'CustomFont';
  src: url('font.ttf') format('truetype');
}
body, input, select, button, textarea { font-family: 'CustomFont', sans-serif; }

/* ===== Ø£Ù†Ù…Ø§Ø· Ø®Ø§ØµØ© Ø¨ØµÙØ­Ø© Ø­Ø³Ø§Ø¨ÙŠ ===== */
.profile-container {
  max-width: 800px;
  margin: 0 auto;
  padding: 20px;
}

.profile-header {
  background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
  border-radius: 12px;
  padding: 25px;
  margin-bottom: 25px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.3);
  border: 1px solid #374151;
}

.profile-info {
  display: flex;
  align-items: center;
  gap: 20px;
  margin-bottom: 20px;
}

.profile-avatar {
  width: 80px;
  height: 80px;
  background: linear-gradient(135deg, #38bdf8 0%, #0ea5e9 100%);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 32px;
  font-weight: bold;
  color: white;
}

.profile-details {
  flex: 1;
}

.profile-name {
  font-size: 24px;
  color: #f3f4f6;
  margin-bottom: 5px;
}

.profile-username {
  color: #9ca3af;
  font-size: 16px;
  margin-bottom: 10px;
}

.profile-stats {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 15px;
  margin-top: 20px;
}

.stat-card {
  background: rgba(255,255,255,0.05);
  border-radius: 8px;
  padding: 15px;
  text-align: center;
  border: 1px solid rgba(255,255,255,0.1);
  transition: transform 0.2s;
}

.stat-card:hover {
  transform: translateY(-2px);
  border-color: #38bdf8;
}

.stat-number {
  font-size: 24px;
  font-weight: bold;
  color: #38bdf8;
  margin-bottom: 5px;
}

.stat-label {
  font-size: 14px;
  color: #9ca3af;
}

/* ===== Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„ØªÙˆØ«ÙŠÙ‚ ===== */
.verified-badge {
  background: #10b981;
  color: white;
  font-size: 12px;
  padding: 4px 10px;
  border-radius: 20px;
  margin-right: 10px;
  display: inline-flex;
  align-items: center;
  gap: 5px;
}

.admin-badge {
  background: #8b5cf6;
  color: white;
  font-size: 12px;
  padding: 4px 10px;
  border-radius: 20px;
  margin-right: 10px;
  display: inline-flex;
  align-items: center;
  gap: 5px;
}

/* ===== Ù‚Ø³Ù… Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª ===== */
.my-products-section {
  margin-top: 30px;
}

.section-title {
  font-size: 20px;
  color: #f3f4f6;
  margin-bottom: 15px;
  padding-bottom: 10px;
  border-bottom: 2px solid #38bdf8;
}

.products-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 15px;
  margin-top: 15px;
}

.product-card {
  background: #1f2937;
  border-radius: 10px;
  padding: 15px;
  border: 1px solid #374151;
  transition: all 0.3s;
  position: relative;
}

.product-card:hover {
  border-color: #38bdf8;
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(0,0,0,0.2);
}

.product-status {
  position: absolute;
  top: 10px;
  left: 10px;
  font-size: 11px;
  padding: 3px 8px;
  border-radius: 4px;
}

.status-available { background: rgba(16, 185, 129, 0.2); color: #10b981; }
.status-sold { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
.status-reserved { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }

/* ===== Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… ===== */
.control-buttons {
  display: flex;
  gap: 10px;
  margin-top: 10px;
}

.control-btn {
  flex: 1;
  padding: 8px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
  transition: opacity 0.2s;
}

.control-btn:hover {
  opacity: 0.9;
}

.btn-edit {
  background: #38bdf8;
  color: black;
}

.btn-delete {
  background: #ef4444;
  color: white;
}

.btn-view {
  background: #10b981;
  color: white;
}

/* ===== Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø­Ø§Ù„Ø© ===== */
.status-message {
  padding: 15px;
  border-radius: 8px;
  margin: 10px 0;
  text-align: center;
  display: none;
}

.success-message {
  background: rgba(16, 185, 129, 0.1);
  border: 1px solid #10b981;
  color: #10b981;
}

.error-message {
  background: rgba(239, 68, 68, 0.1);
  border: 1px solid #ef4444;
  color: #ef4444;
}

/* ===== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ ===== */
.settings-section {
  background: #1f2937;
  border-radius: 12px;
  padding: 20px;
  margin-top: 30px;
  border: 1px solid #374151;
}

.settings-title {
  font-size: 18px;
  color: #f3f4f6;
  margin-bottom: 15px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.setting-item {
  background: rgba(255,255,255,0.03);
  border-radius: 8px;
  padding: 15px;
  margin-bottom: 10px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border: 1px solid rgba(255,255,255,0.1);
}

.setting-label {
  color: #d1d5db;
  font-size: 15px;
}

.setting-value {
  color: #9ca3af;
  font-size: 14px;
}

/* ===== Ø§Ù„ØªÙ†Ù‚Ù„ ===== */
.nav-buttons {
  display: flex;
  gap: 10px;
  margin-top: 20px;
  justify-content: center;
}

.nav-btn {
  padding: 10px 20px;
  background: #374151;
  border: none;
  border-radius: 8px;
  color: #e5e7eb;
  cursor: pointer;
  font-size: 14px;
  transition: background 0.2s;
}

.nav-btn:hover {
  background: #4b5563;
}

.nav-btn-primary {
  background: #38bdf8;
  color: black;
}

.nav-btn-primary:hover {
  background: #0ea5e9;
}

/* ===== Ø§Ù„ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø§Ù„Ø¬ÙˆØ§Ù„ ===== */
@media (max-width: 768px) {
  .profile-info {
    flex-direction: column;
    text-align: center;
  }
  
  .profile-stats {
    grid-template-columns: 1fr;
  }
  
  .products-grid {
    grid-template-columns: 1fr;
  }
  
  .control-buttons {
    flex-direction: column;
  }
}
</style>
</head>
<body>

<header class="topbar">
  <div class="menu-toggle" onclick="toggleSidebar()">â˜°</div>
  <div class="logo">a3len</div>
  <div class="tagline">Ø­Ø³Ø§Ø¨ÙŠ Ø§Ù„Ø´Ø®ØµÙŠ</div>
</header>

<div class="overlay" onclick="closeSidebar()"></div>

<div class="layout">
  <aside class="sidebar">
    <button onclick="window.location.href='index.html'">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    <button onclick="window.location.href='index.html?publish'">â• Ù†Ø´Ø± Ø¥Ø¹Ù„Ø§Ù†</button>
    <button onclick="showMyProducts()">ğŸ“¦ Ø¥Ø¹Ù„Ø§Ù†Ø§ØªÙŠ</button>
    <button onclick="showSettings()">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
    <div class="auth-section" style="margin-top: auto;">
      <button class="logout-btn" onclick="logout()" style="width:100%; margin-top:10px;">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
    </div>
  </aside>

  <main>
    <div id="profileContent" class="profile-container">
      <!-- Ø³ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù‡Ù†Ø§ Ø¹Ø¨Ø± JavaScript -->
    </div>
  </main>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<script>
// Ø¥Ø¹Ø¯Ø§Ø¯ Firebase
const firebaseConfig = {
  apiKey: "AIzaSyAl3XunFOwHpGw-4_VYyETMtoLgk4mnRpQ",
  authDomain: "a3len-3ad54.firebasestorage.app",
  databaseURL: "https://a3len-3ad54-default-rtdb.firebaseio.com",
  projectId: "a3len-3ad54",
  storageBucket: "a3len-3ad54.firebasestorage.app",
  messagingSenderId: "767338034080",
  appId: "1:767338034080:web:801d77fb74c0aa56e92ac5"
};

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙƒØ±Ø§Ø± ØªÙ‡ÙŠØ¦Ø© Firebase
if (!firebase.apps.length) {
    firebase.initializeApp(firebaseConfig);
}

const auth = firebase.auth();
const db = firebase.database();

// Ø¹Ù†Ø§ØµØ± Ø§Ù„ØµÙØ­Ø©
let currentUser = null;
let userData = null;

// ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
function loadUserData() {
    const user = auth.currentUser;
    if (!user || user.isAnonymous) {
        showMessage("ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ø¹Ø±Ø¶ ØµÙØ­Ø© Ø­Ø³Ø§Ø¨Ùƒ", "error");
        setTimeout(() => window.location.href = 'index.html', 2000);
        return;
    }

    currentUser = user;
    
    // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    db.ref("users/" + user.uid).once("value")
        .then(snapshot => {
            userData = snapshot.val();
            if (!userData) {
                // Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯
                userData = {
                    username: user.email ? user.email.split('@')[0] : 'Ù…Ø³ØªØ®Ø¯Ù…',
                    fullName: 'Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯',
                    totalProducts: 0,
                    isVerified: false,
                    isAdmin: false,
                    joinDate: firebase.database.ServerValue.TIMESTAMP
                };
                db.ref("users/" + user.uid).set(userData);
            }
            showProfile();
        })
        .catch(error => {
            console.error("Error loading user data:", error);
            showMessage("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª", "error");
        });
}

// Ø¹Ø±Ø¶ ØµÙØ­Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
function showProfile() {
    const profileContent = document.getElementById('profileContent');
    
    // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØ§Ø±ÙŠØ®
    const joinDate = userData.joinDate ? new Date(userData.joinDate).toLocaleDateString('ar-SA') : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
    
    // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„ Ù„Ù„Ø­Ø±Ù Ø§Ù„Ø£ÙˆÙ„
    const firstLetter = userData.fullName ? userData.fullName.charAt(0) : 'Ù…';
    
    profileContent.innerHTML = `
        <div class="profile-header">
            <div class="profile-info">
                <div class="profile-avatar">${firstLetter}</div>
                <div class="profile-details">
                    <h1 class="profile-name">
                        ${userData.fullName || 'Ù…Ø³ØªØ®Ø¯Ù…'}
                        ${userData.isVerified ? '<span class="verified-badge">âœ“ Ù…ÙˆØ«Ù‘Ù‚</span>' : ''}
                        ${userData.isAdmin ? '<span class="admin-badge">ğŸ‘‘ Ù…Ø¯ÙŠØ±</span>' : ''}
                    </h1>
                    <p class="profile-username">@${userData.username || 'Ù…Ø³ØªØ®Ø¯Ù…'}</p>
                    <p style="color:#9ca3af; margin-bottom:5px;">${currentUser.email || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ'}</p>
                    <p style="color:#6b7280; font-size:14px;">Ø¹Ø¶Ùˆ Ù…Ù†Ø°: ${joinDate}</p>
                </div>
            </div>
            
            <div class="profile-stats">
                <div class="stat-card">
                    <div class="stat-number">${userData.totalProducts || 0}</div>
                    <div class="stat-label">Ø¥Ø¹Ù„Ø§Ù†</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${userData.soldProducts || 0}</div>
                    <div class="stat-label">Ù…Ø¨Ø§Ø¹</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${userData.activeProducts || 0}</div>
                    <div class="stat-label">Ù†Ø´Ø·</div>
                </div>
            </div>
        </div>
        
        <div class="nav-buttons">
            <button class="nav-btn nav-btn-primary" onclick="showMyProducts()">ğŸ“¦ Ø¥Ø¹Ù„Ø§Ù†Ø§ØªÙŠ</button>
            <button class="nav-btn" onclick="showSettings()">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
            <button class="nav-btn" onclick="window.location.href='index.html'">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
        </div>
        
        <div id="productsSection" class="my-products-section" style="display:none;">
            <h2 class="section-title">Ø¥Ø¹Ù„Ø§Ù†Ø§ØªÙŠ</h2>
            <div id="userProducts" class="products-grid"></div>
        </div>
        
        <div id="settingsSection" class="settings-section" style="display:none;">
            <h2 class="settings-title">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨</h2>
            <div class="setting-item">
                <span class="setting-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</span>
                <span class="setting-value">@${userData.username}</span>
            </div>
            <div class="setting-item">
                <span class="setting-label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</span>
                <span class="setting-value">${userData.fullName || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
            </div>
            <div class="setting-item">
                <span class="setting-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</span>
                <span class="setting-value">${currentUser.email || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
            </div>
            <div class="setting-item">
                <span class="setting-label">Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø³Ø§Ø¨</span>
                <span class="setting-value">
                    ${userData.isVerified ? 'âœ… Ù…ÙˆØ«Ù‘Ù‚' : 'â³ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©'}
                </span>
            </div>
            <div class="nav-buttons">
                <button class="nav-btn" onclick="showProfile()">Ø±Ø¬ÙˆØ¹</button>
            </div>
        </div>
        
        <div id="statusMessage" class="status-message"></div>
    `;
}

// Ø¹Ø±Ø¶ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
function showMyProducts() {
    document.getElementById('productsSection').style.display = 'block';
    document.getElementById('settingsSection').style.display = 'none';
    
    // Ø¬Ù„Ø¨ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    db.ref("products").orderByChild("uid").equalTo(currentUser.uid).once("value")
        .then(snapshot => {
            const products = snapshot.val();
            const productsContainer = document.getElementById('userProducts');
            
            if (!products) {
                productsContainer.innerHTML = `
                    <div style="grid-column:1/-1; text-align:center; padding:40px; color:#9ca3af;">
                        <p style="font-size:18px; margin-bottom:10px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</p>
                        <button onclick="window.location.href='index.html?publish'" 
                                style="padding:10px 20px; background:#38bdf8; color:black; border:none; border-radius:6px; cursor:pointer;">
                            Ù†Ø´Ø± Ø£ÙˆÙ„ Ø¥Ø¹Ù„Ø§Ù†
                        </button>
                    </div>
                `;
                return;
            }
            
            let productsHTML = '';
            Object.keys(products).forEach(key => {
                const product = products[key];
                
                // ØªØ­Ø¯ÙŠØ¯ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù†ØªØ¬
                let statusClass = 'status-available';
                let statusText = 'Ù…ØªØ§Ø­';
                if (product.status === 'sold') {
                    statusClass = 'status-sold';
                    statusText = 'Ù…Ø¨Ø§Ø¹';
                } else if (product.status === 'reserved') {
                    statusClass = 'status-reserved';
                    statusText = 'Ù…Ø­Ø¬ÙˆØ²';
                }
                
                productsHTML += `
                    <div class="product-card">
                        <div class="product-status ${statusClass}">${statusText}</div>
                        <h3 style="margin:10px 0 5px 0; color:#f3f4f6;">${escapeHTML(product.name)}</h3>
                        <p style="color:#38bdf8; font-size:18px; font-weight:bold; margin:5px 0;">
                            ${formatPrice(product.price)} Ø¯.Ø¹
                        </p>
                        <div style="color:#9ca3af; font-size:14px; margin:5px 0;">
                            <span>${product.category || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span> | 
                            <span>${product.province || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                        </div>
                        <div class="control-buttons">
                            <button class="control-btn btn-view" onclick="viewProduct('${key}')">Ø¹Ø±Ø¶</button>
                            <button class="control-btn btn-edit" onclick="editProduct('${key}')">ØªØ¹Ø¯ÙŠÙ„</button>
                            <button class="control-btn btn-delete" onclick="deleteProduct('${key}')">Ø­Ø°Ù</button>
                        </div>
                    </div>
                `;
            });
            
            productsContainer.innerHTML = productsHTML;
        })
        .catch(error => {
            console.error("Error loading products:", error);
            showMessage("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª", "error");
        });
}

// Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
function showSettings() {
    document.getElementById('productsSection').style.display = 'none';
    document.getElementById('settingsSection').style.display = 'block';
}

// Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬
function viewProduct(productId) {
    window.open(`index.html?view=${productId}`, '_blank');
}

// ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬
function editProduct(productId) {
    window.open(`index.html?edit=${productId}`, '_blank');
}

// Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬
function deleteProduct(productId) {
    if (!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.")) {
        return;
    }
    
    db.ref("products/" + productId).remove()
        .then(() => {
            showMessage("ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø¨Ù†Ø¬Ø§Ø­", "success");
            showMyProducts(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª
            
            // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
            if (userData.totalProducts > 0) {
                db.ref("users/" + currentUser.uid).update({
                    totalProducts: userData.totalProducts - 1
                });
            }
        })
        .catch(error => {
            console.error("Error deleting product:", error);
            showMessage("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†", "error");
        });
}

// ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
function logout() {
    if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ")) {
        auth.signOut()
            .then(() => {
                window.location.href = 'index.html';
            })
            .catch(error => {
                console.error("Logout error:", error);
                showMessage("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬", "error");
            });
    }
}

// Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø©
function showMessage(message, type) {
    const messageDiv = document.getElementById('statusMessage');
    messageDiv.textContent = message;
    messageDiv.className = `status-message ${type}-message`;
    messageDiv.style.display = 'block';
    
    setTimeout(() => {
        messageDiv.style.display = 'none';
    }, 5000);
}

// Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø©
function escapeHTML(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

function formatPrice(price) {
    return parseInt(price).toLocaleString('ar-SA');
}

// Sidebar Functions
function toggleSidebar() {
    document.querySelector(".sidebar").classList.toggle("active");
    document.querySelector(".overlay").classList.toggle("active");
}

function closeSidebar() {
    document.querySelector(".sidebar").classList.remove("active");
    document.querySelector(".overlay").classList.remove("active");
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
document.addEventListener("DOMContentLoaded", function() {
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    auth.onAuthStateChanged(user => {
        if (user && !user.isAnonymous) {
            loadUserData();
        } else {
            showMessage("ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ø¹Ø±Ø¶ ØµÙØ­Ø© Ø­Ø³Ø§Ø¨Ùƒ", "error");
            setTimeout(() => window.location.href = 'index.html', 2000);
        }
    });
    
    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
    document.addEventListener('click', function(event) {
        if (!event.target.closest('.sidebar') && !event.target.closest('.menu-toggle')) {
            closeSidebar();
        }
    });
});
</script>
</body>
</html>